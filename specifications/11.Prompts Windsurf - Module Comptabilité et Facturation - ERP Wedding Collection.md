# Prompts Windsurf - Module Comptabilit√© et Facturation - ERP Wedding Collection

## Vue d'Ensemble du Module

Le module Comptabilit√© et Facturation repr√©sente le c≈ìur financier de l'ERP Wedding Collection, orchestrant l'ensemble des flux mon√©taires et des obligations comptables de l'entreprise. Ce module complexe et critique illustre l'application avanc√©e de notre m√©thodologie de g√©n√©ration de prompts Windsurf, transformant un cahier des charges technique exhaustif en instructions ex√©cutables optimis√©es pour l'agent de d√©veloppement.

La sophistication de ce module r√©side dans sa capacit√© √† g√©rer simultan√©ment les aspects commerciaux (devis, factures, avoirs), financiers (paiements, √©ch√©ances, relances), comptables (√©critures, journaux, FEC), et r√©glementaires (conformit√© fiscale, Factur-X, mentions l√©gales). Cette complexit√© multidimensionnelle n√©cessite une approche architecturale rigoureuse qui garantit la coh√©rence des donn√©es, la conformit√© l√©gale, et l'int√©gration harmonieuse avec l'√©cosyst√®me existant de l'ERP.

L'architecture du module s'appuie sur le sch√©ma `finance` d√©di√© pour isoler les donn√©es financi√®res sensibles, utilisant une approche de s√©paration des responsabilit√©s avec des services sp√©cialis√©s pour chaque domaine fonctionnel. Cette strat√©gie garantit la s√©curit√© des donn√©es financi√®res, facilite les audits, et pr√©pare l'√©volution vers des fonctionnalit√©s comptables avanc√©es.

La transformation de ce cahier des charges en prompts Windsurf suit notre m√©thodologie √©prouv√©e, structurant le d√©veloppement en quatre phases logiques qui optimisent l'efficacit√© de l'agent tout en maintenant la qualit√© et la conformit√© du code g√©n√©r√©. Chaque prompt int√®gre les sp√©cificit√©s r√©glementaires identifi√©es dans l'analyse documentaire, les bonnes pratiques Windsurf, et les contraintes d'int√©gration inter-modules critiques pour un module financier.

---

## Section 1 : Initialisation

### Prompt 1.1 : Cr√©ation du Sch√©ma Financier Complet et Conforme

üéØ **But** : Cr√©er le sch√©ma complet de base de donn√©es pour le module Comptabilit√© et Facturation avec toutes les tables, relations, contraintes de conformit√© l√©gale, politiques RLS renforc√©es, et triggers de calcul automatique conformes aux exigences fiscales fran√ßaises

üß† **Contexte** : Module financier critique du sch√©ma `finance` avec isolation compl√®te des donn√©es sensibles dans l'ERP Wedding Collection. Respecter imp√©rativement les conventions d√©finies dans `Conventions_Supabase_WeddingCollection_AgentIA.md` avec s√©curit√© renforc√©e, conformit√© l√©gale fran√ßaise, et int√©gration avec modules Clients, √âv√©nements, et Suivi des Mariages.

üõ†Ô∏è **Fichiers** :
- `supabase/migrations/20241203_020_create_finance_schema.sql`
- `supabase/migrations/20241203_021_create_financial_documents_schema.sql`
- `supabase/migrations/20241203_022_create_payments_schema.sql`
- `supabase/migrations/20241203_023_create_accounting_schema.sql`
- `supabase/migrations/20241203_024_create_dunning_schema.sql`
- `supabase/migrations/20241203_025_create_finance_policies.sql`
- `supabase/migrations/20241203_026_create_finance_triggers.sql`
- `supabase/migrations/20241203_027_insert_french_chart_accounts.sql`

üîÑ **Comportement** :
Cr√©er le sch√©ma `finance` avec isolation compl√®te des donn√©es financi√®res.

Cr√©er la table centrale `finance.financial_documents` avec les champs : document_type (VARCHAR avec ENUM document_type), document_number (VARCHAR UNIQUE avec contrainte de format), client_id (UUID FK vers shared.clients), event_id (UUID FK nullable vers shared.events), organization_id (UUID FK vers shared.organizations), issue_date (DATE NOT NULL), due_date (DATE), payment_terms (VARCHAR), status (VARCHAR avec ENUM document_status), subtotal_ht (DECIMAL(10,2) NOT NULL), total_discount (DECIMAL(10,2) DEFAULT 0), total_tax (DECIMAL(10,2) NOT NULL), total_ttc (DECIMAL(10,2) NOT NULL), currency (VARCHAR(3) DEFAULT 'EUR'), notes (TEXT), legal_mentions (TEXT), is_deposit (BOOLEAN DEFAULT false), deposit_percentage (DECIMAL(5,2)), parent_document_id (UUID FK nullable vers finance.financial_documents), pdf_path (VARCHAR), facturx_path (VARCHAR), sent_at (TIMESTAMPTZ), plus les champs standard (id, created_at, updated_at, created_by, updated_by).

Cr√©er les ENUMs : `document_type` (devis, facture, avoir, recu), `document_status` pour devis (brouillon, envoye, accepte, refuse, expire), pour factures (brouillon, envoyee, partiellement_payee, payee, annulee), pour avoirs (brouillon, emis, applique, rembourse).

Cr√©er la table `finance.document_lines` avec : document_id (UUID FK), line_number (INTEGER), description (VARCHAR NOT NULL), quantity (DECIMAL(10,3) NOT NULL), unit_price_ht (DECIMAL(10,2) NOT NULL), discount_percentage (DECIMAL(5,2) DEFAULT 0), discount_amount (DECIMAL(10,2) DEFAULT 0), tax_rate (DECIMAL(5,2) NOT NULL), line_total_ht (DECIMAL(10,2) NOT NULL), line_total_tax (DECIMAL(10,2) NOT NULL), line_total_ttc (DECIMAL(10,2) NOT NULL), plus champs standard.

Cr√©er la table `finance.payments` avec : payment_number (VARCHAR UNIQUE), document_id (UUID FK), amount (DECIMAL(10,2) NOT NULL), payment_date (DATE NOT NULL), payment_method (VARCHAR avec ENUM payment_method), reference (VARCHAR), bank_transaction_id (VARCHAR), stripe_payment_intent_id (VARCHAR), status (VARCHAR avec ENUM payment_status), notes (TEXT), plus champs standard.

Cr√©er les ENUMs : `payment_method` (especes, cheque, virement, carte_bancaire, stripe, centralpay), `payment_status` (en_attente, valide, echec, rembourse).

Cr√©er la table `finance.payment_allocations` avec : payment_id (UUID FK), document_id (UUID FK), allocated_amount (DECIMAL(10,2) NOT NULL), allocation_date (DATE NOT NULL), plus champs standard.

Cr√©er la table `finance.chart_of_accounts` avec : account_number (VARCHAR UNIQUE), account_name (VARCHAR NOT NULL), account_type (VARCHAR avec ENUM account_type), parent_account_id (UUID FK nullable), is_auxiliary (BOOLEAN DEFAULT false), auxiliary_type (VARCHAR avec ENUM auxiliary_type), is_active (BOOLEAN DEFAULT true), plus champs standard.

Cr√©er les ENUMs : `account_type` (actif, passif, charge, produit, resultat), `auxiliary_type` (client, fournisseur, autre).

Cr√©er la table `finance.accounting_entries` avec : entry_number (VARCHAR UNIQUE), entry_date (DATE NOT NULL), journal_code (VARCHAR avec ENUM journal_code), description (VARCHAR NOT NULL), reference (VARCHAR), is_validated (BOOLEAN DEFAULT false), validation_date (DATE), validation_user_id (UUID FK), plus champs standard.

Cr√©er l'ENUM `journal_code` (ventes, achats, banque, caisse, operations_diverses).

Cr√©er la table `finance.accounting_entry_lines` avec : entry_id (UUID FK), account_id (UUID FK), line_number (INTEGER), description (VARCHAR), debit_amount (DECIMAL(10,2) DEFAULT 0), credit_amount (DECIMAL(10,2) DEFAULT 0), auxiliary_account (VARCHAR), plus champs standard.

Cr√©er la table `finance.dunning_levels` avec : level_number (INTEGER), level_name (VARCHAR), days_after_due (INTEGER), email_template_id (UUID FK nullable), sms_template_id (UUID FK nullable), late_fee_percentage (DECIMAL(5,2) DEFAULT 0), is_active (BOOLEAN DEFAULT true), plus champs standard.

Cr√©er la table `finance.dunning_history` avec : document_id (UUID FK), dunning_level_id (UUID FK), sent_date (TIMESTAMPTZ), channel (VARCHAR avec ENUM dunning_channel), recipient (VARCHAR), status (VARCHAR avec ENUM dunning_status), error_message (TEXT), plus champs standard.

Cr√©er l'ENUM `dunning_channel` (email, sms, courrier), `dunning_status` (envoye, echec, lu, repondu).

Cr√©er la table `finance.bank_transactions` avec : transaction_date (DATE), description (VARCHAR), amount (DECIMAL(10,2)), balance (DECIMAL(10,2)), reference (VARCHAR), is_reconciled (BOOLEAN DEFAULT false), reconciled_payment_id (UUID FK nullable), import_batch_id (UUID), plus champs standard.

Activer RLS sur toutes les tables avec politiques renforc√©es pour : r√¥les admin_finance (acc√®s complet), comptable (lecture/√©criture documents et paiements), commercial (lecture/√©criture devis et factures assign√©s), gestionnaire (lecture selon organisation), client (lecture limit√©e aux documents partag√©s).

Cr√©er les index optimis√©s : `idx_financial_documents_client_id`, `idx_financial_documents_event_id`, `idx_financial_documents_organization`, `idx_financial_documents_status`, `idx_financial_documents_due_date`, `idx_financial_documents_number`, `idx_document_lines_document_id`, `idx_payments_document_id`, `idx_payments_date`, `idx_accounting_entries_date`, `idx_accounting_entries_journal`, `idx_accounting_entry_lines_account`.

Cr√©er les triggers critiques pour : g√©n√©ration automatique des num√©ros de documents avec s√©quences par type et organisation, calcul automatique des totaux de lignes et documents, mise √† jour automatique du statut de paiement des factures, g√©n√©ration automatique des √©critures comptables pour factures et paiements, validation des contraintes de conformit√© l√©gale (num√©rotation s√©quentielle, mentions obligatoires).

Ins√©rer le plan comptable fran√ßais standard avec comptes de base : 411000 (Clients), 445710 (TVA collect√©e), 512000 (Banque), 701000 (Ventes de prestations de services), 658000 (Charges diverses de gestion courante).

‚öôÔ∏è **Interactions** :
- **Consomme** : Tables shared.clients, shared.events, shared.organizations, shared.user_profiles
- **Expose** : Structure financi√®re pour modules Suivi des Mariages, Calendrier, futurs modules
- **Partage** : Types `FinancialDocument`, `Payment`, `AccountingEntry` avec packages/types
- **S√©curise** : Isolation compl√®te des donn√©es financi√®res avec RLS renforc√©e

üí° **Tips Windsurf** :
- Utiliser Cascade Write Mode pour g√©n√©ration automatique des migrations complexes
- Activer MCP Supabase pour cr√©ation directe et validation des contraintes l√©gales
- R√©f√©rencer m√©moire "Conventions Supabase Wedding Collection"
- Utiliser Claude 3.5 pour logique complexe des triggers de conformit√©
- Valider la conformit√© fiscale fran√ßaise avec contraintes CHECK strictes

### Prompt 1.2 : G√©n√©ration des Types TypeScript Financiers Complets

üéØ **But** : G√©n√©rer les types TypeScript complets et conformes pour le module Comptabilit√© et Facturation avec interfaces financi√®res, enums de conformit√©, types utilitaires de calcul, et sch√©mas de validation Zod pour assurer la type-safety et la conformit√© l√©gale

üß† **Contexte** : Types financiers partag√©s dans `packages/types` utilis√©s par toutes les applications du monorepo avec validation stricte des contraintes l√©gales. Synchronisation automatique avec le sch√©ma Supabase finance et extension des types existants Clients et √âv√©nements.

üõ†Ô∏è **Fichiers** :
- `packages/types/src/financial-documents.ts`
- `packages/types/src/payments.ts`
- `packages/types/src/accounting.ts`
- `packages/types/src/dunning.ts`
- `packages/types/src/finance-calculations.ts`
- `packages/types/src/legal-compliance.ts`
- `packages/types/src/database.ts` (mise √† jour)
- `packages/types/src/index.ts` (export)

üîÑ **Comportement** :
G√©n√©rer l'interface `FinancialDocument` correspondant exactement √† la table `finance.financial_documents` avec tous les champs typ√©s selon les contraintes l√©gales. Inclure les relations : `client?: Client`, `event?: Event`, `lines?: DocumentLine[]`, `payments?: Payment[]`, `parent_document?: FinancialDocument`, `child_documents?: FinancialDocument[]`.

Cr√©er les enums TypeScript correspondant aux enums SQL avec validation stricte : `DocumentType`, `DocumentStatus` (avec sous-types par document), `PaymentMethod`, `PaymentStatus`, `AccountType`, `AuxiliaryType`, `JournalCode`, `DunningChannel`, `DunningStatus`.

G√©n√©rer les interfaces pour toutes les entit√©s financi√®res : `DocumentLine`, `Payment`, `PaymentAllocation`, `ChartOfAccount`, `AccountingEntry`, `AccountingEntryLine`, `DunningLevel`, `DunningHistory`, `BankTransaction`.

Cr√©er les types utilitaires financiers : `FinancialDocumentCreate` (Omit<FinancialDocument, 'id' | 'created_at' | 'updated_at' | 'document_number'>), `FinancialDocumentUpdate` (Partial<FinancialDocumentCreate>), `FinancialDocumentWithDetails` (avec toutes les relations charg√©es), `FinancialDocumentListItem` (version all√©g√©e pour les listes), `DocumentTotals` (structure pour calculs de totaux).

Cr√©er les types de calculs financiers : `TaxCalculation` (base_amount, tax_rate, tax_amount, total_amount), `DiscountCalculation` (base_amount, discount_type, discount_value, discount_amount, final_amount), `DocumentCalculation` (subtotal_ht, total_discount, total_tax, total_ttc), `PaymentAllocationCalculation`.

G√©n√©rer les types de recherche et filtrage : `FinancialDocumentFilters` (document_type?, status?, client_id?, event_id?, date_range?, amount_range?, search?), `PaymentFilters`, `AccountingEntryFilters`, `FinancialSearchResult`, `FinancialListOptions`.

Cr√©er les types pour les formulaires : `FinancialDocumentFormData`, `DocumentLineFormData`, `PaymentFormData`, `AccountingEntryFormData`, `DunningConfigFormData`.

Cr√©er les sch√©mas de validation Zod avec contraintes l√©gales : `FinancialDocumentSchema` (validation num√©rotation, mentions l√©gales, calculs), `DocumentLineSchema` (validation quantit√©s, prix, taux TVA), `PaymentSchema` (validation montants, dates, r√©f√©rences), `AccountingEntrySchema` (validation √©quilibre d√©bit/cr√©dit).

Ajouter les types pour les APIs : `FinancialDocumentApiResponse`, `FinancialListResponse`, `FinancialStatsResponse`, `PaymentProcessingRequest`, `FECExportResponse`, `FacturXGenerationRequest`.

Cr√©er les types de conformit√© l√©gale : `LegalMentions` (structure des mentions obligatoires), `FacturXMetadata` (m√©tadonn√©es pour format Factur-X), `FECRecord` (structure d'enregistrement FEC), `TaxDeclarationData` (donn√©es pour d√©claration TVA).

‚öôÔ∏è **Interactions** :
- **Consomme** : Types Client, Event, Organization du sch√©ma Supabase
- **Expose** : Types financiers vers toutes les applications du monorepo
- **Partage** : Types communs avec modules Suivi des Mariages, Calendrier
- **Valide** : Conformit√© l√©gale avec contraintes TypeScript strictes

üí° **Tips Windsurf** :
- Utiliser Supercomplete pour coh√©rence avec patterns TypeScript financiers
- Activer g√©n√©ration automatique depuis sch√©ma Supabase finance
- Valider types avec compilation TypeScript stricte et contraintes l√©gales
- Synchroniser avec m√©moire "Types Wedding Collection"
- Utiliser Claude 3.5 pour logique complexe des types de calculs financiers

### Prompt 1.3 : Architecture des Services Financiers et Edge Functions

üéØ **But** : Cr√©er l'architecture compl√®te des services financiers pour le module Comptabilit√© et Facturation avec Edge Functions Supabase, services de g√©n√©ration Factur-X, int√©grations de paiement, et couches service/repository avec validation de conformit√© l√©gale

üß† **Contexte** : Services financiers dans `apps/backoffice/src/lib/services` utilisant Supabase client, Edge Functions pour g√©n√©ration PDF/Factur-X, int√©grations Stripe/CentralPay, validation Zod renforc√©e, et gestion d'erreurs sp√©cialis√©e pour conformit√© l√©gale.

üõ†Ô∏è **Fichiers** :
- `supabase/functions/generate-facturx-pdf/index.ts`
- `supabase/functions/send-financial-document/index.ts`
- `supabase/functions/payment-webhook-handler/index.ts`
- `supabase/functions/process-dunning/index.ts`
- `supabase/functions/export-fec/index.ts`
- `apps/backoffice/src/lib/services/financial-documents-service.ts`
- `apps/backoffice/src/lib/services/payments-service.ts`
- `apps/backoffice/src/lib/services/accounting-service.ts`
- `apps/backoffice/src/lib/repositories/finance-repository.ts`
- `apps/backoffice/src/lib/validators/finance-validators.ts`
- `apps/backoffice/src/lib/errors/finance-errors.ts`

üîÑ **Comportement** :
Cr√©er les Edge Functions Supabase critiques : `generate-facturx-pdf` pour g√©n√©ration de PDF conformes Factur-X avec m√©tadonn√©es XML embarqu√©es, mentions l√©gales automatiques, et validation de format, `send-financial-document` pour envoi s√©curis√© par email avec templates personnalisables et tracking de livraison, `payment-webhook-handler` pour r√©ception automatique des paiements Stripe/CentralPay avec validation et allocation automatique, `process-dunning` pour traitement automatique des relances avec escalade multi-niveaux, `export-fec` pour g√©n√©ration du Fichier des √âcritures Comptables conforme aux sp√©cifications fiscales.

Cr√©er `FinanceRepository` avec m√©thodes optimis√©es : `findFinancialDocuments(filters?, pagination?)`, `findFinancialDocumentById(id)`, `findUnpaidInvoices(organizationId)`, `findOverdueInvoices(organizationId)`, `createFinancialDocument(data)`, `updateFinancialDocument(id, data)`, `deleteFinancialDocument(id)`, `convertQuoteToInvoice(quoteId)`. Impl√©menter la logique de requ√™tes Supabase avec gestion des relations complexes et filtres financiers.

Cr√©er `FinancialDocumentsService` avec logique m√©tier : `createQuote(clientId, eventId?, lines)`, `convertQuoteToInvoice(quoteId)`, `createInvoice(clientId, eventId?, lines)`, `createCreditNote(invoiceId, lines?)`, `calculateDocumentTotals(lines)`, `generateDocumentNumber(type, organizationId)`, `validateLegalCompliance(document)`. Int√©grer validation business et gestion des workflows financiers.

Cr√©er `PaymentsService` avec : `recordPayment(documentId, amount, method, reference)`, `allocatePayment(paymentId, allocations)`, `processStripeWebhook(payload)`, `processCentralPayWebhook(payload)`, `generatePaymentReceipt(paymentId)`, `calculateOutstandingAmount(documentId)`. G√©rer les int√©grations de paiement et la logique d'allocation.

Cr√©er `AccountingService` avec : `generateInvoiceAccountingEntries(invoiceId)`, `generatePaymentAccountingEntries(paymentId)`, `createManualAccountingEntry(entryData)`, `validateAccountingEntry(entry)`, `getTrialBalance(organizationId, date)`, `getGeneralLedger(organizationId, accountId?, dateRange?)`, `exportFEC(organizationId, year)`. Int√©grer la logique comptable et les exports r√©glementaires.

Cr√©er les validateurs Zod avec contraintes l√©gales : `createFinancialDocumentSchema` (validation num√©rotation, mentions, calculs), `updateFinancialDocumentSchema`, `createPaymentSchema` (validation montants, r√©f√©rences), `allocatePaymentSchema`, `createAccountingEntrySchema` (validation √©quilibre d√©bit/cr√©dit).

Impl√©menter la gestion d'erreurs sp√©cialis√©e : `FinancialDocumentNotFoundError`, `InvalidDocumentNumberError`, `LegalComplianceError`, `PaymentAllocationError`, `AccountingValidationError`, `TaxCalculationError` avec codes d'erreur standardis√©s et messages de conformit√©.

Cr√©er les services de conformit√© : `LegalComplianceService` pour validation des mentions obligatoires et formats, `TaxCalculationService` pour calculs TVA complexes et multi-taux, `FacturXService` pour g√©n√©ration et validation du format Factur-X, `FECExportService` pour g√©n√©ration conforme du FEC.

‚öôÔ∏è **Interactions** :
- **Consomme** : Types packages/types, client Supabase, APIs Stripe/CentralPay
- **Expose** : Services financiers vers controllers API et composants frontend
- **√âmet** : √âv√©nements invoice_created, payment_received, document_sent, dunning_sent
- **Int√®gre** : Services externes (Stripe, CentralPay, SendGrid), g√©n√©ration PDF

üí° **Tips Windsurf** :
- Utiliser Cascade Chat Mode pour logique financi√®re complexe des Edge Functions
- R√©f√©rencer patterns de services financiers existants
- Int√©grer validation Zod avec contraintes l√©gales strictes
- Utiliser MCP Supabase pour d√©ploiement direct des Edge Functions
- Tester logique de calculs financiers avec cas limites et conformit√©

### Prompt 1.4 : Configuration des Hooks et Contextes Financiers

üéØ **But** : D√©velopper l'architecture compl√®te des hooks personnalis√©s et contextes React pour le module Comptabilit√© et Facturation avec gestion d'√©tat financier optimis√©e, cache intelligent, validation temps r√©el, et int√©gration s√©curis√©e

üß† **Contexte** : Hooks et contextes financiers dans `apps/backoffice/src/hooks` et `apps/backoffice/src/contexts` utilisant React Query pour le cache, validation temps r√©el des contraintes l√©gales, et patterns de gestion d'√©tat optimis√©s pour les donn√©es financi√®res sensibles.

üõ†Ô∏è **Fichiers** :
- `apps/backoffice/src/contexts/FinanceContext.tsx`
- `apps/backoffice/src/hooks/useFinancialDocuments.ts`
- `apps/backoffice/src/hooks/useFinancialDocumentDetails.ts`
- `apps/backoffice/src/hooks/usePayments.ts`
- `apps/backoffice/src/hooks/useAccountingEntries.ts`
- `apps/backoffice/src/hooks/useDunningManagement.ts`
- `apps/backoffice/src/hooks/useFinancialCalculations.ts`
- `apps/backoffice/src/hooks/useFinancialReports.ts`
- `apps/backoffice/src/hooks/useLegalCompliance.ts`

üîÑ **Comportement** :
Cr√©er `FinanceContext` avec √©tat global financier : documents actifs, filtres appliqu√©s, pr√©f√©rences utilisateur, cache des calculs fr√©quents, param√®tres de conformit√© l√©gale. Fournir actions : selectDocument, updateFilters, refreshFinancialData, clearSensitiveCache, validateCompliance.

D√©velopper `useFinancialDocuments` avec : `data` (liste des documents financiers), `isLoading`, `error`, `refetch`, `hasNextPage`, `fetchNextPage` pour pagination infinie. Int√©grer filtrage avanc√© (type, statut, client, montant, date), tri multiple, recherche textuelle. Impl√©menter cache intelligent avec invalidation bas√©e sur les √©v√©nements financiers.

Cr√©er `useFinancialDocumentDetails(documentId)` avec : `document` (donn√©es compl√®tes), `lines`, `payments`, `allocations`, `isLoading`, `error`, `refetch`, `updateDocument`, `addLine`, `removeLine`, `calculateTotals`. G√©rer le chargement progressif des relations financi√®res et la validation temps r√©el.

Impl√©menter `usePayments(documentId?)` avec : `payments`, `recordPayment`, `allocatePayment`, `generateReceipt`, `processRefund`, `getOutstandingAmount`. Optimiser les mises √† jour avec validation temps r√©el et optimistic updates s√©curis√©es.

D√©velopper `useAccountingEntries(filters?)` avec : `entries`, `createEntry`, `validateEntry`, `getTrialBalance`, `getGeneralLedger`, `exportFEC`. Int√©grer pagination, filtrage par journal/compte, recherche dans les descriptions.

Cr√©er `useDunningManagement(organizationId)` avec : `overdueInvoices`, `dunningLevels`, `dunningHistory`, `processDunning`, `configureDunningLevels`, `sendManualReminder`. G√©rer l'escalade automatique et le suivi des relances.

Impl√©menter `useFinancialCalculations` avec : `calculateLineTotals`, `calculateDocumentTotals`, `calculateTax`, `calculateDiscount`, `validateCalculations`, `recalculateDocument`. Optimiser les calculs avec memoization et validation de coh√©rence.

D√©velopper `useFinancialReports(organizationId)` avec : `salesReport`, `paymentsReport`, `agingReport`, `taxReport`, `generateReport`, `exportReport`, `scheduleReport`. G√©rer g√©n√©ration asynchrone et cache des rapports volumineux.

Cr√©er `useLegalCompliance` avec : `validateDocument`, `checkMandatoryMentions`, `validateNumbering`, `generateFacturX`, `validateFacturX`, `checkTaxCompliance`. Int√©grer validation temps r√©el et feedback de conformit√©.

Impl√©menter patterns d'optimisation financi√®re : memoization des calculs complexes, lazy loading des donn√©es non critiques, prefetching des documents li√©s, cleanup automatique des donn√©es sensibles, validation de s√©curit√© continue.

‚öôÔ∏è **Interactions** :
- **Consomme** : Services financiers, types TypeScript, client Supabase s√©curis√©
- **Expose** : Hooks financiers vers composants React, √©tat global via contexte
- **Int√®gre** : React Query pour cache, validation temps r√©el, s√©curit√© renforc√©e
- **Optimise** : Performance avec memoization et gestion m√©moire s√©curis√©e

üí° **Tips Windsurf** :
- Utiliser Supercomplete pour patterns React hooks financiers
- Activer m√©moire "React Patterns Wedding Collection"
- R√©f√©rencer hooks existants avec /Reference Open Editors
- Optimiser performance avec React DevTools Profiler pour donn√©es sensibles
- Tester hooks avec React Testing Library et validation de s√©curit√©

---

## Section 2 : Fonctionnalit√©s Principales

### Prompt 2.1 : Interface de Gestion des Documents Financiers

üéØ **But** : D√©velopper l'interface compl√®te de gestion des documents financiers (devis, factures, avoirs) pour le backoffice avec cr√©ation guid√©e, √©dition temps r√©el, validation de conformit√© l√©gale, et workflows automatis√©s utilisant ShadCN UI

üß† **Contexte** : Interface principale dans `apps/backoffice/app/finance` utilisant Next.js 14 App Router, ShadCN UI, Tailwind CSS, React Hook Form avec validation Zod, et int√©gration Supabase Auth pour permissions financi√®res. Point d'entr√©e principal du module avec navigation vers d√©tails et actions.

üõ†Ô∏è **Fichiers** :
- `apps/backoffice/app/finance/page.tsx` (dashboard principal)
- `apps/backoffice/app/finance/documents/page.tsx` (liste documents)
- `apps/backoffice/app/finance/documents/nouveau/page.tsx` (cr√©ation)
- `apps/backoffice/app/finance/documents/[id]/page.tsx` (d√©tail/√©dition)
- `components/finance/DocumentsTable.tsx`
- `components/finance/DocumentForm.tsx`
- `components/finance/DocumentLineEditor.tsx`
- `components/finance/DocumentPreview.tsx`
- `components/finance/DocumentActions.tsx`
- `components/finance/LegalComplianceChecker.tsx`

üîÑ **Comportement** :
Cr√©er la page dashboard avec m√©triques financi√®res : chiffre d'affaires mensuel/annuel, encaissements vs pr√©visions, cr√©ances clients avec balance √¢g√©e, factures en retard avec alertes, devis en attente de validation. Int√©grer graphiques interactifs (recharts) avec drill-down et export.

D√©velopper la liste des documents avec DataTable ShadCN affichant : num√©ro de document (lien vers d√©tail), type (badge color√©), client, montant TTC, statut (badge avec couleur), date d'√©mission, date d'√©ch√©ance, solde restant d√ª. Int√©grer tri multi-colonnes, filtres avanc√©s (type, statut, client, p√©riode, montant), recherche en temps r√©el, pagination c√¥t√© serveur.

Impl√©menter le formulaire de cr√©ation/√©dition avec : s√©lection du type de document, s√©lection client (autocomplete avec recherche), s√©lection √©v√©nement optionnel, √©diteur de lignes dynamique avec calculs automatiques, configuration des conditions de paiement, gestion des remises globales, validation de conformit√© l√©gale temps r√©el.

Cr√©er l'√©diteur de lignes avec : ajout/suppression de lignes, description avec autocomplete, quantit√© avec validation, prix unitaire HT, taux de TVA s√©lectionnable, calcul automatique des totaux par ligne, gestion des remises par ligne, r√©organisation par drag & drop.

D√©velopper la pr√©visualisation en temps r√©el avec : aper√ßu du document format√©, validation des mentions l√©gales obligatoires, v√©rification de la num√©rotation, contr√¥le des calculs, simulation du PDF final, d√©tection des erreurs de conformit√©.

Impl√©menter les actions sur documents avec : g√©n√©ration et t√©l√©chargement PDF, envoi par email avec template personnalisable, duplication avec nouveau num√©ro, conversion devis vers facture, cr√©ation d'avoir, annulation avec justification, archivage.

Cr√©er le v√©rificateur de conformit√© l√©gale avec : validation des mentions obligatoires (SIRET, TVA, adresse), contr√¥le de la num√©rotation s√©quentielle, v√©rification des taux de TVA, validation des conditions de paiement, contr√¥le du format des r√©f√©rences.

Int√©grer les permissions avec masquage conditionnel : admin_finance (acc√®s complet), comptable (cr√©ation/modification), commercial (devis et factures clients assign√©s), gestionnaire (lecture selon organisation), client (acc√®s limit√© aux documents partag√©s).

‚öôÔ∏è **Interactions** :
- **Consomme** : API /api/finance/documents, hooks useFinancialDocuments, composants shared-ui
- **Expose** : Interface financi√®re pour comptables et commerciaux
- **Int√®gre** : Modules Clients et √âv√©nements, syst√®me de notifications
- **Valide** : Conformit√© l√©gale en temps r√©el avec feedback visuel

üí° **Tips Windsurf** :
- Utiliser Supercomplete pour patterns ShadCN UI DataTable financiers
- Activer m√©moire "Design System Wedding Collection"
- R√©f√©rencer composants financiers existants avec /Reference Open Editors
- Optimiser performance avec virtualisation pour grandes listes
- Tester validation de conformit√© l√©gale avec cas limites

### Prompt 2.2 : Syst√®me de Gestion des Paiements et Allocations

üéØ **But** : Cr√©er le syst√®me complet de gestion des paiements avec enregistrement manuel, int√©gration automatique des passerelles, allocation intelligente, rapprochement bancaire, et g√©n√©ration de re√ßus conformes

üß† **Contexte** : Syst√®me de paiements dans l'onglet Paiements du module finance, int√©grant Stripe et CentralPay pour paiements automatiques, logique d'allocation sophistiqu√©e pour paiements partiels, et rapprochement bancaire semi-automatique.

üõ†Ô∏è **Fichiers** :
- `components/finance/payments/PaymentsList.tsx`
- `components/finance/payments/PaymentForm.tsx`
- `components/finance/payments/PaymentAllocation.tsx`
- `components/finance/payments/BankReconciliation.tsx`
- `components/finance/payments/PaymentReceipt.tsx`
- `components/finance/payments/PaymentDashboard.tsx`
- `hooks/usePayments.ts`
- `hooks/usePaymentAllocations.ts`
- `hooks/useBankReconciliation.ts`

üîÑ **Comportement** :
Cr√©er la liste des paiements avec : affichage chronologique avec filtres (date, montant, m√©thode, statut), regroupement par p√©riode, recherche par r√©f√©rence/client, indicateurs visuels pour paiements non allou√©s, liens vers factures associ√©es, actions rapides (allocation, re√ßu, remboursement).

D√©velopper le formulaire de paiement avec : s√©lection du client avec autocomplete, montant avec validation, date de paiement, m√©thode de paiement (liste d√©roulante), r√©f√©rence/num√©ro de ch√®que, notes optionnelles, allocation automatique sugg√©r√©e bas√©e sur les factures impay√©es.

Impl√©menter l'allocation de paiements avec : liste des factures impay√©es du client, allocation automatique FIFO (First In, First Out), allocation manuelle avec drag & drop, gestion des paiements partiels, sur-paiements avec cr√©ation de cr√©dit client, validation des montants allou√©s.

Cr√©er le rapprochement bancaire avec : import de relev√©s bancaires (CSV, OFX, QIF), rapprochement automatique bas√© sur montants et r√©f√©rences, interface de rapprochement manuel avec suggestions, gestion des √©carts et anomalies, validation et cl√¥ture des rapprochements.

D√©velopper la g√©n√©ration de re√ßus avec : template professionnel avec mentions l√©gales, num√©rotation automatique des re√ßus, g√©n√©ration PDF instantan√©e, envoi automatique par email, archivage s√©curis√©, r√©impression avec filigrane.

Impl√©menter le dashboard des paiements avec : encaissements du jour/mois, r√©partition par m√©thode de paiement, paiements en attente de validation, alertes pour paiements suspects, pr√©visions d'encaissement bas√©es sur les √©ch√©ances.

Cr√©er l'int√©gration Stripe avec : r√©ception des webhooks de paiement, validation des signatures, cr√©ation automatique des paiements, allocation automatique bas√©e sur les m√©tadonn√©es, gestion des remboursements, synchronisation des statuts.

G√©rer l'int√©gration CentralPay avec : r√©ception des notifications de paiement, validation des transactions, cr√©ation automatique des enregistrements, r√©conciliation avec les commandes, gestion des √©checs et reprises.

‚öôÔ∏è **Interactions** :
- **Consomme** : API payments, webhooks Stripe/CentralPay, services bancaires
- **Expose** : Donn√©es de paiement vers comptabilit√© et reporting
- **Int√®gre** : Passerelles de paiement, services d'email, g√©n√©ration PDF
- **Synchronise** : Statuts de factures avec paiements re√ßus

üí° **Tips Windsurf** :
- Utiliser Cascade Write Mode pour logique d'allocation complexe
- Activer MCP Supabase pour gestion s√©curis√©e des webhooks
- R√©f√©rencer patterns de paiement existants
- Optimiser avec debouncing pour calculs d'allocation
- Tester int√©grations avec environnements sandbox

### Prompt 2.3 : Module de Relances et Recouvrement Automatis√©

üéØ **But** : D√©velopper le syst√®me complet de relances automatis√©es avec configuration multi-niveaux, envoi programm√© par email/SMS, escalade intelligente, suivi des actions, et tableau de bord de recouvrement

üß† **Contexte** : Syst√®me de relances dans l'onglet Recouvrement du module finance, utilisant Edge Functions pour traitement automatique, int√©gration SendGrid pour emails et services SMS, avec logique d'escalade configurable et reporting d√©taill√©.

üõ†Ô∏è **Fichiers** :
- `components/finance/dunning/DunningDashboard.tsx`
- `components/finance/dunning/DunningLevels.tsx`
- `components/finance/dunning/DunningHistory.tsx`
- `components/finance/dunning/OverdueInvoices.tsx`
- `components/finance/dunning/DunningTemplates.tsx`
- `components/finance/dunning/DunningScheduler.tsx`
- `hooks/useDunningManagement.ts`
- `hooks/useDunningTemplates.ts`

üîÑ **Comportement** :
Cr√©er le dashboard de recouvrement avec : montant total des cr√©ances en retard, r√©partition par anciennet√© (0-30, 30-60, 60-90, +90 jours), taux de recouvrement par p√©riode, efficacit√© des relances par niveau, clients √† risque avec scoring automatique, actions prioritaires du jour.

D√©velopper la configuration des niveaux de relance avec : d√©finition des d√©lais (jours apr√®s √©ch√©ance), s√©lection des canaux (email, SMS, courrier), templates de messages personnalisables, calcul automatique des p√©nalit√©s de retard, conditions d'activation (montant minimum, type de client), escalade automatique vers niveau sup√©rieur.

Impl√©menter la gestion des templates avec : √©diteur riche pour emails avec variables dynamiques (nom client, montant, √©ch√©ance), templates SMS avec limitation de caract√®res, personnalisation par type de client, pr√©visualisation en temps r√©el, versioning des templates, A/B testing des messages.

Cr√©er la liste des factures en retard avec : tri par anciennet√© et montant, filtrage par client/commercial, indicateurs de risque client, historique des relances envoy√©es, actions rapides (relance manuelle, plan de paiement, abandon), export pour actions externes.

D√©velopper l'historique des relances avec : timeline chronologique par client, statut de livraison des emails/SMS, taux d'ouverture et de r√©ponse, actions client suite aux relances, efficacit√© par type de message, co√ªt des relances par canal.

Impl√©menter le planificateur automatique avec : traitement quotidien des √©ch√©ances, identification des factures √©ligibles aux relances, application des r√®gles de niveau, envoi automatique selon planning, gestion des exceptions (jours f√©ri√©s, cong√©s client), reporting d'activit√©.

Cr√©er la gestion des exceptions avec : clients en litige (suspension temporaire), plans de paiement en cours (adaptation des relances), clients VIP (relances personnalis√©es), factures contest√©es (workflow sp√©cial), seuils de montant (relances diff√©renci√©es).

G√©rer l'int√©gration multi-canaux avec : envoi d'emails via SendGrid avec tracking, envoi de SMS via API d√©di√©e, g√©n√©ration de courriers PDF pour impression, suivi des accus√©s de r√©ception, gestion des bounces et erreurs.

‚öôÔ∏è **Interactions** :
- **Consomme** : API dunning, services SendGrid/SMS, templates syst√®me
- **Expose** : Donn√©es de recouvrement vers reporting et comptabilit√©
- **Int√®gre** : Syst√®me de notifications, calendrier, gestion client
- **Automatise** : Processus de relance avec escalade intelligente

üí° **Tips Windsurf** :
- Utiliser Cascade Chat Mode pour logique d'escalade complexe
- Activer Edge Functions pour traitement automatique quotidien
- R√©f√©rencer patterns de communication existants
- Optimiser avec queues pour envois en masse
- Tester workflows complets avec donn√©es r√©alistes

### Prompt 2.4 : Comptabilit√© et Exports R√©glementaires

üéØ **But** : Cr√©er le syst√®me complet de comptabilit√© avec g√©n√©ration automatique d'√©critures, journaux comptables, grand livre, balance, et exports r√©glementaires (FEC, d√©claration TVA) conformes aux exigences fiscales fran√ßaises

üß† **Contexte** : Syst√®me comptable dans l'onglet Comptabilit√© du module finance, g√©n√©rant automatiquement les √©critures √† partir des factures et paiements, avec exports conformes aux standards fiscaux fran√ßais et interface pour expert-comptable.

üõ†Ô∏è **Fichiers** :
- `components/finance/accounting/AccountingDashboard.tsx`
- `components/finance/accounting/ChartOfAccounts.tsx`
- `components/finance/accounting/AccountingEntries.tsx`
- `components/finance/accounting/GeneralLedger.tsx`
- `components/finance/accounting/TrialBalance.tsx`
- `components/finance/accounting/FECExport.tsx`
- `components/finance/accounting/TaxDeclaration.tsx`
- `hooks/useAccountingEntries.ts`
- `hooks/useAccountingReports.ts`

üîÑ **Comportement** :
Cr√©er le dashboard comptable avec : balance g√©n√©rale en temps r√©el, √©volution des comptes principaux (clients, banque, ventes), √©critures en attente de validation, alertes de d√©s√©quilibre, indicateurs de conformit√©, acc√®s rapide aux journaux et exports.

D√©velopper la gestion du plan comptable avec : arborescence des comptes avec num√©rotation fran√ßaise standard, cr√©ation/modification de comptes personnalis√©s, gestion des comptes auxiliaires clients/fournisseurs, activation/d√©sactivation de comptes, recherche et filtrage, import/export du plan comptable.

Impl√©menter la liste des √©critures comptables avec : affichage par journal (ventes, achats, banque, OD), filtrage par p√©riode et compte, recherche par libell√© et r√©f√©rence, validation en lot des √©critures, correction d'√©critures avec contre-passation, export vers logiciels comptables tiers.

Cr√©er le grand livre avec : consultation par compte avec soldes d'ouverture/cl√¥ture, d√©tail des mouvements avec pi√®ces justificatives, filtrage par p√©riode, lettrage des comptes clients/fournisseurs, export PDF format√© pour archivage, navigation rapide entre comptes li√©s.

D√©velopper la balance comptable avec : balance g√©n√©rale avec tous les comptes, balance auxiliaire clients/fournisseurs, comparaison sur plusieurs p√©riodes, d√©tection des d√©s√©quilibres, export Excel avec formules, int√©gration avec tableaux de bord financiers.

Impl√©menter l'export FEC avec : g√©n√©ration conforme aux sp√©cifications DGFiP, validation du format et de la coh√©rence, compression et chiffrement du fichier, horodatage et signature √©lectronique, archivage s√©curis√©, transmission s√©curis√©e √† l'expert-comptable.

Cr√©er la pr√©paration de d√©claration TVA avec : calcul automatique de la TVA collect√©e/d√©ductible, ventilation par taux de TVA, gestion des r√©gimes sp√©ciaux, d√©tection des anomalies, export au format requis, r√©conciliation avec les d√©clarations pr√©c√©dentes.

G√©rer les cl√¥tures comptables avec : cl√¥ture mensuelle avec validation des √©critures, g√©n√©ration des √©tats de synth√®se, cl√¥ture annuelle avec √©critures de r√©gularisation, r√©ouverture automatique des comptes, archivage des donn√©es cl√¥tur√©es.

‚öôÔ∏è **Interactions** :
- **Consomme** : √âcritures g√©n√©r√©es automatiquement, plan comptable, param√®tres fiscaux
- **Expose** : Donn√©es comptables vers reporting et expert-comptable
- **Int√®gre** : Logiciels comptables tiers, services de transmission DGFiP
- **Conforme** : R√©glementations comptables et fiscales fran√ßaises

üí° **Tips Windsurf** :
- Utiliser Cascade Write Mode pour g√©n√©ration automatique d'√©critures
- Activer validation stricte des formats r√©glementaires
- R√©f√©rencer standards comptables fran√ßais
- Optimiser requ√™tes pour gros volumes de donn√©es
- Tester conformit√© avec outils de validation DGFiP

---

## Section 3 : Fonctionnalit√©s Secondaires

### Prompt 3.1 : Tableaux de Bord et Reporting Financier Avanc√©

üéØ **But** : D√©velopper un syst√®me complet de tableaux de bord et reporting financier avec m√©triques en temps r√©el, analyses pr√©dictives, rapports personnalisables, visualisations interactives, et exports multi-formats

üß† **Contexte** : Syst√®me de reporting dans l'onglet Rapports du module finance, utilisant recharts pour visualisations, calculs de m√©triques complexes c√¥t√© serveur, et g√©n√©ration de rapports PDF avec templates personnalisables.

üõ†Ô∏è **Fichiers** :
- `components/finance/reports/FinancialDashboard.tsx`
- `components/finance/reports/SalesAnalytics.tsx`
- `components/finance/reports/CashFlowAnalysis.tsx`
- `components/finance/reports/ClientAnalytics.tsx`
- `components/finance/reports/ReportGenerator.tsx`
- `components/finance/reports/KPICards.tsx`
- `hooks/useFinancialReports.ts`
- `hooks/useFinancialKPIs.ts`

üîÑ **Comportement** :
Cr√©er le dashboard financier principal avec : KPIs essentiels (CA mensuel/annuel, marge brute, DSO, taux de recouvrement), graphiques d'√©volution temporelle, comparaisons avec objectifs et p√©riode pr√©c√©dente, alertes pour d√©viations importantes, acc√®s rapide aux analyses d√©taill√©es.

D√©velopper l'analyse des ventes avec : √©volution du chiffre d'affaires par p√©riode, r√©partition par type d'√©v√©nement et client, analyse de la saisonnalit√©, identification des tendances, pr√©visions bas√©es sur l'historique, comparaison avec objectifs commerciaux.

Impl√©menter l'analyse de tr√©sorerie avec : flux de tr√©sorerie r√©alis√©s et pr√©visionnels, √©ch√©ancier des encaissements, analyse des retards de paiement, simulation de sc√©narios, alertes de tension de tr√©sorerie, optimisation du BFR.

Cr√©er l'analyse client avec : classement des clients par CA, analyse de la rentabilit√© par client, segmentation comportementale, risque client avec scoring, √©volution du portefeuille, identification des clients √† fort potentiel.

D√©velopper le g√©n√©rateur de rapports avec : templates pr√©d√©finis (bilan commercial, analyse financi√®re, rapport de gestion), personnalisation des sections et m√©triques, planification d'envois automatiques, g√©n√©ration PDF avec graphiques, export Excel avec donn√©es d√©taill√©es.

Impl√©menter les KPIs personnalisables avec : d√©finition de m√©triques custom, calculs automatiques avec formules, seuils d'alerte configurables, historique des performances, benchmarking sectoriel, tableaux de bord par r√¥le.

Cr√©er les analyses pr√©dictives avec : pr√©visions de CA bas√©es sur pipeline, pr√©diction des encaissements, d√©tection pr√©coce des impay√©s, optimisation des relances, simulation d'impact des d√©cisions commerciales.

G√©rer l'export et partage avec : formats multiples (PDF, Excel, PowerPoint), templates personnalisables par organisation, planification d'envois r√©currents, partage s√©curis√© avec liens temporaires, int√©gration avec outils BI externes.

‚öôÔ∏è **Interactions** :
- **Consomme** : Toutes les donn√©es financi√®res, historiques, objectifs
- **Expose** : M√©triques et analyses vers direction et √©quipes
- **Int√®gre** : Outils de g√©n√©ration PDF, services d'email, APIs externes
- **Analyse** : Performance financi√®re et optimisations possibles

üí° **Tips Windsurf** :
- Utiliser recharts pour visualisations performantes et interactives
- Impl√©menter calculs de m√©triques avec vues mat√©rialis√©es
- Optimiser requ√™tes avec agr√©gations c√¥t√© base
- Tester performance avec gros volumes historiques
- Cr√©er templates de rapports r√©utilisables et brand√©s

### Prompt 3.2 : Configuration et Administration Financi√®re

üéØ **But** : Cr√©er un syst√®me complet de configuration et administration pour le module financier avec param√©trage des r√®gles m√©tier, gestion des templates, configuration des int√©grations, et outils d'administration avanc√©s

üß† **Contexte** : Interface d'administration dans l'onglet Configuration du module finance, accessible aux administrateurs financiers pour param√©trer les r√®gles de gestion, templates de documents, int√©grations externes, et politiques de s√©curit√©.

üõ†Ô∏è **Fichiers** :
- `components/finance/admin/FinanceSettings.tsx`
- `components/finance/admin/DocumentTemplates.tsx`
- `components/finance/admin/TaxConfiguration.tsx`
- `components/finance/admin/PaymentGateways.tsx`
- `components/finance/admin/DunningConfiguration.tsx`
- `components/finance/admin/UserPermissions.tsx`
- `hooks/useFinanceSettings.ts`
- `hooks/useDocumentTemplates.ts`

üîÑ **Comportement** :
Cr√©er la configuration g√©n√©rale avec : informations l√©gales de l'entreprise (raison sociale, SIRET, TVA intracommunautaire), adresses de facturation et correspondance, param√®tres de num√©rotation des documents, conditions g√©n√©rales de vente, mentions l√©gales personnalis√©es, devises support√©es.

D√©velopper la gestion des templates avec : √©diteur visuel pour templates de documents (devis, factures, avoirs), personnalisation du logo et charte graphique, variables dynamiques pour donn√©es client/√©v√©nement, pr√©visualisation en temps r√©el, versioning des templates, templates par type de client.

Impl√©menter la configuration fiscale avec : param√©trage des taux de TVA par cat√©gorie, gestion des r√©gimes sp√©ciaux (auto-entrepreneur, TVA sur encaissement), configuration des comptes comptables par d√©faut, r√®gles de calcul des p√©nalit√©s de retard, seuils de franchise.

Cr√©er la configuration des passerelles de paiement avec : param√®tres Stripe (cl√©s API, webhooks, modes de paiement), configuration CentralPay (identifiants, URLs de retour), gestion des commissions, mapping des statuts de paiement, tests de connectivit√©.

D√©velopper la configuration des relances avec : d√©finition des niveaux de relance personnalis√©s, param√©trage des d√©lais et conditions, configuration des templates email/SMS, r√®gles d'escalade automatique, exceptions par type de client, co√ªts par canal.

Impl√©menter la gestion des permissions avec : d√©finition des r√¥les financiers (admin_finance, comptable, commercial), attribution des droits par fonctionnalit√©, gestion des acc√®s aux donn√©es sensibles, audit trail des actions, d√©l√©gations temporaires.

Cr√©er les outils d'administration avec : monitoring des performances du module, logs des erreurs et exceptions, statistiques d'utilisation par fonctionnalit√©, maintenance des donn√©es (purge, archivage), sauvegarde et restauration, migration de donn√©es.

G√©rer les int√©grations externes avec : configuration des APIs tierces (banques, experts-comptables), param√®tres d'export automatique, synchronisation avec logiciels comptables, webhooks sortants, monitoring des connexions.

‚öôÔ∏è **Interactions** :
- **Configure** : Tous les aspects du module financier
- **Int√®gre** : Services externes et APIs tierces
- **S√©curise** : Acc√®s et permissions aux donn√©es financi√®res
- **Monitore** : Performance et utilisation du syst√®me

üí° **Tips Windsurf** :
- Utiliser Cascade Chat Mode pour interfaces de configuration complexes
- Activer validation stricte des param√®tres critiques
- R√©f√©rencer patterns d'administration existants
- Impl√©menter sauvegarde automatique des configurations
- Tester tous les sc√©narios de configuration

### Prompt 3.3 : Audit et Conformit√© R√©glementaire

üéØ **But** : D√©velopper un syst√®me complet d'audit et de conformit√© r√©glementaire avec tra√ßabilit√© compl√®te, contr√¥les automatiques, rapports d'audit, et outils de mise en conformit√© pour r√©pondre aux exigences l√©gales et fiscales

üß† **Contexte** : Syst√®me d'audit dans l'onglet Conformit√© du module finance, assurant la tra√ßabilit√© compl√®te des op√©rations financi√®res, la conformit√© aux r√©glementations fran√ßaises, et la pr√©paration aux contr√¥les fiscaux.

üõ†Ô∏è **Fichiers** :
- `components/finance/audit/AuditDashboard.tsx`
- `components/finance/audit/AuditTrail.tsx`
- `components/finance/audit/ComplianceChecks.tsx`
- `components/finance/audit/RegulatoryReports.tsx`
- `components/finance/audit/DataRetention.tsx`
- `components/finance/audit/SecurityMonitoring.tsx`
- `hooks/useAuditTrail.ts`
- `hooks/useComplianceChecks.ts`

üîÑ **Comportement** :
Cr√©er le dashboard d'audit avec : statut de conformit√© global, alertes de non-conformit√©, derniers contr√¥les effectu√©s, actions correctives en cours, statistiques d'audit par p√©riode, acc√®s rapide aux rapports r√©glementaires.

D√©velopper la piste d'audit avec : journalisation compl√®te de toutes les actions (cr√©ation, modification, suppression), horodatage pr√©cis avec utilisateur responsable, d√©tail des modifications avec valeurs avant/apr√®s, recherche avanc√©e par utilisateur/action/p√©riode, export s√©curis√© pour contr√¥les externes.

Impl√©menter les contr√¥les de conformit√© avec : v√©rification automatique de la num√©rotation s√©quentielle, validation des mentions l√©gales obligatoires, contr√¥le de coh√©rence des calculs TVA, v√©rification des d√©lais de conservation, d√©tection des anomalies comptables.

Cr√©er les rapports r√©glementaires avec : g√©n√©ration automatique du FEC avec validation, pr√©paration des d√©clarations TVA, rapports pour contr√¥les fiscaux, √©tats de synth√®se comptable, documentation des proc√©dures internes.

D√©velopper la gestion de la r√©tention avec : archivage automatique des documents selon dur√©es l√©gales, purge s√©curis√©e des donn√©es expir√©es, restauration de documents archiv√©s, certification de l'int√©grit√© des archives, export pour stockage externe.

Impl√©menter le monitoring de s√©curit√© avec : surveillance des acc√®s aux donn√©es sensibles, d√©tection des tentatives d'acc√®s non autoris√©es, alertes pour actions suspectes, rapports de s√©curit√© p√©riodiques, conformit√© RGPD pour donn√©es personnelles.

Cr√©er les outils de mise en conformit√© avec : assistant de mise en conformit√© pour nouvelles r√©glementations, v√©rification automatique des pr√©requis l√©gaux, g√©n√©ration de documentation de conformit√©, simulation de contr√¥les fiscaux, formation aux bonnes pratiques.

G√©rer la documentation r√©glementaire avec : base de connaissances des obligations l√©gales, veille r√©glementaire automatis√©e, impact des changements sur les processus, proc√©dures de mise √† jour, formation des utilisateurs.

‚öôÔ∏è **Interactions** :
- **Surveille** : Toutes les op√©rations du module financier
- **Documente** : Conformit√© aux r√©glementations fran√ßaises
- **Pr√©pare** : Contr√¥les fiscaux et audits externes
- **Assure** : Int√©grit√© et s√©curit√© des donn√©es financi√®res

üí° **Tips Windsurf** :
- Utiliser triggers de base de donn√©es pour audit automatique
- Impl√©menter chiffrement pour donn√©es sensibles archiv√©es
- R√©f√©rencer r√©glementations comptables fran√ßaises
- Optimiser stockage pour gros volumes d'audit
- Tester proc√©dures de restauration et conformit√©

---

## Section 4 : √âvolutions Futures

### Prompt 4.1 : Intelligence Artificielle Financi√®re et Pr√©dictions

üéØ **But** : Int√©grer des capacit√©s d'intelligence artificielle avanc√©es pour l'analyse financi√®re pr√©dictive, la d√©tection de fraudes, l'optimisation de tr√©sorerie, et l'assistance intelligente dans la gestion financi√®re

üß† **Contexte** : Module IA financi√®re utilisant Supabase Edge Functions, int√©gration OpenAI API, mod√®les de machine learning sp√©cialis√©s en finance, et automatisation intelligente des processus financiers pour optimiser la performance et r√©duire les risques.

üõ†Ô∏è **Fichiers** :
- `supabase/functions/ai-financial-analysis/index.ts`
- `supabase/functions/fraud-detection/index.ts`
- `supabase/functions/cash-flow-prediction/index.ts`
- `components/finance/ai/AIFinancialAssistant.tsx`
- `components/finance/ai/PredictiveAnalytics.tsx`
- `components/finance/ai/FraudDetection.tsx`
- `services/ai-finance-service.ts`
- `hooks/useAIFinancialAnalysis.ts`

üîÑ **Comportement** :
Cr√©er l'assistant IA financier avec : analyse automatique des tendances financi√®res, recommandations d'optimisation de tr√©sorerie, d√©tection d'anomalies dans les paiements, suggestions d'am√©lioration des processus, r√©ponses aux questions financi√®res complexes.

D√©velopper l'analyse pr√©dictive avec : pr√©visions de chiffre d'affaires bas√©es sur l'historique et la saisonnalit√©, pr√©diction des encaissements avec probabilit√©s, identification pr√©coce des risques d'impay√©s, optimisation des relances bas√©e sur l'efficacit√© historique.

Impl√©menter la d√©tection de fraudes avec : analyse comportementale des paiements, d√©tection de patterns suspects, scoring de risque automatique, alertes en temps r√©el pour transactions douteuses, apprentissage continu des nouveaux types de fraudes.

Cr√©er l'optimisation de tr√©sorerie avec : pr√©dictions de flux de tr√©sorerie √† court et moyen terme, recommandations de placement des exc√©dents, optimisation du timing des paiements fournisseurs, simulation de sc√©narios financiers.

D√©velopper l'analyse client intelligente avec : scoring automatique de solvabilit√©, pr√©diction de la valeur vie client (LTV), segmentation comportementale avanc√©e, recommandations de conditions commerciales personnalis√©es.

Impl√©menter l'automatisation intelligente avec : g√©n√©ration automatique de devis bas√©e sur l'historique, optimisation des conditions de paiement par client, automatisation des relances avec personnalisation IA, g√©n√©ration de rapports narratifs.

Cr√©er l'analyse de performance avec : benchmarking automatique avec le secteur, identification des leviers d'am√©lioration, simulation d'impact des d√©cisions strat√©giques, optimisation des processus financiers.

G√©rer l'apprentissage continu avec : am√©lioration des mod√®les bas√©e sur les r√©sultats, adaptation aux sp√©cificit√©s de l'organisation, personnalisation progressive des recommandations, mise √† jour automatique des algorithmes.

‚öôÔ∏è **Interactions** :
- **Consomme** : Toutes les donn√©es financi√®res historiques, APIs IA externes
- **Expose** : Analyses et recommandations vers utilisateurs
- **Int√®gre** : OpenAI API, mod√®les de ML sp√©cialis√©s, Edge Functions
- **Apprend** : Continuellement des donn√©es et feedback utilisateurs

üí° **Tips Windsurf** :
- Utiliser Edge Functions pour traitement IA c√¥t√© serveur
- Impl√©menter cache intelligent pour pr√©dictions fr√©quentes
- Tester avec donn√©es anonymis√©es pour respect RGPD
- Cr√©er interfaces explicables pour d√©cisions IA
- Monitorer performance et biais des mod√®les financiers

### Prompt 4.2 : √âcosyst√®me d'Int√©grations Financi√®res

üéØ **But** : D√©velopper un √©cosyst√®me complet d'int√©grations financi√®res avec API publique, connecteurs bancaires, int√©grations comptables, marketplace de services financiers, et SDK pour d√©veloppeurs tiers

üß† **Contexte** : API publique financi√®re avec authentification OAuth2 renforc√©e, webhooks s√©curis√©s, SDK sp√©cialis√©s, et marketplace d'int√©grations pour √©tendre les fonctionnalit√©s financi√®res avec des services tiers sp√©cialis√©s.

üõ†Ô∏è **Fichiers** :
- `apps/api-public/app/api/v1/finance/route.ts`
- `apps/api-public/src/lib/auth/finance-oauth-handler.ts`
- `apps/api-public/src/lib/integrations/banking-connectors.ts`
- `apps/api-public/src/lib/integrations/accounting-software.ts`
- `docs/api/finance-openapi.yaml`
- `sdk/javascript/finance-sdk.ts`
- `sdk/python/finance_sdk.py`

üîÑ **Comportement** :
Cr√©er l'API publique financi√®re avec : endpoints RESTful pour consultation des donn√©es financi√®res (lecture s√©curis√©e), webhooks pour √©v√©nements financiers en temps r√©el, authentification OAuth2 avec scopes financiers granulaires, rate limiting adaptatif, versioning d'API avec r√©trocompatibilit√© stricte.

D√©velopper les connecteurs bancaires avec : int√©gration PSD2 pour r√©cup√©ration automatique des relev√©s, rapprochement automatique intelligent, synchronisation des soldes en temps r√©el, gestion multi-banques, certification des connexions s√©curis√©es.

Impl√©menter les int√©grations comptables avec : connecteurs pour logiciels majeurs (Sage, Cegid, EBP), synchronisation bidirectionnelle des √©critures, mapping automatique des comptes, export/import automatis√©, r√©conciliation des donn√©es.

Cr√©er le marketplace d'int√©grations avec : catalogue de services financiers sp√©cialis√©s, installation en un clic avec configuration guid√©e, gestion des abonnements et facturation, monitoring des performances, support communautaire.

D√©velopper les SDKs sp√©cialis√©s avec : biblioth√®que JavaScript/TypeScript pour int√©grations web, SDK Python pour automatisations financi√®res, wrapper .NET pour int√©grations entreprise, SDK mobile pour applications natives.

Impl√©menter les int√©grations natives avec : Zapier pour automatisations no-code financi√®res, Power BI pour analyses avanc√©es, Slack pour notifications financi√®res, services de facturation √©lectronique, plateformes de paiement alternatives.

Cr√©er la documentation interactive avec : sp√©cification OpenAPI compl√®te pour APIs financi√®res, playground s√©curis√© avec donn√©es de test, guides d'int√©gration par cas d'usage financier, exemples de code certifi√©s, FAQ d√©veloppeurs sp√©cialis√©e.

G√©rer la s√©curit√© et conformit√© avec : chiffrement end-to-end pour donn√©es financi√®res, audit trail des acc√®s API, conformit√© PCI-DSS pour donn√©es de paiement, certification ISO 27001, monitoring de s√©curit√© avanc√©.

‚öôÔ∏è **Interactions** :
- **Expose** : Donn√©es financi√®res vers √©cosyst√®me externe s√©curis√©
- **Int√®gre** : Services bancaires et comptables sp√©cialis√©s
- **S√©curise** : Acc√®s contr√¥l√© avec authentification financi√®re renforc√©e
- **Monitore** : Usage et performance des int√©grations financi√®res

üí° **Tips Windsurf** :
- Utiliser OpenAPI pour g√©n√©ration automatique de documentation financi√®re
- Impl√©menter monitoring complet des APIs et webhooks financiers
- Tester charge et s√©curit√© avec outils sp√©cialis√©s finance
- Cr√©er sandbox s√©curis√© pour d√©veloppeurs tiers
- Maintenir conformit√© r√©glementaire stricte

### Prompt 4.3 : Finance Mobile et Exp√©rience Client Avanc√©e

üéØ **But** : Cr√©er une exp√©rience financi√®re mobile native et des outils client avanc√©s avec application React Native, paiements mobiles, signature √©lectronique, portail client financier, et outils de collaboration financi√®re

üß† **Contexte** : Extension vers applications mobiles natives et portail client avec fonctionnalit√©s financi√®res avanc√©es, int√©gration de paiements mobiles, signature √©lectronique de documents, et outils de collaboration financi√®re temps r√©el.

üõ†Ô∏è **Fichiers** :
- `apps/mobile-finance/src/screens/FinanceDashboard.tsx`
- `apps/mobile-finance/src/components/MobilePayments.tsx`
- `apps/client-portal/app/finance/page.tsx`
- `apps/client-portal/components/finance/ClientInvoices.tsx`
- `apps/client-portal/components/finance/PaymentPortal.tsx`
- `apps/client-portal/components/finance/DocumentSigning.tsx`
- `utils/mobile-payments.ts`
- `services/electronic-signature.ts`

üîÑ **Comportement** :
Cr√©er l'application mobile finance avec : dashboard financier adaptatif, consultation des documents en d√©placement, notifications push pour √©ch√©ances et paiements, mode hors ligne avec synchronisation, g√©olocalisation pour paiements sur site.

D√©velopper les paiements mobiles avec : int√©gration Apple Pay et Google Pay, paiements par QR code, paiements de proximit√© NFC, portefeuille mobile int√©gr√©, historique des transactions s√©curis√©.

Impl√©menter le portail client financier avec : vue d'ensemble des factures et paiements, t√©l√©chargement s√©curis√© des documents, historique des transactions d√©taill√©, planificateur de paiements, chat support int√©gr√©.

Cr√©er les outils de signature √©lectronique avec : signature de devis et contrats sur mobile/tablette, validation d'identit√© renforc√©e, horodatage certifi√©, archivage s√©curis√© des documents sign√©s, workflow d'approbation multi-niveaux.

D√©velopper la collaboration financi√®re avec : partage s√©curis√© de documents financiers, annotations collaboratives sur devis, validation en temps r√©el des modifications, historique des √©changes, notifications intelligentes.

Impl√©menter l'exp√©rience de paiement optimis√©e avec : checkout en une √©tape, sauvegarde s√©curis√©e des moyens de paiement, paiements r√©currents automatiques, relances intelligentes personnalis√©es, programme de fid√©lit√© int√©gr√©.

Cr√©er les outils d'analyse client avec : dashboard financier personnalis√© pour chaque client, pr√©visions de d√©penses bas√©es sur l'historique, recommandations d'optimisation budg√©taire, comparaisons avec moyennes sectorielles.

G√©rer la s√©curit√© mobile avec : authentification biom√©trique, chiffrement local des donn√©es sensibles, d√©tection de jailbreak/root, protection contre les captures d'√©cran, session timeout adaptatif.

‚öôÔ∏è **Interactions** :
- **√âtend** : Module financier vers exp√©rience mobile et client
- **Int√®gre** : Paiements mobiles, signature √©lectronique, notifications push
- **S√©curise** : Donn√©es financi√®res sur appareils mobiles
- **Optimise** : Exp√©rience utilisateur pour contextes mobiles

üí° **Tips Windsurf** :
- Utiliser React Native pour applications mobiles performantes
- Optimiser pour diff√©rents appareils et connexions
- Tester s√©curit√© sur multiples plateformes mobiles
- Impl√©menter progressive web app pour compatibilit√©
- Cr√©er exp√©riences accessibles pour tous utilisateurs

---

## Validation et Coh√©rence Inter-Modules

### Analyse de Coh√©rence avec l'√âcosyst√®me ERP

Le module Comptabilit√© et Facturation pr√©sente une int√©gration critique et complexe avec l'ensemble de l'√©cosyst√®me ERP Wedding Collection, n√©cessitant une validation approfondie pour garantir la coh√©rence architecturale, fonctionnelle, et la conformit√© r√©glementaire.

L'**int√©gration avec le module Clients** constitue une d√©pendance fondamentale, le module Comptabilit√© et Facturation consommant les donn√©es client pour la facturation tout en enrichissant le profil client avec l'historique financier. La coh√©rence des donn√©es client doit √™tre maintenue entre les modules, avec synchronisation des informations de facturation, conditions commerciales, et statut de solvabilit√©. Les permissions d'acc√®s aux donn√©es financi√®res doivent respecter les r√¥les d√©finis dans le module Clients.

L'**extension du module Suivi des Mariages** repr√©sente une relation architecturale critique, le module Comptabilit√© et Facturation mat√©rialisant financi√®rement les prestations suivies dans les mariages. Cette int√©gration n√©cessite une synchronisation des √©ch√©ances financi√®res avec le planning des mariages, une coh√©rence des montants contractuels avec les prestataires, et une tra√ßabilit√© compl√®te entre suivi op√©rationnel et facturation.

L'**int√©gration avec le module Lieux** implique la facturation automatique des r√©servations de lieux avec application des tarifications configur√©es, gestion des acomptes et soldes selon les conditions d√©finies, et synchronisation des annulations avec les politiques de remboursement. Les donn√©es tarifaires doivent √™tre coh√©rentes entre les modules.

La **pr√©paration pour les modules futurs** (Prestataires, Contrats) n√©cessite une architecture extensible qui permette l'int√©gration des facturations prestataires, la gestion des contrats complexes, et l'√©volution vers une comptabilit√© analytique avanc√©e.

### Recommandations d'Harmonisation

L'**impl√©mentation d'un syst√®me d'√©v√©nements financiers unifi√©** permettrait une communication asynchrone standardis√©e entre tous les modules. Les √©v√©nements `invoice_created`, `payment_received`, `document_overdue` pourraient d√©clencher des actions automatis√©es dans les modules d√©pendants.

L'**adoption d'un cache financier centralis√©** am√©liorerait les performances en √©vitant la duplication des calculs de totaux, soldes, et m√©triques financi√®res. Un cache Redis sp√©cialis√© pourrait stocker les donn√©es financi√®res fr√©quemment consult√©es.

L'**standardisation des APIs financi√®res inter-modules** faciliterait l'int√©gration en d√©finissant des contrats d'interface clairs pour les op√©rations financi√®res. Cette approche permettrait l'√©volution ind√©pendante des modules tout en maintenant la coh√©rence financi√®re.

### √âl√©ments Manquants Identifi√©s

Un **syst√®me de budgets et pr√©visions** pourrait √™tre d√©velopp√© pour permettre la planification financi√®re avanc√©e, le suivi des √©carts budg√©taires, et l'optimisation de la rentabilit√© par type d'√©v√©nement.

Un **module de gestion des devises** pourrait √™tre int√©gr√© pour supporter les clients internationaux, avec gestion des taux de change, facturation multi-devises, et comptabilisation des √©carts de change.

Un **syst√®me de comptabilit√© analytique** pourrait analyser la rentabilit√© par √©v√©nement, client, commercial, et type de prestation, avec allocation automatique des co√ªts et calcul de marges d√©taill√©es.

Cette analyse de coh√©rence garantit une int√©gration harmonieuse du module Comptabilit√© et Facturation dans l'√©cosyst√®me ERP Wedding Collection, assurant la conformit√© r√©glementaire et l'optimisation des processus financiers.

