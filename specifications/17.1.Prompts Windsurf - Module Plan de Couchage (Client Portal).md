# Prompts Windsurf - Module Plan de Couchage (Client Portal)

## 🎯 Vue d'Ensemble

Ce document fournit une séquence complète de **14 prompts Windsurf** pour développer le **Module Plan de Couchage** du Client Portal Wedding Collection. Chaque prompt est optimisé pour exploiter les capacités spécifiques de Windsurf (Cascade, Supercomplete, MCP) et s'intègre parfaitement avec l'écosystème Client Portal existant.

### 📋 Architecture Cible
```
apps/client-portal/src/
├── components/accommodation/     # Composants du module Plan de Couchage
├── pages/accommodation/         # Pages du module
├── hooks/accommodation/         # Hooks spécialisés
├── services/accommodation/      # Services API
└── types/accommodation/         # Types TypeScript
```

### 🔄 Intégrations Client Portal
- **Module Invités** : Synchronisation des données d'invités pour attribution
- **Module Plan de Salle** : Navigation contextuelle et cohérence UX
- **Module Événement** : Contexte temporel et informations générales
- **Backoffice** : Données des lieux et chambres disponibles

---

## 📚 Section 1 : Initialisation (4 prompts)

### Prompt 1 : Création du Schéma de Base de Données Accommodation

🎯 **But** : Créer le schéma de base de données complet pour le module Plan de Couchage avec tables, relations, contraintes et politiques RLS.

🧠 **Contexte technique** : Extension de la base Supabase existante avec nouvelles tables spécialisées pour la gestion des plans de couchage, intégration avec les modules existants du Client Portal.

🛠️ **Fichiers concernés** :
- `supabase/migrations/[timestamp]_create_accommodation_schema.sql`
- `supabase/migrations/[timestamp]_create_accommodation_rls.sql`
- `supabase/migrations/[timestamp]_create_accommodation_functions.sql`

🔄 **Comportement attendu** :
- Table `accommodation_plan` avec versionnement et workflow d'approbation
- Table `selected_room_configuration` pour configurations de chambres par plan
- Table `guest_accommodation` pour attributions invités-chambres avec dates
- Table `accommodation_logistics` pour besoins logistiques calculés
- Relations FK avec tables existantes (events, guests, venues)
- Contraintes d'intégrité et validation métier
- Politiques RLS pour sécurité granulaire par client
- Fonctions RPC pour calculs logistiques et duplication de plans
- Triggers pour mise à jour automatique des timestamps et calculs

⚙️ **Interactions avec autres modules** :
- Référence à `events` pour contexte événement
- Référence à `guests` pour données invités
- Référence à `venues` et `rooms` pour données chambres
- Intégration avec système d'audit existant

💡 **Tips Windsurf** :
- Utilise MCP Supabase pour générer automatiquement les migrations
- Exploite Cascade pour analyser les schémas existants et assurer cohérence
- Configure les index pour optimiser les requêtes de recherche et filtrage

---

### Prompt 2 : Génération des Types TypeScript et Validation Zod

🎯 **But** : Générer les types TypeScript complets et schémas de validation Zod pour toutes les entités du module Plan de Couchage.

🧠 **Contexte technique** : Types strictement typés pour garantir la cohérence entre frontend et backend, avec validation robuste des données utilisateur.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/types/accommodation/index.ts`
- `apps/client-portal/src/types/accommodation/plan.ts`
- `apps/client-portal/src/types/accommodation/room.ts`
- `apps/client-portal/src/types/accommodation/guest.ts`
- `apps/client-portal/src/lib/validations/accommodation.ts`

🔄 **Comportement attendu** :
- Types TypeScript générés depuis schéma Supabase
- Interfaces pour AccommodationPlan, RoomConfiguration, GuestAccommodation
- Types pour états UI (loading, error, success)
- Enums pour statuts, types de lits, préférences
- Schémas Zod pour validation formulaires et API
- Types pour drag-and-drop et interactions UI
- Utilitaires de transformation et mapping
- Types pour exports et rapports

⚙️ **Interactions avec autres modules** :
- Extension des types Guest existants avec données hébergement
- Réutilisation des types Event et Venue
- Cohérence avec types Plan de Salle

💡 **Tips Windsurf** :
- Utilise la génération automatique de types depuis Supabase
- Exploite Supercomplete pour cohérence avec types existants
- Configure la validation Zod avec messages d'erreur personnalisés

---

### Prompt 3 : Architecture des Services et Hooks Accommodation

🎯 **But** : Créer l'architecture des services API et hooks React pour la gestion complète des plans de couchage.

🧠 **Contexte technique** : Services robustes avec gestion d'erreurs, cache intelligent et hooks React optimisés pour performance et expérience utilisateur.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/services/accommodation/planService.ts`
- `apps/client-portal/src/services/accommodation/roomService.ts`
- `apps/client-portal/src/services/accommodation/guestService.ts`
- `apps/client-portal/src/hooks/accommodation/useAccommodationPlan.ts`
- `apps/client-portal/src/hooks/accommodation/useRoomConfiguration.ts`
- `apps/client-portal/src/hooks/accommodation/useGuestAssignment.ts`

🔄 **Comportement attendu** :
- Service planService avec CRUD complet et duplication
- Service roomService pour configuration chambres et calculs capacité
- Service guestService pour attribution et gestion préférences
- Hook useAccommodationPlan avec cache et synchronisation temps réel
- Hook useRoomConfiguration avec validation contraintes
- Hook useGuestAssignment avec drag-and-drop et optimistic updates
- Gestion d'erreurs centralisée avec retry automatique
- Cache intelligent avec invalidation sélective

⚙️ **Interactions avec autres modules** :
- Intégration avec services Guest et Event existants
- Synchronisation avec module Plan de Salle
- Utilisation des hooks d'authentification

💡 **Tips Windsurf** :
- Utilise React Query pour cache et synchronisation optimisés
- Implémente les optimistic updates pour fluidité UX
- Configure les webhooks Supabase pour temps réel

---

### Prompt 4 : Configuration des Contextes et État Global

🎯 **But** : Configurer les contextes React et la gestion d'état global pour le module Plan de Couchage avec performance optimisée.

🧠 **Contexte technique** : Architecture d'état modulaire avec contextes spécialisés et optimisations pour éviter les re-renders inutiles.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/contexts/accommodation/AccommodationPlanContext.tsx`
- `apps/client-portal/src/contexts/accommodation/RoomConfigurationContext.tsx`
- `apps/client-portal/src/contexts/accommodation/GuestAssignmentContext.tsx`
- `apps/client-portal/src/contexts/accommodation/AccommodationProvider.tsx`

🔄 **Comportement attendu** :
- AccommodationPlanContext pour état global du plan actuel
- RoomConfigurationContext pour configuration chambres et filtres
- GuestAssignmentContext pour état drag-and-drop et sélections
- Provider principal avec composition des contextes
- Optimisations avec useMemo et useCallback
- Persistance locale pour brouillons et préférences
- Gestion des états de chargement et d'erreur
- Actions typées avec useReducer pour logique complexe

⚙️ **Interactions avec autres modules** :
- Intégration avec AuthContext existant
- Synchronisation avec EventContext
- Partage d'état avec module Plan de Salle

💡 **Tips Windsurf** :
- Utilise la composition de contextes pour éviter prop drilling
- Implémente la mémorisation pour optimiser les performances
- Configure la persistance avec localStorage pour UX améliorée

---

## 🏗️ Section 2 : Fonctionnalités Principales (4 prompts)

### Prompt 5 : Interface de Gestion des Plans de Couchage

🎯 **But** : Développer l'interface principale de gestion des plans de couchage avec création, édition, versionnement et workflow d'approbation.

🧠 **Contexte technique** : Interface centrale du module avec navigation intuitive, gestion des versions et workflow collaboratif pour validation des plans.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/pages/accommodation/AccommodationPlansPage.tsx`
- `apps/client-portal/src/components/accommodation/PlanList.tsx`
- `apps/client-portal/src/components/accommodation/PlanCard.tsx`
- `apps/client-portal/src/components/accommodation/CreatePlanModal.tsx`
- `apps/client-portal/src/components/accommodation/PlanVersionHistory.tsx`

🔄 **Comportement attendu** :
- Liste des plans avec filtres par statut et date
- Cartes de plans avec aperçu et actions rapides
- Modal de création avec templates et duplication
- Historique des versions avec diff visuel
- Workflow d'approbation avec commentaires
- Actions en lot pour gestion multiple
- Recherche et tri avancés
- Export des plans en différents formats

⚙️ **Interactions avec autres modules** :
- Navigation vers module Plan de Salle
- Synchronisation avec données Event
- Intégration avec système de notifications

💡 **Tips Windsurf** :
- Utilise les composants shadcn/ui pour cohérence visuelle
- Implémente la virtualisation pour performance avec nombreux plans
- Configure les shortcuts clavier pour productivité

---



### Prompt 6 : Interface de Configuration des Chambres

🎯 **But** : Développer l'interface de configuration des chambres avec visualisation, gestion des types de lits et capacités.

🧠 **Contexte technique** : Interface visuelle permettant aux clients de définir la configuration exacte de chaque chambre disponible pour leur événement.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/pages/accommodation/RoomConfigurationPage.tsx`
- `apps/client-portal/src/components/accommodation/RoomList.tsx`
- `apps/client-portal/src/components/accommodation/RoomDetailEditor.tsx`
- `apps/client-portal/src/components/accommodation/BedTypeSelector.tsx`
- `apps/client-portal/src/components/accommodation/RoomCapacityCalculator.tsx`

🔄 **Comportement attendu** :
- Liste des chambres disponibles avec filtres par bâtiment/étage
- Éditeur visuel pour chaque chambre avec placement des lits
- Sélection des types de lits (simple, double, queen, king, etc.)
- Calcul automatique de la capacité maximale par chambre
- Gestion des caractéristiques spéciales (accessibilité, vue, etc.)
- Sauvegarde automatique des configurations
- Validation des contraintes (espace minimum, etc.)
- Aperçu 3D simplifié (optionnel)

⚙️ **Interactions avec autres modules** :
- Données initiales des chambres depuis module Lieu (Backoffice)
- Impact sur calculs logistiques
- Utilisation dans interface d'attribution

💡 **Tips Windsurf** :
- Utilise React Konva ou une librairie similaire pour l'éditeur visuel
- Implémente la sauvegarde automatique avec debouncing
- Configure les règles de validation métier côté serveur

---

### Prompt 7 : Interface d'Attribution des Invités (Drag-and-Drop)

🎯 **But** : Créer l'interface principale d'attribution des invités aux chambres avec drag-and-drop intuitif et validation des contraintes.

🧠 **Contexte technique** : Cœur fonctionnel du module nécessitant une UX fluide, des validations en temps réel et une gestion efficace des grands volumes de données.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/pages/accommodation/GuestAssignmentPage.tsx`
- `apps/client-portal/src/components/accommodation/GuestListPanel.tsx`
- `apps/client-portal/src/components/accommodation/RoomAssignmentGrid.tsx`
- `apps/client-portal/src/components/accommodation/GuestCardDraggable.tsx`
- `apps/client-portal/src/components/accommodation/RoomDropTarget.tsx`

🔄 **Comportement attendu** :
- Panneau latéral avec liste des invités non assignés (filtrable/triable)
- Grille visuelle représentant les chambres et leurs lits
- Drag-and-drop des invités depuis la liste vers les lits
- Validation en temps réel (capacité, préférences, compatibilité)
- Feedback visuel pour attributions valides/invalides
- Gestion des groupes d'invités (familles, amis)
- Attribution rapide par groupe
- Indicateurs visuels (statut, préférences)
- Sauvegarde automatique avec optimistic updates

⚙️ **Interactions avec autres modules** :
- Données invités depuis module Invités
- Configuration chambres depuis étape précédente
- Impact sur calculs logistiques

💡 **Tips Windsurf** :
- Utilise React DnD pour implémentation drag-and-drop robuste
- Optimise les performances avec virtualisation et mémorisation
- Implémente les optimistic updates pour fluidité maximale

---

### Prompt 8 : Calcul et Affichage des Besoins Logistiques

🎯 **But** : Implémenter le calcul automatique et l'affichage des besoins logistiques (draps, serviettes, etc.) basés sur les attributions.

🧠 **Contexte technique** : Fonctionnalité clé pour la préparation opérationnelle avec calculs côté serveur et affichage clair pour les équipes logistiques.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/pages/accommodation/LogisticsPage.tsx`
- `apps/client-portal/src/components/accommodation/LogisticsSummary.tsx`
- `apps/client-portal/src/components/accommodation/LogisticsTable.tsx`
- `apps/client-portal/src/services/accommodation/logisticsService.ts` (appel RPC)
- `supabase/migrations/[timestamp]_create_accommodation_functions.sql` (fonction RPC)

🔄 **Comportement attendu** :
- Fonction RPC Supabase pour calculer les besoins logistiques
- Tableau récapitulatif des besoins par type d'article
- Vue détaillée par chambre ou par invité
- Filtres par date (check-in/check-out)
- Export des besoins en CSV/Excel
- Impression d'étiquettes pour préparation
- Mise à jour automatique lors de modifications d'attribution
- Gestion des stocks (optionnel, via Backoffice)

⚙️ **Interactions avec autres modules** :
- Basé sur données GuestAccommodation et RoomConfiguration
- Export vers module Planning Ménage (Backoffice)
- Intégration avec système de reporting

💡 **Tips Windsurf** :
- Implémente la logique de calcul dans une fonction RPC PostgreSQL pour performance
- Utilise React Table pour affichage tabulaire avancé
- Configure la mise à jour automatique avec Supabase Realtime ou polling

---



## 🎨 Section 3 : Fonctionnalités Secondaires (3 prompts)

### Prompt 9 : Système d'Export et de Rapports

🎯 **But** : Développer le système complet d'export et de génération de rapports pour les plans de couchage avec formats multiples.

🧠 **Contexte technique** : Fonctionnalité essentielle pour communication avec invités et équipes opérationnelles, nécessitant génération côté serveur et templates personnalisables.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/components/accommodation/ExportModal.tsx`
- `apps/client-portal/src/services/accommodation/exportService.ts`
- `apps/client-portal/src/utils/accommodation/reportGenerator.ts`
- `supabase/functions/generate-accommodation-report/index.ts` (Edge Function)

🔄 **Comportement attendu** :
- Modal d'export avec sélection de format (PDF, Excel, CSV)
- Templates personnalisables pour différents destinataires
- Rapport complet pour équipe logistique
- Liste d'attribution pour invités
- Étiquettes pour préparation des chambres
- Export CSV pour intégration avec autres systèmes
- Génération asynchrone avec notification de fin
- Historique des exports avec téléchargement

⚙️ **Interactions avec autres modules** :
- Utilisation des données de tous les composants du module
- Intégration avec système de notifications
- Partage avec module Communication (envoi aux invités)

💡 **Tips Windsurf** :
- Utilise Supabase Edge Functions pour génération PDF côté serveur
- Implémente les templates avec une librairie comme Puppeteer ou jsPDF
- Configure la génération asynchrone avec queue de traitement

---

### Prompt 10 : Interface de Collaboration et Commentaires

🎯 **But** : Implémenter les fonctionnalités de collaboration avec commentaires, suggestions et workflow d'approbation.

🧠 **Contexte technique** : Fonctionnalités collaboratives permettant aux différents acteurs (clients, wedding planners, équipe) de collaborer efficacement sur les plans.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/components/accommodation/CommentSystem.tsx`
- `apps/client-portal/src/components/accommodation/ApprovalWorkflow.tsx`
- `apps/client-portal/src/components/accommodation/ChangeHistory.tsx`
- `apps/client-portal/src/hooks/accommodation/useCollaboration.ts`

🔄 **Comportement attendu** :
- Système de commentaires contextuels par chambre ou invité
- Workflow d'approbation avec étapes configurables
- Historique des modifications avec diff visuel
- Notifications temps réel pour changements
- Suggestions d'amélioration automatiques
- Gestion des permissions par rôle utilisateur
- Mode révision avec validation/rejet
- Intégration avec système de notifications global

⚙️ **Interactions avec autres modules** :
- Utilisation du système d'authentification et de rôles
- Intégration avec module Notifications
- Synchronisation avec Backoffice pour validation finale

💡 **Tips Windsurf** :
- Utilise Supabase Realtime pour collaboration temps réel
- Implémente les commentaires avec rich text editor
- Configure les permissions granulaires avec RLS

---

### Prompt 11 : Intégration avec Module Plan de Salle

🎯 **But** : Créer l'intégration bidirectionnelle avec le module Plan de Salle pour navigation contextuelle et cohérence des données.

🧠 **Contexte technique** : Intégration étroite entre les deux modules de planification pour offrir une expérience utilisateur fluide et cohérente.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/components/accommodation/SeatingPlanIntegration.tsx`
- `apps/client-portal/src/hooks/accommodation/useSeatingPlanSync.ts`
- `apps/client-portal/src/services/accommodation/integrationService.ts`

🔄 **Comportement attendu** :
- Navigation contextuelle entre plan de salle et plan de couchage
- Synchronisation des données invités entre les deux modules
- Indicateurs visuels de cohérence/incohérence
- Suggestions d'attribution basées sur plan de salle
- Vue combinée optionnelle (split screen)
- Validation croisée des attributions
- Mise à jour automatique lors de changements
- Résolution assistée des conflits

⚙️ **Interactions avec autres modules** :
- Intégration directe avec module Plan de Salle
- Partage des données invités et événement
- Utilisation des mêmes services de base

💡 **Tips Windsurf** :
- Utilise les hooks partagés entre les deux modules
- Implémente la synchronisation avec événements personnalisés
- Configure la validation croisée avec règles métier

---

## 🚀 Section 4 : Évolutions Futures (3 prompts)

### Prompt 12 : Intelligence Artificielle et Suggestions Automatiques

🎯 **But** : Implémenter des fonctionnalités d'IA pour suggestions automatiques d'attribution et optimisation des plans de couchage.

🧠 **Contexte technique** : Fonctionnalités avancées utilisant l'IA pour améliorer l'efficacité de la planification et proposer des optimisations intelligentes.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/services/accommodation/aiService.ts`
- `apps/client-portal/src/components/accommodation/AISuggestions.tsx`
- `apps/client-portal/src/utils/accommodation/optimizationAlgorithms.ts`
- `supabase/functions/ai-accommodation-optimizer/index.ts` (Edge Function)

🔄 **Comportement attendu** :
- Algorithme d'attribution automatique basé sur préférences
- Suggestions d'optimisation pour maximiser satisfaction
- Détection automatique des conflits potentiels
- Recommandations basées sur historique d'événements similaires
- Analyse prédictive des besoins logistiques
- Optimisation automatique de l'occupation des chambres
- Apprentissage des préférences utilisateur
- Intégration avec services d'IA externes (OpenAI, etc.)

⚙️ **Interactions avec autres modules** :
- Utilisation des données historiques de tous les modules
- Intégration avec module Analytics pour apprentissage
- Connexion avec services d'IA externes

💡 **Tips Windsurf** :
- Utilise Supabase Edge Functions pour traitement IA côté serveur
- Implémente les algorithmes d'optimisation avec des librairies spécialisées
- Configure l'apprentissage automatique avec feedback utilisateur

---

### Prompt 13 : Réalité Augmentée et Visualisation 3D

🎯 **But** : Développer des fonctionnalités de visualisation 3D et réalité augmentée pour une expérience immersive de planification.

🧠 **Contexte technique** : Technologies émergentes pour offrir une expérience de planification révolutionnaire avec visualisation immersive des espaces.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/components/accommodation/Room3DViewer.tsx`
- `apps/client-portal/src/components/accommodation/ARVisualization.tsx`
- `apps/client-portal/src/services/accommodation/3dService.ts`
- `apps/client-portal/src/utils/accommodation/3dRenderer.ts`

🔄 **Comportement attendu** :
- Visualisation 3D des chambres avec placement des lits
- Mode réalité augmentée pour visualisation in-situ
- Visite virtuelle des espaces d'hébergement
- Simulation de l'occupation des chambres
- Intégration avec données de géolocalisation
- Export de modèles 3D pour partage
- Compatibilité avec casques VR/AR
- Optimisation pour appareils mobiles

⚙️ **Interactions avec autres modules** :
- Utilisation des données de configuration des chambres
- Intégration avec module Lieu pour modèles 3D
- Connexion avec services de géolocalisation

💡 **Tips Windsurf** :
- Utilise Three.js ou React Three Fiber pour rendu 3D
- Implémente la réalité augmentée avec WebXR ou AR.js
- Configure le lazy loading pour optimiser les performances

---

### Prompt 14 : Intégration IoT et Automatisation

🎯 **But** : Préparer l'intégration avec objets connectés et systèmes d'automatisation pour gestion intelligente de l'hébergement.

🧠 **Contexte technique** : Préparation pour l'avenir avec intégration IoT pour automatisation de la préparation des chambres et suivi en temps réel.

🛠️ **Fichiers concernés** :
- `apps/client-portal/src/services/accommodation/iotService.ts`
- `apps/client-portal/src/components/accommodation/IoTDashboard.tsx`
- `apps/client-portal/src/hooks/accommodation/useIoTDevices.ts`
- `supabase/functions/iot-accommodation-handler/index.ts` (Edge Function)

🔄 **Comportement attendu** :
- Interface de gestion des dispositifs IoT par chambre
- Automatisation de la préparation des chambres
- Capteurs d'occupation et de température
- Contrôle automatique de l'éclairage et climatisation
- Notifications automatiques de statut des chambres
- Intégration avec systèmes de domotique
- Tableau de bord temps réel des dispositifs
- Gestion des alertes et maintenance préventive

⚙️ **Interactions avec autres modules** :
- Synchronisation avec planning de préparation
- Intégration avec module Planning Ménage (Backoffice)
- Connexion avec systèmes de gestion technique du bâtiment

💡 **Tips Windsurf** :
- Utilise MQTT ou WebSockets pour communication IoT
- Implémente les protocoles standard (Zigbee, Z-Wave, etc.)
- Configure la sécurité renforcée pour dispositifs connectés

---

## 🎯 Résumé et Ordre d'Exécution

### ✅ Ordre d'Exécution Recommandé

1. **Phase Initialisation (Prompts 1-4)** : Fondations techniques solides
2. **Phase Fonctionnalités Principales (Prompts 5-8)** : Cœur fonctionnel du module
3. **Phase Fonctionnalités Secondaires (Prompts 9-11)** : Enrichissement de l'expérience
4. **Phase Évolutions Futures (Prompts 12-14)** : Innovations et technologies émergentes

### 🔧 Points d'Attention Spécifiques

- **Performance** : Optimisation critique pour drag-and-drop avec nombreux invités
- **UX** : Interface intuitive essentielle pour adoption utilisateur
- **Intégration** : Synchronisation parfaite avec module Plan de Salle
- **Validation** : Contraintes métier robustes pour éviter erreurs d'attribution

### 🚀 Résultat Final

Un module Plan de Couchage complet offrant :
- Interface drag-and-drop intuitive pour attribution des invités
- Calcul automatique des besoins logistiques
- Intégration parfaite avec l'écosystème Client Portal
- Fonctionnalités collaboratives avancées
- Exports et rapports professionnels
- Évolutivité vers technologies émergentes

**Le module Plan de Couchage enrichira significativement l'expérience Client Portal en simplifiant la gestion complexe de l'hébergement des invités ! 🎉**

