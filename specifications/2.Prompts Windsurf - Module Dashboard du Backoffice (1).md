# Prompts Windsurf - Module Dashboard du Backoffice

## ğŸ“‹ Informations du Module

- **Module** : Dashboard du Backoffice
- **Identifiant technique** : `backoffice_dashboard`
- **Version** : 1.0.0
- **Application** : Backoffice (`apps/backoffice`)
- **PrioritÃ©** : P0 (Critique - Interface centrale d'administration)
- **DÃ©pendances** : Module Initialisation Monorepo, Console Admin, modules mÃ©tier (Leads, Clients, Ã‰vÃ©nements)
- **SchÃ©ma DB** : `bo` (table `dashboard_user_settings`)

---

## ğŸ¯ Vue d'Ensemble du Module

Le module Dashboard du Backoffice constitue le point d'entrÃ©e principal et le centre de contrÃ´le visuel pour les utilisateurs internes de l'ERP Wedding Collection. Il agit comme une interface centralisÃ©e et personnalisable qui agrÃ¨ge et prÃ©sente de maniÃ¨re synthÃ©tique les informations clÃ©s dispersÃ©es dans les diffÃ©rents modules opÃ©rationnels.

Ce module s'intÃ¨gre dans l'application `apps/backoffice` du monorepo et utilise une architecture frontend-lourde avec React/TypeScript, consommant des donnÃ©es via des fonctions RPC Supabase optimisÃ©es. Il offre des widgets configurables (KPIs, calendrier, tÃ¢ches, notifications) avec personnalisation par utilisateur et adaptation selon les rÃ´les.

---

## ğŸš€ Section 1 : Initialisation

### 01 - CrÃ©ation de la table bo.dashboard_user_settings avec RLS

ğŸ¯ **But clair**
CrÃ©er la table `bo.dashboard_user_settings` dans Supabase pour stocker les configurations personnalisÃ©es des dashboards utilisateurs avec les politiques RLS appropriÃ©es et les triggers de mise Ã  jour.

ğŸ§  **Contexte technique**
Cette table stocke les configurations personnalisÃ©es des dashboards dans un champ JSONB. Elle respecte les conventions Supabase du projet avec RLS activÃ©e, permettant Ã  chaque utilisateur de gÃ©rer sa propre configuration tout en autorisant les admins ERP Ã  gÃ©rer toutes les configurations.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Migration Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Table avec champs : id, user_id, dashboard_configuration (JSONB), created_at, updated_at, created_by, updated_by
- Contrainte unique sur user_id (une config par utilisateur)
- RLS avec politiques pour SELECT, INSERT, UPDATE, DELETE
- Trigger pour updated_at automatique
- Politiques permettant aux admins ERP de gÃ©rer toutes les configurations

âš™ï¸ **Interactions avec d'autres modules**
- RÃ©fÃ©rence : auth.users (user_id, created_by, updated_by)
- UtilisÃ© par : fonctions RPC du dashboard
- IntÃ¨gre : systÃ¨me de permissions admin_console

ğŸ’¡ **Tips Windsurf**
- Utiliser le MCP Supabase pour exÃ©cuter directement la migration
- VÃ©rifier que la fonction shared.update_updated_at_column() existe
- Tester les politiques RLS avec diffÃ©rents rÃ´les utilisateur
- Valider la structure JSONB avec des exemples de configuration

---

### 02 - CrÃ©ation des fonctions RPC pour la gestion des configurations

ğŸ¯ **But clair**
CrÃ©er les fonctions RPC Supabase pour rÃ©cupÃ©rer et sauvegarder les configurations de dashboard utilisateur avec gestion des configurations par dÃ©faut selon les rÃ´les et validation des permissions.

ğŸ§  **Contexte technique**
Ces fonctions RPC centralisent la logique de gestion des configurations dashboard. Elles gÃ¨rent les configurations personnalisÃ©es, les configurations par dÃ©faut par rÃ´le, et la validation des permissions via le systÃ¨me admin_console.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Fonctions RPC Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- `rpc_get_user_dashboard_config()` : rÃ©cupÃ¨re la config utilisateur ou par dÃ©faut selon le rÃ´le
- `rpc_save_dashboard_config(p_config JSONB)` : sauvegarde la config avec validation
- VÃ©rification des permissions dashboard:read et dashboard:personalize
- Gestion des configurations par dÃ©faut par rÃ´le (admin_erp, wedding_planner, etc.)
- Validation de la structure JSONB des configurations

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : admin_console.vw_user_permissions pour les permissions
- RÃ©fÃ©rence : admin_console.user_roles et admin_console.roles
- IntÃ¨gre : systÃ¨me d'authentification Supabase Auth
- AccÃ¨de : bo.dashboard_user_settings

ğŸ’¡ **Tips Windsurf**
- Utiliser SECURITY DEFINER pour les fonctions RPC
- ImplÃ©menter une validation robuste de la structure JSONB
- GÃ©rer les cas d'erreur avec des messages explicites
- Tester avec diffÃ©rents rÃ´les et permissions

---

### 03 - CrÃ©ation des fonctions RPC pour les KPIs du dashboard

ğŸ¯ **But clair**
CrÃ©er la fonction RPC `rpc_get_dashboard_kpis()` pour calculer et retourner les indicateurs clÃ©s de performance avec support des pÃ©riodes configurables et comparaisons avec les pÃ©riodes prÃ©cÃ©dentes.

ğŸ§  **Contexte technique**
Cette fonction RPC calcule dynamiquement les KPIs selon les codes demandÃ©s et la pÃ©riode spÃ©cifiÃ©e. Elle effectue des requÃªtes optimisÃ©es sur les tables mÃ©tier et retourne des donnÃ©es structurÃ©es avec valeurs actuelles et comparaisons historiques.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Fonction RPC Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- ParamÃ¨tres : p_kpi_codes (TEXT[]), p_period (TEXT)
- Calcul des KPIs : leads_new, leads_converted, events_upcoming, revenue_total
- Support des pÃ©riodes : 7d, 30d, mtd, ytd
- Comparaison avec pÃ©riode prÃ©cÃ©dente pour tendances
- VÃ©rification permission dashboard:read
- Retour JSONB structurÃ© avec mÃ©tadonnÃ©es

âš™ï¸ **Interactions avec d'autres modules**
- AccÃ¨de : bo.leads, shared.evenements, bo.factures (selon KPIs)
- Utilise : admin_console.vw_user_permissions
- Peut Ãªtre Ã©tendu : avec d'autres modules mÃ©tier
- OptimisÃ© : pour performances avec index appropriÃ©s

ğŸ’¡ **Tips Windsurf**
- Optimiser les requÃªtes avec des CTE pour la lisibilitÃ©
- ImplÃ©menter un cache cÃ´tÃ© application si nÃ©cessaire
- GÃ©rer les cas oÃ¹ certaines tables n'existent pas encore
- Documenter chaque KPI avec des commentaires SQL

---

### 04 - CrÃ©ation des fonctions RPC pour les tÃ¢ches et calendrier

ğŸ¯ **But clair**
CrÃ©er les fonctions RPC `rpc_get_user_tasks()` et `rpc_get_user_calendar_events()` pour alimenter les widgets tÃ¢ches et calendrier avec filtrage par utilisateur et permissions appropriÃ©es.

ğŸ§  **Contexte technique**
Ces fonctions RPC fournissent les donnÃ©es pour les widgets interactifs du dashboard. Elles filtrent les donnÃ©es selon l'utilisateur connectÃ© et ses permissions, optimisent les requÃªtes pour les performances et structurent les donnÃ©es pour l'affichage frontend.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Fonctions RPC Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- `rpc_get_user_tasks()` : tÃ¢ches assignÃ©es Ã  l'utilisateur avec filtres
- `rpc_get_user_calendar_events()` : Ã©vÃ©nements pertinents pour l'utilisateur
- Filtrage par statut, prioritÃ©, Ã©chÃ©ance pour les tÃ¢ches
- Filtrage par date, type, permissions pour les Ã©vÃ©nements
- Support pagination et tri
- VÃ©rification des permissions appropriÃ©es

âš™ï¸ **Interactions avec d'autres modules**
- AccÃ¨de : bo.tasks, shared.evenements (ou tables Ã©quivalentes)
- Utilise : systÃ¨me de permissions admin_console
- IntÃ¨gre : filtrage RLS des modules source
- OptimisÃ© : avec index sur les champs de filtrage

ğŸ’¡ **Tips Windsurf**
- Utiliser les politiques RLS existantes des modules source
- ImplÃ©menter des paramÃ¨tres de pagination efficaces
- Structurer le retour JSON pour faciliter l'affichage
- PrÃ©voir l'extension avec d'autres types de donnÃ©es

---

### 05 - Configuration TypeScript pour le module Dashboard

ğŸ¯ **But clair**
CrÃ©er les types TypeScript spÃ©cifiques au module Dashboard incluant les interfaces pour les configurations, widgets, KPIs et donnÃ©es des fonctions RPC avec intÃ©gration des types Supabase gÃ©nÃ©rÃ©s.

ğŸ§  **Contexte technique**
Ces types assurent la cohÃ©rence entre les donnÃ©es Supabase et l'interface React. Ils dÃ©finissent la structure des configurations dashboard, des widgets, et des rÃ©ponses RPC pour un dÃ©veloppement type-safe et une maintenance facilitÃ©e.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts` - Types TypeScript

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Types pour DashboardConfiguration, Widget, KPI, Task, CalendarEvent
- Interfaces pour les rÃ©ponses RPC (GetKpisResponse, GetTasksResponse, etc.)
- Types pour les configurations de widgets (KpiConfig, TasksConfig, etc.)
- Ã‰numÃ©rations pour les pÃ©riodes, types de widgets, statuts
- IntÃ©gration avec les types gÃ©nÃ©rÃ©s par Supabase
- Types pour les props des composants React

âš™ï¸ **Interactions avec d'autres modules**
- Ã‰tend : types gÃ©nÃ©rÃ©s par Supabase
- UtilisÃ© par : tous les composants React du dashboard
- IntÃ¨gre : types des modules mÃ©tier (leads, events, tasks)
- PartagÃ© : via le package types du monorepo

ğŸ’¡ **Tips Windsurf**
- Utiliser `supabase gen types` pour synchroniser avec la DB
- CrÃ©er des types dÃ©rivÃ©s pour les diffÃ©rents Ã©tats des widgets
- ImplÃ©menter la validation runtime avec Zod si nÃ©cessaire
- Organiser les types par domaine (config, widgets, data)

---

### 06 - Configuration du service API Dashboard

ğŸ¯ **But clair**
CrÃ©er le service API Dashboard qui encapsule toutes les interactions avec Supabase pour le module, incluant la gestion des configurations, l'appel des RPC et la gestion d'erreurs standardisÃ©e.

ğŸ§  **Contexte technique**
Ce service centralise la logique d'accÃ¨s aux donnÃ©es pour le dashboard. Il utilise le client Supabase du package api-client, implÃ©mente la gestion d'erreurs du projet et fournit une interface typÃ©e pour les composants React.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts` - Service API

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- MÃ©thodes pour configuration : getUserConfig(), saveUserConfig()
- MÃ©thodes pour donnÃ©es : getKpis(), getUserTasks(), getCalendarEvents()
- Gestion d'erreurs avec types d'erreur spÃ©cifiques
- Cache cÃ´tÃ© client pour optimiser les performances
- Retry automatique pour les requÃªtes Ã©chouÃ©es
- Logging pour le debugging et monitoring

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : @wedding-collection/api-client
- IntÃ¨gre : types du module dashboard
- DÃ©pend : configuration Supabase du monorepo
- UtilisÃ© par : hooks React et composants

ğŸ’¡ **Tips Windsurf**
- Utiliser TanStack Query pour la gestion du cache et des Ã©tats
- ImplÃ©menter des mÃ©thodes optimistes pour les mises Ã  jour
- Ajouter des logs dÃ©taillÃ©s pour faciliter le debugging
- CrÃ©er des wrappers typÃ©s pour chaque RPC

---

### 07 - CrÃ©ation de la sidebar de navigation globale du Backoffice

ğŸ¯ **But clair**
CrÃ©er la sidebar de navigation principale du Backoffice avec tous les modules de l'ERP Wedding Collection, gestion des permissions par rÃ´le et navigation hiÃ©rarchique responsive.

ğŸ§  **Contexte technique**
Cette sidebar constitue la navigation principale de l'application Backoffice. Elle affiche tous les modules selon les permissions utilisateur, gÃ¨re la navigation hiÃ©rarchique et s'intÃ¨gre parfaitement avec le layout global. Elle utilise ShadCN UI pour la cohÃ©rence visuelle.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composant React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Navigation hiÃ©rarchique avec sections : Administration, Gestion MÃ©tier, Marketing & Outils
- Modules : Console Admin, Automatisation IA, Lieux, Leads, Clients, Ã‰vÃ©nements, Calendrier, Suivi Mariages, ComptabilitÃ©, Contrats, Planning MÃ©nage, Prestataires, Marketing, Taxe de sÃ©jour
- Affichage conditionnel selon les permissions utilisateur
- Ã‰tats actif/inactif avec indicateurs visuels
- Collapse/expand des sections
- Responsive avec version mobile

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : systÃ¨me de permissions admin_console
- Navigue : vers tous les modules de l'ERP
- IntÃ¨gre : React Router pour la navigation
- Consomme : rÃ´les et permissions utilisateur

ğŸ’¡ **Tips Windsurf**
- Utiliser les composants ShadCN UI pour la cohÃ©rence
- ImplÃ©menter la navigation avec React Router
- CrÃ©er une structure extensible pour les futurs modules
- Optimiser pour les performances avec React.memo

---

### 08 - Configuration des routes et permissions de navigation

ğŸ¯ **But clair**
Configurer le systÃ¨me de routage React Router avec protection des routes par permissions et gestion des redirections selon les rÃ´les utilisateur pour tous les modules de la sidebar.

ğŸ§  **Contexte technique**
Ce systÃ¨me gÃ¨re le routage de l'application Backoffice avec protection par permissions. Il dÃ©finit toutes les routes des modules, gÃ¨re les redirections appropriÃ©es et assure la sÃ©curitÃ© d'accÃ¨s selon les rÃ´les.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Configuration routes et guards

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Routes protÃ©gÃ©es pour chaque module de la sidebar
- Guards de permissions avant accÃ¨s aux routes
- Redirections automatiques selon les rÃ´les
- Gestion des routes inexistantes (404)
- Breadcrumbs automatiques selon la route
- Lazy loading des modules pour les performances

âš™ï¸ **Interactions avec d'autres modules**
- ProtÃ¨ge : accÃ¨s Ã  tous les modules via permissions
- Utilise : admin_console pour vÃ©rification des droits
- IntÃ¨gre : systÃ¨me d'authentification Supabase
- GÃ¨re : navigation entre tous les modules

ğŸ’¡ **Tips Windsurf**
- Utiliser React Router v6 avec les nouvelles APIs
- ImplÃ©menter des guards rÃ©utilisables pour les permissions
- CrÃ©er des composants de fallback pour le lazy loading
- Documenter clairement les permissions requises par route

---

## ğŸ—ï¸ Section 2 : FonctionnalitÃ©s Principales

### 09 - CrÃ©ation du layout principal du Dashboard

ğŸ¯ **But clair**
CrÃ©er le composant layout principal du Dashboard avec grille configurable, gestion responsive et intÃ©gration dans le layout global du Backoffice en utilisant ShadCN UI et Tailwind CSS.

ğŸ§  **Contexte technique**
Ce composant constitue la structure de base du dashboard. Il utilise une grille CSS flexible pour positionner les widgets, s'intÃ¨gre dans l'architecture app/ de Next.js 14 et respecte le design system Ã©tabli avec ShadCN UI.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composant React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Layout responsive avec grille 12 colonnes configurable
- Gestion des breakpoints (lg, md, sm, xs)
- IntÃ©gration dans le layout Backoffice existant
- Support du drag & drop pour la personnalisation
- Gestion des Ã©tats de chargement et d'erreur
- Navigation et breadcrumbs appropriÃ©s

âš™ï¸ **Interactions avec d'autres modules**
- IntÃ¨gre : layout global du Backoffice
- Utilise : @wedding-collection/shared-ui
- Consomme : service API Dashboard
- GÃ¨re : Ã©tat global du dashboard

ğŸ’¡ **Tips Windsurf**
- Utiliser CSS Grid pour la flexibilitÃ© du layout
- ImplÃ©menter la responsivitÃ© avec Tailwind CSS
- PrÃ©voir l'extension avec de nouveaux types de widgets
- Optimiser les re-renders avec React.memo

---

### 10 - CrÃ©ation du widget KPIs avec graphiques

ğŸ¯ **But clair**
CrÃ©er le composant widget KPIs qui affiche les indicateurs clÃ©s avec valeurs, tendances, graphiques et configuration personnalisable utilisant une bibliothÃ¨que de graphiques moderne.

ğŸ§  **Contexte technique**
Ce widget consomme les donnÃ©es de la RPC `rpc_get_dashboard_kpis` et les prÃ©sente de maniÃ¨re visuelle avec graphiques, indicateurs de tendance et configuration flexible. Il utilise une bibliothÃ¨que comme Recharts ou Chart.js pour les visualisations.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composant React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Affichage des KPIs avec valeur, libellÃ©, unitÃ©
- Calcul et affichage des tendances (pourcentage d'Ã©volution)
- Graphiques sparkline ou mini-charts pour les tendances
- Configuration des KPIs affichÃ©s via modal
- Support des diffÃ©rentes pÃ©riodes (7d, 30d, mtd, ytd)
- Ã‰tats de chargement, erreur et donnÃ©es vides

âš™ï¸ **Interactions avec d'autres modules**
- Consomme : rpc_get_dashboard_kpis via service API
- Utilise : bibliothÃ¨que de graphiques (Recharts)
- IntÃ¨gre : systÃ¨me de configuration des widgets
- Affiche : donnÃ©es des modules mÃ©tier agrÃ©gÃ©es

ğŸ’¡ **Tips Windsurf**
- Utiliser Recharts pour des graphiques lÃ©gers et performants
- ImplÃ©menter le lazy loading pour les graphiques complexes
- CrÃ©er des animations fluides pour les changements de valeurs
- Optimiser les requÃªtes avec TanStack Query

---

### 11 - CrÃ©ation du widget TÃ¢ches avec interactions

ğŸ¯ **But clair**
CrÃ©er le composant widget TÃ¢ches qui affiche la liste des tÃ¢ches assignÃ©es Ã  l'utilisateur avec possibilitÃ© de marquer comme complÃ©tÃ©es, filtrer et accÃ©der aux dÃ©tails.

ğŸ§  **Contexte technique**
Ce widget interactif consomme les donnÃ©es de `rpc_get_user_tasks` et permet la gestion basique des tÃ¢ches directement depuis le dashboard. Il utilise les composants ShadCN UI pour une interface cohÃ©rente.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composant React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Liste des tÃ¢ches avec titre, Ã©chÃ©ance, prioritÃ©, statut
- Checkbox pour marquer les tÃ¢ches comme complÃ©tÃ©es
- Filtres par statut, prioritÃ©, Ã©chÃ©ance
- Tri par date, prioritÃ©, statut
- Pagination pour les listes longues
- Actions rapides : voir dÃ©tails, modifier, crÃ©er nouvelle tÃ¢che

âš™ï¸ **Interactions avec d'autres modules**
- Consomme : rpc_get_user_tasks via service API
- Utilise : composants shared-ui (List, Checkbox, Button)
- IntÃ¨gre : module de gestion des tÃ¢ches (si existant)
- Met Ã  jour : statuts via RPC dÃ©diÃ©es

ğŸ’¡ **Tips Windsurf**
- Utiliser des mutations optimistes pour les mises Ã  jour
- ImplÃ©menter la virtualisation pour les longues listes
- CrÃ©er des raccourcis clavier pour les actions courantes
- Ajouter des notifications pour les actions rÃ©ussies

---

### 12 - CrÃ©ation du widget Calendrier avec Ã©vÃ©nements

ğŸ¯ **But clair**
CrÃ©er le composant widget Calendrier qui affiche les Ã©vÃ©nements pertinents pour l'utilisateur avec vues mensuelle/hebdomadaire et navigation vers les dÃ©tails des Ã©vÃ©nements.

ğŸ§  **Contexte technique**
Ce widget utilise une bibliothÃ¨que de calendrier comme react-big-calendar pour afficher les Ã©vÃ©nements. Il consomme les donnÃ©es de `rpc_get_user_calendar_events` et s'intÃ¨gre avec le module de gestion des Ã©vÃ©nements.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composant React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Affichage calendrier mensuel/hebdomadaire
- Ã‰vÃ©nements colorÃ©s selon le type ou statut
- Navigation entre les mois/semaines
- Clic sur Ã©vÃ©nement pour voir les dÃ©tails
- Filtres par type d'Ã©vÃ©nement, statut
- Vue compacte adaptÃ©e au widget dashboard

âš™ï¸ **Interactions avec d'autres modules**
- Consomme : rpc_get_user_calendar_events via service API
- Utilise : react-big-calendar ou Ã©quivalent
- IntÃ¨gre : module Ã‰vÃ©nements pour les dÃ©tails
- Navigue : vers les pages de dÃ©tail des Ã©vÃ©nements

ğŸ’¡ **Tips Windsurf**
- Configurer react-big-calendar avec le thÃ¨me du projet
- Optimiser les requÃªtes en chargeant seulement la pÃ©riode visible
- ImplÃ©menter le lazy loading pour les mois non visibles
- CrÃ©er des tooltips informatifs pour les Ã©vÃ©nements

---

### 13 - CrÃ©ation du widget Fil d'actualitÃ© avec Realtime

ğŸ¯ **But clair**
CrÃ©er le composant widget Fil d'actualitÃ© qui affiche les notifications et actualitÃ©s en temps rÃ©el avec Supabase Realtime, marquage comme lu et filtrage par importance.

ğŸ§  **Contexte technique**
Ce widget utilise Supabase Realtime pour recevoir les notifications en temps rÃ©el. Il consomme `rpc_get_user_notifications` et s'abonne aux changements pour maintenir la liste Ã  jour automatiquement.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composant React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Liste des notifications avec titre, contenu, timestamp
- Notifications non lues en premier avec indicateur visuel
- Marquage comme lu au clic ou aprÃ¨s dÃ©lai
- Filtres par type, importance, date
- Mise Ã  jour temps rÃ©el avec Supabase Realtime
- Limitation du nombre d'Ã©lÃ©ments affichÃ©s

âš™ï¸ **Interactions avec d'autres modules**
- Consomme : rpc_get_user_notifications via service API
- Utilise : Supabase Realtime pour les mises Ã  jour
- IntÃ¨gre : systÃ¨me de notifications global
- Met Ã  jour : statut lu/non lu via RPC

ğŸ’¡ **Tips Windsurf**
- GÃ©rer proprement les abonnements Realtime (cleanup)
- ImplÃ©menter un systÃ¨me de cache pour Ã©viter les doublons
- CrÃ©er des animations pour les nouvelles notifications
- Optimiser les performances avec la virtualisation

---

### 14 - CrÃ©ation du widget Actions Rapides configurable

ğŸ¯ **But clair**
CrÃ©er le composant widget Actions Rapides qui affiche des boutons configurables par rÃ´le pour lancer des actions courantes comme crÃ©er un lead, client ou Ã©vÃ©nement avec navigation appropriÃ©e.

ğŸ§  **Contexte technique**
Ce widget affiche des actions contextuelles selon le rÃ´le de l'utilisateur. Il utilise la configuration stockÃ©e dans le dashboard et peut dÃ©clencher des modales, naviguer vers des pages ou exÃ©cuter des actions directes.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composant React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Boutons d'actions configurables par rÃ´le
- Actions : crÃ©er lead, client, Ã©vÃ©nement, tÃ¢che
- Navigation vers formulaires de crÃ©ation
- Ouverture de modales pour actions rapides
- Configuration via interface d'administration
- Permissions vÃ©rifiÃ©es avant affichage des actions

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : systÃ¨me de permissions admin_console
- Navigue : vers modules de crÃ©ation (leads, clients, etc.)
- Peut ouvrir : modales de crÃ©ation rapide
- Configure : via interface d'administration

ğŸ’¡ **Tips Windsurf**
- Utiliser React Router pour la navigation
- CrÃ©er des actions gÃ©nÃ©riques rÃ©utilisables
- ImplÃ©menter des raccourcis clavier pour les actions
- PrÃ©voir l'extension avec de nouvelles actions

---

## ğŸ”§ Section 3 : FonctionnalitÃ©s Secondaires

### 15 - SystÃ¨me de personnalisation avec drag & drop

ğŸ¯ **But clair**
ImplÃ©menter le systÃ¨me de personnalisation du dashboard permettant aux utilisateurs de rÃ©organiser les widgets par drag & drop, ajouter/supprimer des widgets et configurer leurs paramÃ¨tres.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© utilise une bibliothÃ¨que comme react-beautiful-dnd pour le drag & drop. Elle gÃ¨re l'Ã©tat de personnalisation, sauvegarde les configurations via RPC et fournit une interface intuitive pour la customisation.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Mode personnalisation activable/dÃ©sactivable
- Drag & drop des widgets avec preview
- Redimensionnement des widgets
- Ajout de nouveaux widgets depuis une palette
- Suppression de widgets avec confirmation
- Sauvegarde automatique ou manuelle des modifications

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : react-beautiful-dnd ou Ã©quivalent
- Sauvegarde : via rpc_save_dashboard_config
- IntÃ¨gre : systÃ¨me de permissions pour la personnalisation
- Affecte : tous les widgets du dashboard

ğŸ’¡ **Tips Windsurf**
- ImplÃ©menter des animations fluides pour le drag & drop
- CrÃ©er des guides visuels pour le positionnement
- GÃ©rer les collisions et le redimensionnement automatique
- Ajouter des raccourcis pour annuler/refaire

---

### 16 - Interface de configuration avancÃ©e des widgets

ğŸ¯ **But clair**
CrÃ©er l'interface de configuration avancÃ©e permettant de personnaliser chaque widget individuellement (choix des KPIs, filtres, couleurs, pÃ©riodes) avec prÃ©visualisation en temps rÃ©el.

ğŸ§  **Contexte technique**
Cette interface utilise des modales ou panneaux latÃ©raux pour configurer les widgets. Elle fournit des formulaires spÃ©cialisÃ©s pour chaque type de widget et met Ã  jour la configuration en temps rÃ©el avec prÃ©visualisation.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Modal/panneau de configuration par type de widget
- Formulaires spÃ©cialisÃ©s : KPIs (choix des mÃ©triques), TÃ¢ches (filtres), Calendrier (vues)
- PrÃ©visualisation en temps rÃ©el des modifications
- Validation des configurations avant sauvegarde
- RÃ©initialisation aux valeurs par dÃ©faut
- Import/export de configurations

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : composants shared-ui (Form, Modal, Select)
- Sauvegarde : configurations via service API
- PrÃ©visualise : avec les donnÃ©es rÃ©elles des widgets
- Valide : selon les contraintes de chaque widget

ğŸ’¡ **Tips Windsurf**
- Utiliser React Hook Form pour la gestion des formulaires
- ImplÃ©menter la validation avec Zod
- CrÃ©er des composants de configuration rÃ©utilisables
- Ajouter des tooltips explicatifs pour chaque option

---

### 17 - SystÃ¨me d'export et partage de dashboards

ğŸ¯ **But clair**
ImplÃ©menter les fonctionnalitÃ©s d'export du dashboard en PDF/image et de partage de configurations entre utilisateurs avec gestion des permissions et templates prÃ©dÃ©finis.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© utilise des bibliothÃ¨ques comme html2canvas et jsPDF pour l'export. Elle gÃ¨re le partage de configurations via la base de donnÃ©es et permet la crÃ©ation de templates rÃ©utilisables.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants et services

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Export en PDF avec mise en page optimisÃ©e
- Export en image (PNG/JPG) haute rÃ©solution
- Partage de configurations entre utilisateurs
- Templates de dashboard prÃ©dÃ©finis par rÃ´le
- Gestion des permissions de partage
- Historique des exports et partages

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : html2canvas, jsPDF pour l'export
- IntÃ¨gre : systÃ¨me de permissions pour le partage
- Stocke : templates et configurations partagÃ©es
- Notifie : utilisateurs des partages reÃ§us

ğŸ’¡ **Tips Windsurf**
- Optimiser la qualitÃ© des exports avec des styles dÃ©diÃ©s
- ImplÃ©menter un systÃ¨me de cache pour les exports frÃ©quents
- CrÃ©er des templates responsive pour diffÃ©rents formats
- Ajouter des mÃ©tadonnÃ©es aux exports (date, utilisateur, etc.)

---

### 18 - Analytics et monitoring du dashboard

ğŸ¯ **But clair**
ImplÃ©menter le systÃ¨me d'analytics pour tracker l'utilisation du dashboard (widgets les plus consultÃ©s, temps passÃ©, actions effectuÃ©es) avec tableaux de bord d'administration.

ğŸ§  **Contexte technique**
Ce systÃ¨me collecte des mÃ©triques d'usage anonymisÃ©es et les stocke pour analyse. Il fournit des insights sur l'utilisation du dashboard pour optimiser l'expÃ©rience utilisateur et identifier les fonctionnalitÃ©s populaires.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants et services

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Tracking des interactions utilisateur (clics, temps passÃ©)
- MÃ©triques d'usage par widget et fonctionnalitÃ©
- Tableaux de bord d'analytics pour les administrateurs
- Rapports d'utilisation pÃ©riodiques
- DÃ©tection des patterns d'usage
- Recommandations d'optimisation

âš™ï¸ **Interactions avec d'autres modules**
- Collecte : donnÃ©es d'usage anonymisÃ©es
- Stocke : mÃ©triques dans tables dÃ©diÃ©es
- Affiche : analytics dans interface admin
- IntÃ¨gre : avec outils de monitoring externes

ğŸ’¡ **Tips Windsurf**
- Respecter la confidentialitÃ© avec des donnÃ©es anonymisÃ©es
- Utiliser des Ã©vÃ©nements personnalisÃ©s pour le tracking
- CrÃ©er des dashboards d'analytics avec les mÃªmes widgets
- ImplÃ©menter des alertes pour les anomalies d'usage

---

## ğŸš€ Section 4 : Ã‰volutions Futures

### 19 - Intelligence artificielle pour recommandations

ğŸ¯ **But clair**
IntÃ©grer un systÃ¨me d'IA pour fournir des recommandations personnalisÃ©es de configuration dashboard, suggestions d'actions et insights automatiques basÃ©s sur les patterns d'usage.

ğŸ§  **Contexte technique**
Cette Ã©volution utilise des algorithmes de machine learning pour analyser les comportements utilisateur et fournir des recommandations intelligentes. Elle peut utiliser des services IA externes ou des modÃ¨les locaux via Edge Functions.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants et services IA

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Recommandations de widgets selon le rÃ´le et l'usage
- Suggestions d'actions basÃ©es sur les donnÃ©es
- Insights automatiques sur les tendances
- Personnalisation automatique du dashboard
- Alertes intelligentes sur les anomalies
- Apprentissage continu des prÃ©fÃ©rences

âš™ï¸ **Interactions avec d'autres modules**
- Analyse : donnÃ©es d'usage et mÃ©triques mÃ©tier
- Utilise : services IA (OpenAI, services locaux)
- IntÃ¨gre : Edge Functions pour les calculs IA
- AmÃ©liore : expÃ©rience utilisateur avec suggestions

ğŸ’¡ **Tips Windsurf**
- Utiliser des Edge Functions pour les calculs IA
- ImplÃ©menter des modÃ¨les lÃ©gers pour les recommandations
- CrÃ©er une interface explicable pour les suggestions
- Permettre aux utilisateurs d'accepter/refuser les recommandations

---

### 20 - IntÃ©gration avec outils externes

ğŸ¯ **But clair**
DÃ©velopper des connecteurs pour intÃ©grer le dashboard avec des outils externes (Google Analytics, outils de CRM, plateformes de communication) pour enrichir les donnÃ©es et actions disponibles.

ğŸ§  **Contexte technique**
Cette intÃ©gration nÃ©cessite la gestion de multiples APIs externes, l'authentification OAuth et la synchronisation de donnÃ©es. Elle Ã©tend les capacitÃ©s du dashboard avec des sources de donnÃ©es externes.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts` - Services d'intÃ©gration et connecteurs

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Connecteurs pour Google Analytics, CRM externes
- Synchronisation bidirectionnelle des donnÃ©es
- Authentification OAuth pour les services externes
- Widgets enrichis avec donnÃ©es externes
- Actions vers les outils externes depuis le dashboard
- Gestion des erreurs et reconnexions automatiques

âš™ï¸ **Interactions avec d'autres modules**
- IntÃ¨gre : APIs externes via connecteurs
- Utilise : systÃ¨me d'authentification pour OAuth
- Enrichit : widgets existants avec nouvelles donnÃ©es
- Ã‰tend : actions rapides avec outils externes

ğŸ’¡ **Tips Windsurf**
- Utiliser des Edge Functions pour les intÃ©grations sÃ©curisÃ©es
- ImplÃ©menter des patterns de circuit breaker
- CrÃ©er des interfaces de configuration pour chaque intÃ©gration
- GÃ©rer les quotas et limitations des APIs externes

---

### 21 - Dashboard mobile avec PWA

ğŸ¯ **But clair**
CrÃ©er une version mobile optimisÃ©e du dashboard avec fonctionnalitÃ©s PWA (Progressive Web App) pour l'accÃ¨s hors ligne et les notifications push.

ğŸ§  **Contexte technique**
Cette Ã©volution adapte le dashboard pour les appareils mobiles avec une interface tactile optimisÃ©e, support hors ligne et notifications push. Elle utilise les technologies PWA pour une expÃ©rience native.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts`, `manifest.json`, service worker

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Interface mobile responsive et tactile
- FonctionnalitÃ©s hors ligne avec cache intelligent
- Notifications push pour les alertes importantes
- Synchronisation automatique lors de la reconnexion
- Widgets adaptÃ©s aux petits Ã©crans
- Installation comme app native

âš™ï¸ **Interactions avec d'autres modules**
- Adapte : tous les widgets pour mobile
- Utilise : service workers pour le cache
- IntÃ¨gre : notifications push Supabase
- Synchronise : donnÃ©es lors de la reconnexion

ğŸ’¡ **Tips Windsurf**
- Utiliser Workbox pour la gestion du cache PWA
- Optimiser les widgets pour les interactions tactiles
- ImplÃ©menter une stratÃ©gie de cache intelligente
- CrÃ©er des notifications push contextuelles

---

### 22 - SystÃ¨me de collaboration en temps rÃ©el

ğŸ¯ **But clair**
ImplÃ©menter des fonctionnalitÃ©s de collaboration permettant aux utilisateurs de partager des vues dashboard en temps rÃ©el, commenter et collaborer sur les donnÃ©es affichÃ©es.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© utilise Supabase Realtime pour la collaboration en temps rÃ©el. Elle permet le partage de sessions, les commentaires collaboratifs et la synchronisation des vues entre utilisateurs.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants de collaboration

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Sessions de dashboard partagÃ©es en temps rÃ©el
- Curseurs et sÃ©lections des autres utilisateurs visibles
- Commentaires et annotations sur les widgets
- Chat intÃ©grÃ© pour la discussion
- Historique des modifications collaboratives
- Permissions de collaboration granulaires

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : Supabase Realtime pour la synchronisation
- IntÃ¨gre : systÃ¨me de permissions pour la collaboration
- Stocke : sessions et commentaires collaboratifs
- Notifie : participants des changements

ğŸ’¡ **Tips Windsurf**
- GÃ©rer efficacement les connexions Realtime multiples
- ImplÃ©menter des indicateurs visuels pour la collaboration
- CrÃ©er un systÃ¨me de rÃ©solution de conflits
- Optimiser les performances avec de nombreux collaborateurs

---

### 23 - Dashboards thÃ©matiques et sectoriels

ğŸ¯ **But clair**
CrÃ©er des dashboards spÃ©cialisÃ©s par secteur d'activitÃ© (mariage, Ã©vÃ©nementiel corporate, etc.) avec KPIs et widgets spÃ©cifiques Ã  chaque domaine mÃ©tier.

ğŸ§  **Contexte technique**
Cette Ã©volution Ã©tend le systÃ¨me de widgets avec des composants spÃ©cialisÃ©s par secteur. Elle utilise un systÃ¨me de plugins pour charger dynamiquement les widgets sectoriels selon la configuration.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Widgets spÃ©cialisÃ©s et systÃ¨me de plugins

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Widgets spÃ©cialisÃ©s par secteur (mariage, corporate, etc.)
- KPIs mÃ©tier spÃ©cifiques (taux de satisfaction, ROI Ã©vÃ©nements)
- Templates de dashboard par secteur
- Configuration automatique selon le type d'entreprise
- Marketplace de widgets communautaires
- API pour dÃ©velopper des widgets personnalisÃ©s

âš™ï¸ **Interactions avec d'autres modules**
- Ã‰tend : systÃ¨me de widgets existant
- Utilise : configuration secteur de l'entreprise
- IntÃ¨gre : donnÃ©es mÃ©tier spÃ©cialisÃ©es
- Permet : dÃ©veloppement de widgets tiers

ğŸ’¡ **Tips Windsurf**
- CrÃ©er une architecture de plugins extensible
- Documenter l'API de dÃ©veloppement de widgets
- ImplÃ©menter un systÃ¨me de validation des widgets tiers
- CrÃ©er des templates de dÃ©marrage par secteur

---

### 24 - Analytics prÃ©dictifs et forecasting

ğŸ¯ **But clair**
IntÃ©grer des capacitÃ©s d'analytics prÃ©dictifs pour forecaster les tendances mÃ©tier, prÃ©dire les performances futures et alerter sur les risques potentiels.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© avancÃ©e utilise des modÃ¨les de machine learning pour analyser les donnÃ©es historiques et prÃ©dire les tendances futures. Elle peut utiliser des services IA externes ou des modÃ¨les entraÃ®nÃ©s localement.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants d'analytics prÃ©dictifs

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- PrÃ©dictions de chiffre d'affaires et performance
- DÃ©tection d'anomalies et alertes prÃ©ventives
- ModÃ¨les de forecasting pour la planification
- Recommandations d'actions basÃ©es sur les prÃ©dictions
- Visualisations de tendances et scÃ©narios
- Calibration et amÃ©lioration continue des modÃ¨les

âš™ï¸ **Interactions avec d'autres modules**
- Analyse : donnÃ©es historiques de tous les modules
- Utilise : services de machine learning
- GÃ©nÃ¨re : alertes et recommandations
- IntÃ¨gre : visualisations prÃ©dictives dans les widgets

ğŸ’¡ **Tips Windsurf**
- Utiliser des modÃ¨les de time series pour les prÃ©dictions
- ImplÃ©menter des intervalles de confiance pour les prÃ©dictions
- CrÃ©er des visualisations claires pour les incertitudes
- Permettre l'ajustement manuel des modÃ¨les

---

## ğŸ“Š Matrice de PrioritÃ©s et DÃ©pendances

| Prompt | PrioritÃ© | DÃ©pendances | DurÃ©e EstimÃ©e | ComplexitÃ© |
|--------|----------|-------------|---------------|------------|
| 01-08  | P0       | Monorepo initialisÃ© | 4-5 jours     | Moyenne    |
| 09-14  | P0       | 01-08       | 5-6 jours     | Ã‰levÃ©e     |
| 15-18  | P1       | 09-14       | 3-4 jours     | Moyenne    |
| 19-24  | P2-P3    | 15-18       | 2-3 semaines  | TrÃ¨s Ã©levÃ©e |

---

## ğŸ”„ Ordre d'ExÃ©cution RecommandÃ©

### **Phase 1 - Fondations + Navigation (Semaine 1)**
Prompts 01-08 : Base de donnÃ©es, RPC, types, services, sidebar et routes

### **Phase 2 - Interface Principale (Semaines 2-3)**
Prompts 09-14 : Layout, widgets principaux, interactions

### **Phase 3 - Personnalisation (Semaine 4)**
Prompts 15-18 : Drag & drop, configuration, export, analytics

### **Phase 4 - Ã‰volutions AvancÃ©es (Futures versions)**
Prompts 19-24 : IA, intÃ©grations, mobile, collaboration

---

## âš ï¸ Points d'Attention Critiques

### **Performance et Optimisation**
- Optimiser les requÃªtes RPC pour les KPIs complexes
- ImplÃ©menter un cache intelligent pour les donnÃ©es frÃ©quemment consultÃ©es
- GÃ©rer efficacement les abonnements Realtime

### **SÃ©curitÃ© et Permissions**
- VÃ©rifier les permissions Ã  tous les niveaux (RPC, composants, actions)
- Filtrer les donnÃ©es selon les rÃ´les utilisateur
- SÃ©curiser les configurations personnalisÃ©es

### **ExpÃ©rience Utilisateur**
- Maintenir des temps de chargement < 4 secondes
- ImplÃ©menter des Ã©tats de chargement informatifs
- CrÃ©er une interface intuitive pour la personnalisation

---

*Document gÃ©nÃ©rÃ© par Manus AI - Expert en transformation de cahiers des charges pour Windsurf*

