# Prompts Windsurf - Module Dashboard du Backoffice

## 📋 Informations du Module

- **Module** : Dashboard du Backoffice
- **Identifiant technique** : `backoffice_dashboard`
- **Version** : 1.0.0
- **Application** : Backoffice (`apps/backoffice`)
- **Priorité** : P0 (Critique - Interface centrale d'administration)
- **Dépendances** : Module Initialisation Monorepo, Console Admin, modules métier (Leads, Clients, Événements)
- **Schéma DB** : `bo` (table `dashboard_user_settings`)

---

## 🎯 Vue d'Ensemble du Module

Le module Dashboard du Backoffice constitue le point d'entrée principal et le centre de contrôle visuel pour les utilisateurs internes de l'ERP Wedding Collection. Il agit comme une interface centralisée et personnalisable qui agrège et présente de manière synthétique les informations clés dispersées dans les différents modules opérationnels.

Ce module s'intègre dans l'application `apps/backoffice` du monorepo et utilise une architecture frontend-lourde avec React/TypeScript, consommant des données via des fonctions RPC Supabase optimisées. Il offre des widgets configurables (KPIs, calendrier, tâches, notifications) avec personnalisation par utilisateur et adaptation selon les rôles.

---

## 🚀 Section 1 : Initialisation

### 01 - Création de la table bo.dashboard_user_settings avec RLS

🎯 **But clair**
Créer la table `bo.dashboard_user_settings` dans Supabase pour stocker les configurations personnalisées des dashboards utilisateurs avec les politiques RLS appropriées et les triggers de mise à jour.

🧠 **Contexte technique**
Cette table stocke les configurations personnalisées des dashboards dans un champ JSONB. Elle respecte les conventions Supabase du projet avec RLS activée, permettant à chaque utilisateur de gérer sa propre configuration tout en autorisant les admins ERP à gérer toutes les configurations.

🛠️ **Type de fichier concerné**
`.sql` - Migration Supabase

🔄 **Comportement attendu / Logique métier**
- Table avec champs : id, user_id, dashboard_configuration (JSONB), created_at, updated_at, created_by, updated_by
- Contrainte unique sur user_id (une config par utilisateur)
- RLS avec politiques pour SELECT, INSERT, UPDATE, DELETE
- Trigger pour updated_at automatique
- Politiques permettant aux admins ERP de gérer toutes les configurations

⚙️ **Interactions avec d'autres modules**
- Référence : auth.users (user_id, created_by, updated_by)
- Utilisé par : fonctions RPC du dashboard
- Intègre : système de permissions admin_console

💡 **Tips Windsurf**
- Utiliser le MCP Supabase pour exécuter directement la migration
- Vérifier que la fonction shared.update_updated_at_column() existe
- Tester les politiques RLS avec différents rôles utilisateur
- Valider la structure JSONB avec des exemples de configuration

---

### 02 - Création des fonctions RPC pour la gestion des configurations

🎯 **But clair**
Créer les fonctions RPC Supabase pour récupérer et sauvegarder les configurations de dashboard utilisateur avec gestion des configurations par défaut selon les rôles et validation des permissions.

🧠 **Contexte technique**
Ces fonctions RPC centralisent la logique de gestion des configurations dashboard. Elles gèrent les configurations personnalisées, les configurations par défaut par rôle, et la validation des permissions via le système admin_console.

🛠️ **Type de fichier concerné**
`.sql` - Fonctions RPC Supabase

🔄 **Comportement attendu / Logique métier**
- `rpc_get_user_dashboard_config()` : récupère la config utilisateur ou par défaut selon le rôle
- `rpc_save_dashboard_config(p_config JSONB)` : sauvegarde la config avec validation
- Vérification des permissions dashboard:read et dashboard:personalize
- Gestion des configurations par défaut par rôle (admin_erp, wedding_planner, etc.)
- Validation de la structure JSONB des configurations

⚙️ **Interactions avec d'autres modules**
- Utilise : admin_console.vw_user_permissions pour les permissions
- Référence : admin_console.user_roles et admin_console.roles
- Intègre : système d'authentification Supabase Auth
- Accède : bo.dashboard_user_settings

💡 **Tips Windsurf**
- Utiliser SECURITY DEFINER pour les fonctions RPC
- Implémenter une validation robuste de la structure JSONB
- Gérer les cas d'erreur avec des messages explicites
- Tester avec différents rôles et permissions

---

### 03 - Création des fonctions RPC pour les KPIs du dashboard

🎯 **But clair**
Créer la fonction RPC `rpc_get_dashboard_kpis()` pour calculer et retourner les indicateurs clés de performance avec support des périodes configurables et comparaisons avec les périodes précédentes.

🧠 **Contexte technique**
Cette fonction RPC calcule dynamiquement les KPIs selon les codes demandés et la période spécifiée. Elle effectue des requêtes optimisées sur les tables métier et retourne des données structurées avec valeurs actuelles et comparaisons historiques.

🛠️ **Type de fichier concerné**
`.sql` - Fonction RPC Supabase

🔄 **Comportement attendu / Logique métier**
- Paramètres : p_kpi_codes (TEXT[]), p_period (TEXT)
- Calcul des KPIs : leads_new, leads_converted, events_upcoming, revenue_total
- Support des périodes : 7d, 30d, mtd, ytd
- Comparaison avec période précédente pour tendances
- Vérification permission dashboard:read
- Retour JSONB structuré avec métadonnées

⚙️ **Interactions avec d'autres modules**
- Accède : bo.leads, shared.evenements, bo.factures (selon KPIs)
- Utilise : admin_console.vw_user_permissions
- Peut être étendu : avec d'autres modules métier
- Optimisé : pour performances avec index appropriés

💡 **Tips Windsurf**
- Optimiser les requêtes avec des CTE pour la lisibilité
- Implémenter un cache côté application si nécessaire
- Gérer les cas où certaines tables n'existent pas encore
- Documenter chaque KPI avec des commentaires SQL

---

### 04 - Création des fonctions RPC pour les tâches et calendrier

🎯 **But clair**
Créer les fonctions RPC `rpc_get_user_tasks()` et `rpc_get_user_calendar_events()` pour alimenter les widgets tâches et calendrier avec filtrage par utilisateur et permissions appropriées.

🧠 **Contexte technique**
Ces fonctions RPC fournissent les données pour les widgets interactifs du dashboard. Elles filtrent les données selon l'utilisateur connecté et ses permissions, optimisent les requêtes pour les performances et structurent les données pour l'affichage frontend.

🛠️ **Type de fichier concerné**
`.sql` - Fonctions RPC Supabase

🔄 **Comportement attendu / Logique métier**
- `rpc_get_user_tasks()` : tâches assignées à l'utilisateur avec filtres
- `rpc_get_user_calendar_events()` : événements pertinents pour l'utilisateur
- Filtrage par statut, priorité, échéance pour les tâches
- Filtrage par date, type, permissions pour les événements
- Support pagination et tri
- Vérification des permissions appropriées

⚙️ **Interactions avec d'autres modules**
- Accède : bo.tasks, shared.evenements (ou tables équivalentes)
- Utilise : système de permissions admin_console
- Intègre : filtrage RLS des modules source
- Optimisé : avec index sur les champs de filtrage

💡 **Tips Windsurf**
- Utiliser les politiques RLS existantes des modules source
- Implémenter des paramètres de pagination efficaces
- Structurer le retour JSON pour faciliter l'affichage
- Prévoir l'extension avec d'autres types de données

---

### 05 - Configuration TypeScript pour le module Dashboard

🎯 **But clair**
Créer les types TypeScript spécifiques au module Dashboard incluant les interfaces pour les configurations, widgets, KPIs et données des fonctions RPC avec intégration des types Supabase générés.

🧠 **Contexte technique**
Ces types assurent la cohérence entre les données Supabase et l'interface React. Ils définissent la structure des configurations dashboard, des widgets, et des réponses RPC pour un développement type-safe et une maintenance facilitée.

🛠️ **Type de fichier concerné**
`.ts` - Types TypeScript

🔄 **Comportement attendu / Logique métier**
- Types pour DashboardConfiguration, Widget, KPI, Task, CalendarEvent
- Interfaces pour les réponses RPC (GetKpisResponse, GetTasksResponse, etc.)
- Types pour les configurations de widgets (KpiConfig, TasksConfig, etc.)
- Énumérations pour les périodes, types de widgets, statuts
- Intégration avec les types générés par Supabase
- Types pour les props des composants React

⚙️ **Interactions avec d'autres modules**
- Étend : types générés par Supabase
- Utilisé par : tous les composants React du dashboard
- Intègre : types des modules métier (leads, events, tasks)
- Partagé : via le package types du monorepo

💡 **Tips Windsurf**
- Utiliser `supabase gen types` pour synchroniser avec la DB
- Créer des types dérivés pour les différents états des widgets
- Implémenter la validation runtime avec Zod si nécessaire
- Organiser les types par domaine (config, widgets, data)

---

### 06 - Configuration du service API Dashboard

🎯 **But clair**
Créer le service API Dashboard qui encapsule toutes les interactions avec Supabase pour le module, incluant la gestion des configurations, l'appel des RPC et la gestion d'erreurs standardisée.

🧠 **Contexte technique**
Ce service centralise la logique d'accès aux données pour le dashboard. Il utilise le client Supabase du package api-client, implémente la gestion d'erreurs du projet et fournit une interface typée pour les composants React.

🛠️ **Type de fichier concerné**
`.ts` - Service API

🔄 **Comportement attendu / Logique métier**
- Méthodes pour configuration : getUserConfig(), saveUserConfig()
- Méthodes pour données : getKpis(), getUserTasks(), getCalendarEvents()
- Gestion d'erreurs avec types d'erreur spécifiques
- Cache côté client pour optimiser les performances
- Retry automatique pour les requêtes échouées
- Logging pour le debugging et monitoring

⚙️ **Interactions avec d'autres modules**
- Utilise : @wedding-collection/api-client
- Intègre : types du module dashboard
- Dépend : configuration Supabase du monorepo
- Utilisé par : hooks React et composants

💡 **Tips Windsurf**
- Utiliser TanStack Query pour la gestion du cache et des états
- Implémenter des méthodes optimistes pour les mises à jour
- Ajouter des logs détaillés pour faciliter le debugging
- Créer des wrappers typés pour chaque RPC

---

### 07 - Création de la sidebar de navigation globale du Backoffice

🎯 **But clair**
Créer la sidebar de navigation principale du Backoffice avec tous les modules de l'ERP Wedding Collection, gestion des permissions par rôle et navigation hiérarchique responsive.

🧠 **Contexte technique**
Cette sidebar constitue la navigation principale de l'application Backoffice. Elle affiche tous les modules selon les permissions utilisateur, gère la navigation hiérarchique et s'intègre parfaitement avec le layout global. Elle utilise ShadCN UI pour la cohérence visuelle.

🛠️ **Type de fichier concerné**
`.tsx` - Composant React

🔄 **Comportement attendu / Logique métier**
- Navigation hiérarchique avec sections : Administration, Gestion Métier, Marketing & Outils
- Modules : Console Admin, Automatisation IA, Lieux, Leads, Clients, Événements, Calendrier, Suivi Mariages, Comptabilité, Contrats, Planning Ménage, Prestataires, Marketing, Taxe de séjour
- Affichage conditionnel selon les permissions utilisateur
- États actif/inactif avec indicateurs visuels
- Collapse/expand des sections
- Responsive avec version mobile

⚙️ **Interactions avec d'autres modules**
- Utilise : système de permissions admin_console
- Navigue : vers tous les modules de l'ERP
- Intègre : React Router pour la navigation
- Consomme : rôles et permissions utilisateur

💡 **Tips Windsurf**
- Utiliser les composants ShadCN UI pour la cohérence
- Implémenter la navigation avec React Router
- Créer une structure extensible pour les futurs modules
- Optimiser pour les performances avec React.memo

---

### 08 - Configuration des routes et permissions de navigation

🎯 **But clair**
Configurer le système de routage React Router avec protection des routes par permissions et gestion des redirections selon les rôles utilisateur pour tous les modules de la sidebar.

🧠 **Contexte technique**
Ce système gère le routage de l'application Backoffice avec protection par permissions. Il définit toutes les routes des modules, gère les redirections appropriées et assure la sécurité d'accès selon les rôles.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Configuration routes et guards

🔄 **Comportement attendu / Logique métier**
- Routes protégées pour chaque module de la sidebar
- Guards de permissions avant accès aux routes
- Redirections automatiques selon les rôles
- Gestion des routes inexistantes (404)
- Breadcrumbs automatiques selon la route
- Lazy loading des modules pour les performances

⚙️ **Interactions avec d'autres modules**
- Protège : accès à tous les modules via permissions
- Utilise : admin_console pour vérification des droits
- Intègre : système d'authentification Supabase
- Gère : navigation entre tous les modules

💡 **Tips Windsurf**
- Utiliser React Router v6 avec les nouvelles APIs
- Implémenter des guards réutilisables pour les permissions
- Créer des composants de fallback pour le lazy loading
- Documenter clairement les permissions requises par route

---

## 🏗️ Section 2 : Fonctionnalités Principales

### 09 - Création du layout principal du Dashboard

🎯 **But clair**
Créer le composant layout principal du Dashboard avec grille configurable, gestion responsive et intégration dans le layout global du Backoffice en utilisant ShadCN UI et Tailwind CSS.

🧠 **Contexte technique**
Ce composant constitue la structure de base du dashboard. Il utilise une grille CSS flexible pour positionner les widgets, s'intègre dans l'architecture app/ de Next.js 14 et respecte le design system établi avec ShadCN UI.

🛠️ **Type de fichier concerné**
`.tsx` - Composant React

🔄 **Comportement attendu / Logique métier**
- Layout responsive avec grille 12 colonnes configurable
- Gestion des breakpoints (lg, md, sm, xs)
- Intégration dans le layout Backoffice existant
- Support du drag & drop pour la personnalisation
- Gestion des états de chargement et d'erreur
- Navigation et breadcrumbs appropriés

⚙️ **Interactions avec d'autres modules**
- Intègre : layout global du Backoffice
- Utilise : @wedding-collection/shared-ui
- Consomme : service API Dashboard
- Gère : état global du dashboard

💡 **Tips Windsurf**
- Utiliser CSS Grid pour la flexibilité du layout
- Implémenter la responsivité avec Tailwind CSS
- Prévoir l'extension avec de nouveaux types de widgets
- Optimiser les re-renders avec React.memo

---

### 10 - Création du widget KPIs avec graphiques

🎯 **But clair**
Créer le composant widget KPIs qui affiche les indicateurs clés avec valeurs, tendances, graphiques et configuration personnalisable utilisant une bibliothèque de graphiques moderne.

🧠 **Contexte technique**
Ce widget consomme les données de la RPC `rpc_get_dashboard_kpis` et les présente de manière visuelle avec graphiques, indicateurs de tendance et configuration flexible. Il utilise une bibliothèque comme Recharts ou Chart.js pour les visualisations.

🛠️ **Type de fichier concerné**
`.tsx` - Composant React

🔄 **Comportement attendu / Logique métier**
- Affichage des KPIs avec valeur, libellé, unité
- Calcul et affichage des tendances (pourcentage d'évolution)
- Graphiques sparkline ou mini-charts pour les tendances
- Configuration des KPIs affichés via modal
- Support des différentes périodes (7d, 30d, mtd, ytd)
- États de chargement, erreur et données vides

⚙️ **Interactions avec d'autres modules**
- Consomme : rpc_get_dashboard_kpis via service API
- Utilise : bibliothèque de graphiques (Recharts)
- Intègre : système de configuration des widgets
- Affiche : données des modules métier agrégées

💡 **Tips Windsurf**
- Utiliser Recharts pour des graphiques légers et performants
- Implémenter le lazy loading pour les graphiques complexes
- Créer des animations fluides pour les changements de valeurs
- Optimiser les requêtes avec TanStack Query

---

### 11 - Création du widget Tâches avec interactions

🎯 **But clair**
Créer le composant widget Tâches qui affiche la liste des tâches assignées à l'utilisateur avec possibilité de marquer comme complétées, filtrer et accéder aux détails.

🧠 **Contexte technique**
Ce widget interactif consomme les données de `rpc_get_user_tasks` et permet la gestion basique des tâches directement depuis le dashboard. Il utilise les composants ShadCN UI pour une interface cohérente.

🛠️ **Type de fichier concerné**
`.tsx` - Composant React

🔄 **Comportement attendu / Logique métier**
- Liste des tâches avec titre, échéance, priorité, statut
- Checkbox pour marquer les tâches comme complétées
- Filtres par statut, priorité, échéance
- Tri par date, priorité, statut
- Pagination pour les listes longues
- Actions rapides : voir détails, modifier, créer nouvelle tâche

⚙️ **Interactions avec d'autres modules**
- Consomme : rpc_get_user_tasks via service API
- Utilise : composants shared-ui (List, Checkbox, Button)
- Intègre : module de gestion des tâches (si existant)
- Met à jour : statuts via RPC dédiées

💡 **Tips Windsurf**
- Utiliser des mutations optimistes pour les mises à jour
- Implémenter la virtualisation pour les longues listes
- Créer des raccourcis clavier pour les actions courantes
- Ajouter des notifications pour les actions réussies

---

### 12 - Création du widget Calendrier avec événements

🎯 **But clair**
Créer le composant widget Calendrier qui affiche les événements pertinents pour l'utilisateur avec vues mensuelle/hebdomadaire et navigation vers les détails des événements.

🧠 **Contexte technique**
Ce widget utilise une bibliothèque de calendrier comme react-big-calendar pour afficher les événements. Il consomme les données de `rpc_get_user_calendar_events` et s'intègre avec le module de gestion des événements.

🛠️ **Type de fichier concerné**
`.tsx` - Composant React

🔄 **Comportement attendu / Logique métier**
- Affichage calendrier mensuel/hebdomadaire
- Événements colorés selon le type ou statut
- Navigation entre les mois/semaines
- Clic sur événement pour voir les détails
- Filtres par type d'événement, statut
- Vue compacte adaptée au widget dashboard

⚙️ **Interactions avec d'autres modules**
- Consomme : rpc_get_user_calendar_events via service API
- Utilise : react-big-calendar ou équivalent
- Intègre : module Événements pour les détails
- Navigue : vers les pages de détail des événements

💡 **Tips Windsurf**
- Configurer react-big-calendar avec le thème du projet
- Optimiser les requêtes en chargeant seulement la période visible
- Implémenter le lazy loading pour les mois non visibles
- Créer des tooltips informatifs pour les événements

---

### 13 - Création du widget Fil d'actualité avec Realtime

🎯 **But clair**
Créer le composant widget Fil d'actualité qui affiche les notifications et actualités en temps réel avec Supabase Realtime, marquage comme lu et filtrage par importance.

🧠 **Contexte technique**
Ce widget utilise Supabase Realtime pour recevoir les notifications en temps réel. Il consomme `rpc_get_user_notifications` et s'abonne aux changements pour maintenir la liste à jour automatiquement.

🛠️ **Type de fichier concerné**
`.tsx` - Composant React

🔄 **Comportement attendu / Logique métier**
- Liste des notifications avec titre, contenu, timestamp
- Notifications non lues en premier avec indicateur visuel
- Marquage comme lu au clic ou après délai
- Filtres par type, importance, date
- Mise à jour temps réel avec Supabase Realtime
- Limitation du nombre d'éléments affichés

⚙️ **Interactions avec d'autres modules**
- Consomme : rpc_get_user_notifications via service API
- Utilise : Supabase Realtime pour les mises à jour
- Intègre : système de notifications global
- Met à jour : statut lu/non lu via RPC

💡 **Tips Windsurf**
- Gérer proprement les abonnements Realtime (cleanup)
- Implémenter un système de cache pour éviter les doublons
- Créer des animations pour les nouvelles notifications
- Optimiser les performances avec la virtualisation

---

### 14 - Création du widget Actions Rapides configurable

🎯 **But clair**
Créer le composant widget Actions Rapides qui affiche des boutons configurables par rôle pour lancer des actions courantes comme créer un lead, client ou événement avec navigation appropriée.

🧠 **Contexte technique**
Ce widget affiche des actions contextuelles selon le rôle de l'utilisateur. Il utilise la configuration stockée dans le dashboard et peut déclencher des modales, naviguer vers des pages ou exécuter des actions directes.

🛠️ **Type de fichier concerné**
`.tsx` - Composant React

🔄 **Comportement attendu / Logique métier**
- Boutons d'actions configurables par rôle
- Actions : créer lead, client, événement, tâche
- Navigation vers formulaires de création
- Ouverture de modales pour actions rapides
- Configuration via interface d'administration
- Permissions vérifiées avant affichage des actions

⚙️ **Interactions avec d'autres modules**
- Utilise : système de permissions admin_console
- Navigue : vers modules de création (leads, clients, etc.)
- Peut ouvrir : modales de création rapide
- Configure : via interface d'administration

💡 **Tips Windsurf**
- Utiliser React Router pour la navigation
- Créer des actions génériques réutilisables
- Implémenter des raccourcis clavier pour les actions
- Prévoir l'extension avec de nouvelles actions

---

## 🔧 Section 3 : Fonctionnalités Secondaires

### 15 - Système de personnalisation avec drag & drop

🎯 **But clair**
Implémenter le système de personnalisation du dashboard permettant aux utilisateurs de réorganiser les widgets par drag & drop, ajouter/supprimer des widgets et configurer leurs paramètres.

🧠 **Contexte technique**
Cette fonctionnalité utilise une bibliothèque comme react-beautiful-dnd pour le drag & drop. Elle gère l'état de personnalisation, sauvegarde les configurations via RPC et fournit une interface intuitive pour la customisation.

🛠️ **Type de fichier concerné**
`.tsx` - Composants React

🔄 **Comportement attendu / Logique métier**
- Mode personnalisation activable/désactivable
- Drag & drop des widgets avec preview
- Redimensionnement des widgets
- Ajout de nouveaux widgets depuis une palette
- Suppression de widgets avec confirmation
- Sauvegarde automatique ou manuelle des modifications

⚙️ **Interactions avec d'autres modules**
- Utilise : react-beautiful-dnd ou équivalent
- Sauvegarde : via rpc_save_dashboard_config
- Intègre : système de permissions pour la personnalisation
- Affecte : tous les widgets du dashboard

💡 **Tips Windsurf**
- Implémenter des animations fluides pour le drag & drop
- Créer des guides visuels pour le positionnement
- Gérer les collisions et le redimensionnement automatique
- Ajouter des raccourcis pour annuler/refaire

---

### 16 - Interface de configuration avancée des widgets

🎯 **But clair**
Créer l'interface de configuration avancée permettant de personnaliser chaque widget individuellement (choix des KPIs, filtres, couleurs, périodes) avec prévisualisation en temps réel.

🧠 **Contexte technique**
Cette interface utilise des modales ou panneaux latéraux pour configurer les widgets. Elle fournit des formulaires spécialisés pour chaque type de widget et met à jour la configuration en temps réel avec prévisualisation.

🛠️ **Type de fichier concerné**
`.tsx` - Composants React

🔄 **Comportement attendu / Logique métier**
- Modal/panneau de configuration par type de widget
- Formulaires spécialisés : KPIs (choix des métriques), Tâches (filtres), Calendrier (vues)
- Prévisualisation en temps réel des modifications
- Validation des configurations avant sauvegarde
- Réinitialisation aux valeurs par défaut
- Import/export de configurations

⚙️ **Interactions avec d'autres modules**
- Utilise : composants shared-ui (Form, Modal, Select)
- Sauvegarde : configurations via service API
- Prévisualise : avec les données réelles des widgets
- Valide : selon les contraintes de chaque widget

💡 **Tips Windsurf**
- Utiliser React Hook Form pour la gestion des formulaires
- Implémenter la validation avec Zod
- Créer des composants de configuration réutilisables
- Ajouter des tooltips explicatifs pour chaque option

---

### 17 - Système d'export et partage de dashboards

🎯 **But clair**
Implémenter les fonctionnalités d'export du dashboard en PDF/image et de partage de configurations entre utilisateurs avec gestion des permissions et templates prédéfinis.

🧠 **Contexte technique**
Cette fonctionnalité utilise des bibliothèques comme html2canvas et jsPDF pour l'export. Elle gère le partage de configurations via la base de données et permet la création de templates réutilisables.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et services

🔄 **Comportement attendu / Logique métier**
- Export en PDF avec mise en page optimisée
- Export en image (PNG/JPG) haute résolution
- Partage de configurations entre utilisateurs
- Templates de dashboard prédéfinis par rôle
- Gestion des permissions de partage
- Historique des exports et partages

⚙️ **Interactions avec d'autres modules**
- Utilise : html2canvas, jsPDF pour l'export
- Intègre : système de permissions pour le partage
- Stocke : templates et configurations partagées
- Notifie : utilisateurs des partages reçus

💡 **Tips Windsurf**
- Optimiser la qualité des exports avec des styles dédiés
- Implémenter un système de cache pour les exports fréquents
- Créer des templates responsive pour différents formats
- Ajouter des métadonnées aux exports (date, utilisateur, etc.)

---

### 18 - Analytics et monitoring du dashboard

🎯 **But clair**
Implémenter le système d'analytics pour tracker l'utilisation du dashboard (widgets les plus consultés, temps passé, actions effectuées) avec tableaux de bord d'administration.

🧠 **Contexte technique**
Ce système collecte des métriques d'usage anonymisées et les stocke pour analyse. Il fournit des insights sur l'utilisation du dashboard pour optimiser l'expérience utilisateur et identifier les fonctionnalités populaires.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et services

🔄 **Comportement attendu / Logique métier**
- Tracking des interactions utilisateur (clics, temps passé)
- Métriques d'usage par widget et fonctionnalité
- Tableaux de bord d'analytics pour les administrateurs
- Rapports d'utilisation périodiques
- Détection des patterns d'usage
- Recommandations d'optimisation

⚙️ **Interactions avec d'autres modules**
- Collecte : données d'usage anonymisées
- Stocke : métriques dans tables dédiées
- Affiche : analytics dans interface admin
- Intègre : avec outils de monitoring externes

💡 **Tips Windsurf**
- Respecter la confidentialité avec des données anonymisées
- Utiliser des événements personnalisés pour le tracking
- Créer des dashboards d'analytics avec les mêmes widgets
- Implémenter des alertes pour les anomalies d'usage

---

## 🚀 Section 4 : Évolutions Futures

### 19 - Intelligence artificielle pour recommandations

🎯 **But clair**
Intégrer un système d'IA pour fournir des recommandations personnalisées de configuration dashboard, suggestions d'actions et insights automatiques basés sur les patterns d'usage.

🧠 **Contexte technique**
Cette évolution utilise des algorithmes de machine learning pour analyser les comportements utilisateur et fournir des recommandations intelligentes. Elle peut utiliser des services IA externes ou des modèles locaux via Edge Functions.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et services IA

🔄 **Comportement attendu / Logique métier**
- Recommandations de widgets selon le rôle et l'usage
- Suggestions d'actions basées sur les données
- Insights automatiques sur les tendances
- Personnalisation automatique du dashboard
- Alertes intelligentes sur les anomalies
- Apprentissage continu des préférences

⚙️ **Interactions avec d'autres modules**
- Analyse : données d'usage et métriques métier
- Utilise : services IA (OpenAI, services locaux)
- Intègre : Edge Functions pour les calculs IA
- Améliore : expérience utilisateur avec suggestions

💡 **Tips Windsurf**
- Utiliser des Edge Functions pour les calculs IA
- Implémenter des modèles légers pour les recommandations
- Créer une interface explicable pour les suggestions
- Permettre aux utilisateurs d'accepter/refuser les recommandations

---

### 20 - Intégration avec outils externes

🎯 **But clair**
Développer des connecteurs pour intégrer le dashboard avec des outils externes (Google Analytics, outils de CRM, plateformes de communication) pour enrichir les données et actions disponibles.

🧠 **Contexte technique**
Cette intégration nécessite la gestion de multiples APIs externes, l'authentification OAuth et la synchronisation de données. Elle étend les capacités du dashboard avec des sources de données externes.

🛠️ **Type de fichier concerné**
`.ts` - Services d'intégration et connecteurs

🔄 **Comportement attendu / Logique métier**
- Connecteurs pour Google Analytics, CRM externes
- Synchronisation bidirectionnelle des données
- Authentification OAuth pour les services externes
- Widgets enrichis avec données externes
- Actions vers les outils externes depuis le dashboard
- Gestion des erreurs et reconnexions automatiques

⚙️ **Interactions avec d'autres modules**
- Intègre : APIs externes via connecteurs
- Utilise : système d'authentification pour OAuth
- Enrichit : widgets existants avec nouvelles données
- Étend : actions rapides avec outils externes

💡 **Tips Windsurf**
- Utiliser des Edge Functions pour les intégrations sécurisées
- Implémenter des patterns de circuit breaker
- Créer des interfaces de configuration pour chaque intégration
- Gérer les quotas et limitations des APIs externes

---

### 21 - Dashboard mobile avec PWA

🎯 **But clair**
Créer une version mobile optimisée du dashboard avec fonctionnalités PWA (Progressive Web App) pour l'accès hors ligne et les notifications push.

🧠 **Contexte technique**
Cette évolution adapte le dashboard pour les appareils mobiles avec une interface tactile optimisée, support hors ligne et notifications push. Elle utilise les technologies PWA pour une expérience native.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts`, `manifest.json`, service worker

🔄 **Comportement attendu / Logique métier**
- Interface mobile responsive et tactile
- Fonctionnalités hors ligne avec cache intelligent
- Notifications push pour les alertes importantes
- Synchronisation automatique lors de la reconnexion
- Widgets adaptés aux petits écrans
- Installation comme app native

⚙️ **Interactions avec d'autres modules**
- Adapte : tous les widgets pour mobile
- Utilise : service workers pour le cache
- Intègre : notifications push Supabase
- Synchronise : données lors de la reconnexion

💡 **Tips Windsurf**
- Utiliser Workbox pour la gestion du cache PWA
- Optimiser les widgets pour les interactions tactiles
- Implémenter une stratégie de cache intelligente
- Créer des notifications push contextuelles

---

### 22 - Système de collaboration en temps réel

🎯 **But clair**
Implémenter des fonctionnalités de collaboration permettant aux utilisateurs de partager des vues dashboard en temps réel, commenter et collaborer sur les données affichées.

🧠 **Contexte technique**
Cette fonctionnalité utilise Supabase Realtime pour la collaboration en temps réel. Elle permet le partage de sessions, les commentaires collaboratifs et la synchronisation des vues entre utilisateurs.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants de collaboration

🔄 **Comportement attendu / Logique métier**
- Sessions de dashboard partagées en temps réel
- Curseurs et sélections des autres utilisateurs visibles
- Commentaires et annotations sur les widgets
- Chat intégré pour la discussion
- Historique des modifications collaboratives
- Permissions de collaboration granulaires

⚙️ **Interactions avec d'autres modules**
- Utilise : Supabase Realtime pour la synchronisation
- Intègre : système de permissions pour la collaboration
- Stocke : sessions et commentaires collaboratifs
- Notifie : participants des changements

💡 **Tips Windsurf**
- Gérer efficacement les connexions Realtime multiples
- Implémenter des indicateurs visuels pour la collaboration
- Créer un système de résolution de conflits
- Optimiser les performances avec de nombreux collaborateurs

---

### 23 - Dashboards thématiques et sectoriels

🎯 **But clair**
Créer des dashboards spécialisés par secteur d'activité (mariage, événementiel corporate, etc.) avec KPIs et widgets spécifiques à chaque domaine métier.

🧠 **Contexte technique**
Cette évolution étend le système de widgets avec des composants spécialisés par secteur. Elle utilise un système de plugins pour charger dynamiquement les widgets sectoriels selon la configuration.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Widgets spécialisés et système de plugins

🔄 **Comportement attendu / Logique métier**
- Widgets spécialisés par secteur (mariage, corporate, etc.)
- KPIs métier spécifiques (taux de satisfaction, ROI événements)
- Templates de dashboard par secteur
- Configuration automatique selon le type d'entreprise
- Marketplace de widgets communautaires
- API pour développer des widgets personnalisés

⚙️ **Interactions avec d'autres modules**
- Étend : système de widgets existant
- Utilise : configuration secteur de l'entreprise
- Intègre : données métier spécialisées
- Permet : développement de widgets tiers

💡 **Tips Windsurf**
- Créer une architecture de plugins extensible
- Documenter l'API de développement de widgets
- Implémenter un système de validation des widgets tiers
- Créer des templates de démarrage par secteur

---

### 24 - Analytics prédictifs et forecasting

🎯 **But clair**
Intégrer des capacités d'analytics prédictifs pour forecaster les tendances métier, prédire les performances futures et alerter sur les risques potentiels.

🧠 **Contexte technique**
Cette fonctionnalité avancée utilise des modèles de machine learning pour analyser les données historiques et prédire les tendances futures. Elle peut utiliser des services IA externes ou des modèles entraînés localement.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants d'analytics prédictifs

🔄 **Comportement attendu / Logique métier**
- Prédictions de chiffre d'affaires et performance
- Détection d'anomalies et alertes préventives
- Modèles de forecasting pour la planification
- Recommandations d'actions basées sur les prédictions
- Visualisations de tendances et scénarios
- Calibration et amélioration continue des modèles

⚙️ **Interactions avec d'autres modules**
- Analyse : données historiques de tous les modules
- Utilise : services de machine learning
- Génère : alertes et recommandations
- Intègre : visualisations prédictives dans les widgets

💡 **Tips Windsurf**
- Utiliser des modèles de time series pour les prédictions
- Implémenter des intervalles de confiance pour les prédictions
- Créer des visualisations claires pour les incertitudes
- Permettre l'ajustement manuel des modèles

---

## 📊 Matrice de Priorités et Dépendances

| Prompt | Priorité | Dépendances | Durée Estimée | Complexité |
|--------|----------|-------------|---------------|------------|
| 01-08  | P0       | Monorepo initialisé | 4-5 jours     | Moyenne    |
| 09-14  | P0       | 01-08       | 5-6 jours     | Élevée     |
| 15-18  | P1       | 09-14       | 3-4 jours     | Moyenne    |
| 19-24  | P2-P3    | 15-18       | 2-3 semaines  | Très élevée |

---

## 🔄 Ordre d'Exécution Recommandé

### **Phase 1 - Fondations + Navigation (Semaine 1)**
Prompts 01-08 : Base de données, RPC, types, services, sidebar et routes

### **Phase 2 - Interface Principale (Semaines 2-3)**
Prompts 09-14 : Layout, widgets principaux, interactions

### **Phase 3 - Personnalisation (Semaine 4)**
Prompts 15-18 : Drag & drop, configuration, export, analytics

### **Phase 4 - Évolutions Avancées (Futures versions)**
Prompts 19-24 : IA, intégrations, mobile, collaboration

---

## ⚠️ Points d'Attention Critiques

### **Performance et Optimisation**
- Optimiser les requêtes RPC pour les KPIs complexes
- Implémenter un cache intelligent pour les données fréquemment consultées
- Gérer efficacement les abonnements Realtime

### **Sécurité et Permissions**
- Vérifier les permissions à tous les niveaux (RPC, composants, actions)
- Filtrer les données selon les rôles utilisateur
- Sécuriser les configurations personnalisées

### **Expérience Utilisateur**
- Maintenir des temps de chargement < 4 secondes
- Implémenter des états de chargement informatifs
- Créer une interface intuitive pour la personnalisation

---

*Document généré par Manus AI - Expert en transformation de cahiers des charges pour Windsurf*

