# Prompts Windsurf - Module Console Admin

## ğŸ“‹ Informations du Module

- **Module** : Console Admin
- **Identifiant technique** : `console_admin`
- **Version** : 1.0.0
- **Application** : Backoffice (`apps/backoffice`)
- **PrioritÃ©** : P0 (Critique - Gestion des accÃ¨s et sÃ©curitÃ©)
- **DÃ©pendances** : Module Initialisation Monorepo, Supabase Auth
- **SchÃ©ma DB** : `admin_console` (nouveau schÃ©ma dÃ©diÃ©)

---

## ğŸ¯ Vue d'Ensemble du Module

Le module Console Admin constitue le cÅ“ur de la gestion des identitÃ©s, des accÃ¨s et de la sÃ©curitÃ© pour l'ensemble de l'Ã©cosystÃ¨me ERP Wedding Collection. Il centralise la gestion des utilisateurs, des rÃ´les, des permissions et de l'audit de sÃ©curitÃ© Ã  travers toutes les applications du monorepo.

Ce module s'intÃ¨gre dans l'application `apps/backoffice` et utilise un schÃ©ma dÃ©diÃ© `admin_console` dans Supabase. Il implÃ©mente un systÃ¨me RBAC (Role-Based Access Control) avec hÃ©ritage hiÃ©rarchique, gestion des scopes et audit complet des actions. Il constitue la fondation sÃ©curitaire sur laquelle tous les autres modules s'appuient.

---

## ğŸš€ Section 1 : Initialisation

### 01 - CrÃ©ation du schÃ©ma admin_console et tables principales

ğŸ¯ **But clair**
CrÃ©er le schÃ©ma `admin_console` dans Supabase avec les tables principales pour la gestion des utilisateurs, rÃ´les, permissions et audit, en respectant les conventions Supabase du projet.

ğŸ§  **Contexte technique**
Ce schÃ©ma centralise toute la logique de gestion des accÃ¨s de l'ERP. Il utilise un schÃ©ma dÃ©diÃ© pour isoler les donnÃ©es critiques de sÃ©curitÃ© et faciliter la gestion des permissions. Les tables respectent les conventions de nommage et incluent les champs standards du projet.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Migration Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- CrÃ©ation du schÃ©ma `admin_console`
- Tables : `user_profiles`, `roles`, `permissions`, `role_permissions`, `user_roles`, `exclusive_roles`, `audit_logs`, `password_history`
- Champs standards : id, created_at, updated_at, created_by, updated_by
- Contraintes d'intÃ©gritÃ© et de validation
- Index optimisÃ©s pour les performances

âš™ï¸ **Interactions avec d'autres modules**
- RÃ©fÃ©rence : auth.users (Supabase Auth)
- UtilisÃ© par : tous les modules pour vÃ©rification des permissions
- Base pour : systÃ¨me d'audit global
- IntÃ¨gre : avec le Dashboard pour les permissions

ğŸ’¡ **Tips Windsurf**
- Utiliser le MCP Supabase pour exÃ©cuter directement les migrations
- CrÃ©er les tables dans l'ordre des dÃ©pendances (user_profiles â†’ roles â†’ permissions â†’ tables de liaison)
- VÃ©rifier les contraintes CHECK pour les Ã©numÃ©rations
- Tester l'intÃ©gritÃ© rÃ©fÃ©rentielle avec des donnÃ©es de test

---

### 02 - Configuration des politiques RLS pour la sÃ©curitÃ©

ğŸ¯ **But clair**
Configurer les politiques Row Level Security (RLS) pour toutes les tables du schÃ©ma admin_console avec des rÃ¨gles granulaires selon les rÃ´les et permissions utilisateur.

ğŸ§  **Contexte technique**
Les politiques RLS assurent que chaque utilisateur ne peut accÃ©der qu'aux donnÃ©es autorisÃ©es selon son rÃ´le et ses permissions. Elles constituent la premiÃ¨re ligne de dÃ©fense de la sÃ©curitÃ© des donnÃ©es critiques.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Politiques RLS Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- RLS activÃ©e sur toutes les tables admin_console
- Politiques pour SELECT, INSERT, UPDATE, DELETE
- AccÃ¨s admin_erp : toutes les donnÃ©es
- AccÃ¨s utilisateurs : leurs propres donnÃ©es uniquement
- AccÃ¨s lecture seule pour certains rÃ´les sur les rÃ©fÃ©rentiels
- Audit logs : lecture seule pour les admins, insertion pour tous

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : auth.uid() pour identifier l'utilisateur connectÃ©
- IntÃ¨gre : avec les fonctions de vÃ©rification de permissions
- ProtÃ¨ge : donnÃ©es sensibles des autres modules
- RÃ©fÃ©rence : table user_roles pour les vÃ©rifications

ğŸ’¡ **Tips Windsurf**
- Tester les politiques avec diffÃ©rents rÃ´les utilisateur
- Utiliser des fonctions helper pour Ã©viter la duplication de code
- Documenter chaque politique avec des commentaires explicites
- PrÃ©voir des politiques d'urgence pour les cas d'exception

---

### 03 - CrÃ©ation des vues et vues matÃ©rialisÃ©es

ğŸ¯ **But clair**
CrÃ©er les vues `vw_user_roles`, `vw_user_permissions` (matÃ©rialisÃ©e) et `vw_role_hierarchy` pour optimiser les requÃªtes complexes de permissions et faciliter l'accÃ¨s aux donnÃ©es.

ğŸ§  **Contexte technique**
Ces vues simplifient l'accÃ¨s aux donnÃ©es complexes avec jointures multiples et calculs rÃ©cursifs. La vue matÃ©rialisÃ©e `vw_user_permissions` optimise les vÃ©rifications de permissions frÃ©quentes en prÃ©-calculant l'hÃ©ritage hiÃ©rarchique.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Vues et vues matÃ©rialisÃ©es

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- `vw_user_roles` : vue standard avec rÃ´les actifs et dÃ©tails
- `vw_user_permissions` : vue matÃ©rialisÃ©e avec permissions effectives incluant hÃ©ritage
- `vw_role_hierarchy` : vue rÃ©cursive pour affichage hiÃ©rarchique
- Index optimisÃ©s sur les vues matÃ©rialisÃ©es
- MÃ©canisme de rafraÃ®chissement automatique

âš™ï¸ **Interactions avec d'autres modules**
- UtilisÃ© par : toutes les fonctions RPC de vÃ©rification
- Optimise : requÃªtes du Dashboard et autres modules
- IntÃ¨gre : logique d'hÃ©ritage des rÃ´les parents
- Facilite : affichage dans l'interface Console Admin

ğŸ’¡ **Tips Windsurf**
- Utiliser WITH RECURSIVE pour la hiÃ©rarchie des rÃ´les
- CrÃ©er des index sur les colonnes de filtrage frÃ©quent
- Planifier le rafraÃ®chissement des vues matÃ©rialisÃ©es
- Tester les performances avec un volume de donnÃ©es rÃ©aliste

---

### 04 - Fonctions RPC pour la gestion des utilisateurs

ğŸ¯ **But clair**
CrÃ©er les fonctions RPC Supabase pour la gestion complÃ¨te du cycle de vie des utilisateurs : crÃ©ation, modification, activation/dÃ©sactivation, et gestion des profils Ã©tendus.

ğŸ§  **Contexte technique**
Ces fonctions RPC centralisent la logique mÃ©tier de gestion des utilisateurs. Elles intÃ¨grent Supabase Auth pour l'authentification et gÃ¨rent les profils Ã©tendus dans admin_console.user_profiles avec validation et audit.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Fonctions RPC Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- `rpc_create_user()` : crÃ©ation compte Supabase Auth + profil Ã©tendu
- `rpc_update_user_profile()` : modification profil avec validation
- `rpc_change_user_status()` : activation/dÃ©sactivation/suspension
- `rpc_reset_user_password()` : rÃ©initialisation mot de passe
- `rpc_get_user_details()` : rÃ©cupÃ©ration profil complet
- Validation des donnÃ©es et gestion d'erreurs
- Audit automatique de toutes les actions

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : Supabase Auth pour crÃ©ation/modification comptes
- IntÃ¨gre : systÃ¨me d'audit via audit_logs
- Peut appeler : module Notifications pour envoi emails
- VÃ©rifie : permissions avant exÃ©cution des actions

ğŸ’¡ **Tips Windsurf**
- Utiliser SECURITY DEFINER avec prÃ©caution
- ImplÃ©menter une validation robuste des donnÃ©es d'entrÃ©e
- GÃ©rer les transactions pour maintenir la cohÃ©rence
- CrÃ©er des fonctions helper pour Ã©viter la duplication

---

### 05 - Fonctions RPC pour la gestion des rÃ´les et permissions

ğŸ¯ **But clair**
CrÃ©er les fonctions RPC pour la gestion complÃ¨te des rÃ´les et permissions : CRUD des rÃ´les, assignation aux utilisateurs, gestion de la hiÃ©rarchie et vÃ©rification des permissions.

ğŸ§  **Contexte technique**
Ces fonctions implÃ©mentent la logique RBAC avec support de l'hÃ©ritage hiÃ©rarchique. Elles gÃ¨rent les contraintes d'exclusivitÃ© entre rÃ´les et optimisent les vÃ©rifications de permissions via les vues matÃ©rialisÃ©es.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Fonctions RPC Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- `rpc_create_role()` : crÃ©ation rÃ´le avec validation hiÃ©rarchie
- `rpc_assign_role_to_user()` : assignation avec vÃ©rification exclusivitÃ©
- `rpc_user_has_permission()` : vÃ©rification permission (fonction critique)
- `rpc_get_user_permissions()` : liste permissions utilisateur
- `rpc_manage_role_permissions()` : gestion permissions d'un rÃ´le
- Gestion des scopes (global, backoffice, client, vendor)
- PrÃ©vention des cycles dans la hiÃ©rarchie

âš™ï¸ **Interactions avec d'autres modules**
- UtilisÃ© par : tous les modules pour vÃ©rification permissions
- IntÃ¨gre : vues matÃ©rialisÃ©es pour optimisation
- GÃ¨re : contraintes mÃ©tier complexes
- Audit : toutes les modifications de permissions

ğŸ’¡ **Tips Windsurf**
- Optimiser `rpc_user_has_permission()` car appelÃ©e frÃ©quemment
- ImplÃ©menter la dÃ©tection de cycles dans la hiÃ©rarchie
- Utiliser des CTE pour les requÃªtes rÃ©cursives
- CrÃ©er des index sur les colonnes de jointure

---

### 06 - Fonctions RPC pour l'audit et la sÃ©curitÃ©

ğŸ¯ **But clair**
CrÃ©er les fonctions RPC pour la gestion de l'audit de sÃ©curitÃ© : journalisation des Ã©vÃ©nements, consultation des logs, et fonctions de sÃ©curitÃ© avancÃ©es.

ğŸ§  **Contexte technique**
Ces fonctions centralisent l'audit de sÃ©curitÃ© pour tout l'ERP. Elles enregistrent automatiquement les actions critiques et fournissent des outils de consultation et d'analyse pour les administrateurs.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.sql` - Fonctions RPC Supabase

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- `rpc_log_audit_event()` : enregistrement Ã©vÃ©nement audit
- `rpc_get_audit_logs()` : consultation logs avec filtres
- `rpc_get_security_dashboard()` : mÃ©triques sÃ©curitÃ©
- `rpc_check_password_history()` : vÃ©rification rÃ©utilisation mots de passe
- `rpc_get_user_activity()` : activitÃ© utilisateur spÃ©cifique
- Filtrage par date, utilisateur, action, module, sÃ©vÃ©ritÃ©
- AgrÃ©gation pour tableaux de bord sÃ©curitÃ©

âš™ï¸ **Interactions avec d'autres modules**
- AppelÃ© par : tous les modules pour audit
- Fournit : donnÃ©es pour Dashboard sÃ©curitÃ©
- IntÃ¨gre : avec systÃ¨me de notifications pour alertes
- Utilise : mÃ©tadonnÃ©es de session Supabase

ğŸ’¡ **Tips Windsurf**
- Optimiser les requÃªtes d'audit avec des index appropriÃ©s
- ImplÃ©menter une rÃ©tention automatique des logs anciens
- CrÃ©er des fonctions d'agrÃ©gation pour les mÃ©triques
- GÃ©rer les gros volumes avec pagination efficace

---

## ğŸ—ï¸ Section 2 : FonctionnalitÃ©s Principales

### 07 - Interface de gestion des utilisateurs

ğŸ¯ **But clair**
CrÃ©er l'interface React complÃ¨te pour la gestion des utilisateurs avec liste, crÃ©ation, modification, et gestion des statuts, intÃ©grÃ©e dans le Backoffice avec navigation appropriÃ©e.

ğŸ§  **Contexte technique**
Cette interface utilise les composants ShadCN UI et les services API pour interagir avec les fonctions RPC. Elle respecte le design system du projet et s'intÃ¨gre dans la sidebar du Backoffice avec les permissions appropriÃ©es.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Liste paginÃ©e des utilisateurs avec filtres (type, statut, recherche)
- Formulaire de crÃ©ation utilisateur avec validation
- Formulaire de modification profil utilisateur
- Actions : activation/dÃ©sactivation, suspension, rÃ©initialisation mot de passe
- Affichage des rÃ´les assignÃ©s et derniÃ¨re connexion
- Gestion des erreurs et Ã©tats de chargement
- Confirmation pour actions critiques

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : services API Console Admin
- IntÃ¨gre : sidebar Backoffice pour navigation
- Consomme : RPC de gestion utilisateurs
- Affiche : donnÃ©es d'audit pour traÃ§abilitÃ©

ğŸ’¡ **Tips Windsurf**
- Utiliser React Hook Form pour la gestion des formulaires
- ImplÃ©menter la validation cÃ´tÃ© client avec Zod
- CrÃ©er des composants rÃ©utilisables pour les actions utilisateur
- Optimiser les listes avec virtualisation si nÃ©cessaire

---

### 08 - Interface de gestion des rÃ´les et hiÃ©rarchie

ğŸ¯ **But clair**
CrÃ©er l'interface pour la gestion des rÃ´les avec affichage hiÃ©rarchique en arbre, crÃ©ation/modification de rÃ´les, et gestion de la hiÃ©rarchie parent/enfant.

ğŸ§  **Contexte technique**
Cette interface utilise un composant TreeView pour afficher la hiÃ©rarchie des rÃ´les. Elle permet la gestion complÃ¨te des rÃ´les avec drag & drop pour rÃ©organiser la hiÃ©rarchie et validation des contraintes mÃ©tier.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Affichage hiÃ©rarchique des rÃ´les en arbre
- CrÃ©ation de nouveaux rÃ´les avec sÃ©lection du parent
- Modification des rÃ´les existants
- RÃ©organisation hiÃ©rarchie par drag & drop
- Validation : prÃ©vention des cycles, contraintes d'exclusivitÃ©
- Affichage des permissions associÃ©es Ã  chaque rÃ´le
- Gestion des rÃ´les systÃ¨me (non modifiables)

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : composant TreeView de shared-ui
- Consomme : vw_role_hierarchy pour affichage
- IntÃ¨gre : gestion des permissions par rÃ´le
- Valide : contraintes mÃ©tier via RPC

ğŸ’¡ **Tips Windsurf**
- CrÃ©er un composant TreeView rÃ©utilisable dans shared-ui
- ImplÃ©menter la validation en temps rÃ©el des contraintes
- Utiliser des animations fluides pour le drag & drop
- PrÃ©voir l'expansion/collapse des nÅ“uds de l'arbre

---

### 09 - Interface de gestion des permissions

ğŸ¯ **But clair**
CrÃ©er l'interface pour la gestion du catalogue des permissions avec organisation par module/ressource, assignation aux rÃ´les, et visualisation des permissions effectives.

ğŸ§  **Contexte technique**
Cette interface organise les permissions par module et type de ressource pour faciliter la gestion. Elle utilise un composant PermissionsSelector pour l'assignation et affiche les permissions effectives avec l'hÃ©ritage.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Catalogue des permissions organisÃ© par module/ressource
- CrÃ©ation de nouvelles permissions avec validation format
- Assignation permissions aux rÃ´les avec sÃ©lection multiple
- Visualisation permissions effectives par utilisateur (avec hÃ©ritage)
- Recherche et filtrage des permissions
- Gestion des permissions systÃ¨me (non modifiables)
- PrÃ©visualisation impact des modifications

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : composant PermissionsSelector de shared-ui
- Consomme : vw_user_permissions pour affichage effectif
- IntÃ¨gre : avec gestion des rÃ´les
- Valide : format des permissions (resource:action)

ğŸ’¡ **Tips Windsurf**
- CrÃ©er un composant PermissionsSelector gÃ©nÃ©rique
- ImplÃ©menter une recherche efficace avec debouncing
- Utiliser des groupes visuels pour organiser les permissions
- Ajouter des tooltips explicatifs pour chaque permission

---

### 10 - Interface d'assignation des rÃ´les aux utilisateurs

ğŸ¯ **But clair**
CrÃ©er l'interface pour assigner et gÃ©rer les rÃ´les des utilisateurs avec gestion des scopes, dates d'expiration, et validation des contraintes d'exclusivitÃ©.

ğŸ§  **Contexte technique**
Cette interface gÃ¨re l'assignation complexe des rÃ´les avec support des scopes (global, client spÃ©cifique, etc.) et des contraintes mÃ©tier. Elle affiche les permissions rÃ©sultantes et valide les rÃ¨gles d'exclusivitÃ©.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- SÃ©lection utilisateur et affichage rÃ´les actuels
- Assignation nouveaux rÃ´les avec sÃ©lection scope
- Gestion dates d'expiration des rÃ´les
- Validation contraintes d'exclusivitÃ© en temps rÃ©el
- PrÃ©visualisation permissions rÃ©sultantes
- Historique des assignations de rÃ´les
- Actions : rÃ©vocation, modification expiration

âš™ï¸ **Interactions avec d'autres modules**
- Consomme : RPC d'assignation et validation
- Affiche : permissions effectives via vues
- IntÃ¨gre : avec gestion des utilisateurs
- Valide : contraintes d'exclusivitÃ©

ğŸ’¡ **Tips Windsurf**
- ImplÃ©menter la validation en temps rÃ©el des contraintes
- CrÃ©er une interface intuitive pour la gestion des scopes
- Utiliser des indicateurs visuels pour les conflits
- Ajouter des suggestions de rÃ´les selon le profil utilisateur

---

### 11 - Interface de consultation des logs d'audit

ğŸ¯ **But clair**
CrÃ©er l'interface de consultation et d'analyse des logs d'audit avec filtres avancÃ©s, recherche, export, et tableaux de bord de sÃ©curitÃ© pour les administrateurs.

ğŸ§  **Contexte technique**
Cette interface fournit des outils d'analyse de sÃ©curitÃ© pour les administrateurs. Elle utilise des filtres performants, la pagination et des visualisations pour analyser l'activitÃ© du systÃ¨me et dÃ©tecter les anomalies.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Liste paginÃ©e des logs avec filtres multiples
- Filtres : date, utilisateur, action, module, sÃ©vÃ©ritÃ©, statut
- Recherche textuelle dans les dÃ©tails des Ã©vÃ©nements
- Affichage dÃ©taillÃ© des Ã©vÃ©nements avec mÃ©tadonnÃ©es
- Export des logs (CSV, JSON) avec filtres appliquÃ©s
- Tableaux de bord : mÃ©triques sÃ©curitÃ©, activitÃ© utilisateurs
- Alertes pour Ã©vÃ©nements critiques

âš™ï¸ **Interactions avec d'autres modules**
- Consomme : RPC de consultation audit
- Affiche : donnÃ©es de tous les modules
- IntÃ¨gre : avec Dashboard pour mÃ©triques
- Utilise : composants de visualisation

ğŸ’¡ **Tips Windsurf**
- ImplÃ©menter une pagination efficace pour gros volumes
- CrÃ©er des filtres avec Ã©tat persistant
- Utiliser des graphiques pour visualiser les tendances
- Optimiser les requÃªtes avec des index appropriÃ©s

---

### 12 - Service API Console Admin

ğŸ¯ **But clair**
CrÃ©er le service API centralisÃ© pour toutes les interactions avec les fonctions RPC du module Console Admin, avec gestion d'erreurs, cache et types TypeScript stricts.

ğŸ§  **Contexte technique**
Ce service encapsule toutes les interactions avec Supabase pour le module Console Admin. Il utilise TanStack Query pour le cache, gÃ¨re les erreurs de maniÃ¨re standardisÃ©e et fournit une interface typÃ©e pour les composants React.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts` - Service API

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- MÃ©thodes pour gestion utilisateurs : create, update, delete, list
- MÃ©thodes pour gestion rÃ´les : CRUD, hiÃ©rarchie, assignation
- MÃ©thodes pour gestion permissions : CRUD, vÃ©rification
- MÃ©thodes pour audit : consultation, mÃ©triques
- Gestion d'erreurs avec types spÃ©cifiques
- Cache intelligent avec invalidation appropriÃ©e
- Retry automatique pour requÃªtes Ã©chouÃ©es

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : @wedding-collection/api-client
- IntÃ¨gre : types TypeScript du module
- Consomme : toutes les RPC admin_console
- UtilisÃ© par : tous les composants React

ğŸ’¡ **Tips Windsurf**
- Utiliser TanStack Query pour la gestion du cache
- CrÃ©er des types d'erreur spÃ©cifiques pour chaque opÃ©ration
- ImplÃ©menter des mÃ©thodes optimistes pour les mises Ã  jour
- Ajouter des logs dÃ©taillÃ©s pour le debugging

---

## ğŸ”§ Section 3 : FonctionnalitÃ©s Secondaires

### 13 - SystÃ¨me d'import/export des utilisateurs

ğŸ¯ **But clair**
ImplÃ©menter les fonctionnalitÃ©s d'import en masse des utilisateurs depuis CSV/Excel et d'export des donnÃ©es utilisateurs avec gestion des erreurs et validation des donnÃ©es.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© permet la gestion en masse des utilisateurs pour faciliter les migrations et la maintenance. Elle inclut la validation des donnÃ©es, la gestion des erreurs et la crÃ©ation de rapports d'import/export.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants et services

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Import CSV/Excel avec mapping des colonnes
- Validation des donnÃ©es avant import
- Gestion des erreurs et doublons
- Rapport d'import avec succÃ¨s/Ã©checs
- Export des utilisateurs avec filtres
- Templates d'import tÃ©lÃ©chargeables
- PrÃ©visualisation avant import final

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : services API Console Admin
- IntÃ¨gre : validation des rÃ´les et permissions
- GÃ©nÃ¨re : logs d'audit pour traÃ§abilitÃ©
- Peut dÃ©clencher : notifications email

ğŸ’¡ **Tips Windsurf**
- Utiliser une bibliothÃ¨que comme Papa Parse pour CSV
- ImplÃ©menter la validation par chunks pour gros volumes
- CrÃ©er des templates d'import clairs et documentÃ©s
- GÃ©rer les transactions pour maintenir la cohÃ©rence

---

### 14 - Interface de configuration des politiques de sÃ©curitÃ©

ğŸ¯ **But clair**
CrÃ©er l'interface pour configurer les politiques de sÃ©curitÃ© : complexitÃ© des mots de passe, durÃ©e de session, tentatives de connexion, et autres paramÃ¨tres de sÃ©curitÃ©.

ğŸ§  **Contexte technique**
Cette interface permet aux administrateurs de configurer les politiques de sÃ©curitÃ© globales du systÃ¨me. Elle intÃ¨gre avec Supabase Auth pour certains paramÃ¨tres et gÃ¨re les configurations spÃ©cifiques au projet.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Configuration complexitÃ© mots de passe
- ParamÃ¨tres de session (durÃ©e, inactivitÃ©)
- Politiques de verrouillage de compte
- Configuration MFA (activation, mÃ©thodes)
- ParamÃ¨tres d'audit (rÃ©tention, niveaux)
- Notifications de sÃ©curitÃ©
- Validation et prÃ©visualisation des changements

âš™ï¸ **Interactions avec d'autres modules**
- Configure : paramÃ¨tres Supabase Auth
- IntÃ¨gre : avec systÃ¨me de notifications
- Affecte : comportement de tous les modules
- Stocke : configurations dans table dÃ©diÃ©e

ğŸ’¡ **Tips Windsurf**
- CrÃ©er des formulaires avec validation en temps rÃ©el
- ImplÃ©menter des prÃ©visualisations des politiques
- Ajouter des explications claires pour chaque paramÃ¨tre
- GÃ©rer les configurations par environnement

---

### 15 - SystÃ¨me de notifications et alertes de sÃ©curitÃ©

ğŸ¯ **But clair**
ImplÃ©menter le systÃ¨me de notifications automatiques pour les Ã©vÃ©nements de sÃ©curitÃ© : tentatives de connexion suspectes, modifications de permissions, et alertes administratives.

ğŸ§  **Contexte technique**
Ce systÃ¨me surveille les Ã©vÃ©nements de sÃ©curitÃ© et dÃ©clenche des notifications appropriÃ©es. Il utilise des rÃ¨gles configurables pour dÃ©tecter les anomalies et alerter les administrateurs via diffÃ©rents canaux.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts`, `.tsx` - Services et composants

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- DÃ©tection tentatives de connexion suspectes
- Alertes modifications permissions critiques
- Notifications crÃ©ation/suppression utilisateurs
- Surveillance activitÃ© administrative
- Configuration des seuils d'alerte
- Canaux de notification (email, in-app, webhook)
- Escalade selon la sÃ©vÃ©ritÃ©

âš™ï¸ **Interactions avec d'autres modules**
- Utilise : logs d'audit pour dÃ©tection
- IntÃ¨gre : module Notifications pour envoi
- DÃ©clenche : alertes temps rÃ©el
- Configure : via interface administrateur

ğŸ’¡ **Tips Windsurf**
- Utiliser des triggers PostgreSQL pour dÃ©tection temps rÃ©el
- ImplÃ©menter des rÃ¨gles configurables pour les alertes
- CrÃ©er des templates de notification personnalisables
- GÃ©rer la dÃ©duplication des alertes similaires

---

### 16 - Interface de monitoring et mÃ©triques de sÃ©curitÃ©

ğŸ¯ **But clair**
CrÃ©er des tableaux de bord de monitoring de sÃ©curitÃ© avec mÃ©triques en temps rÃ©el, graphiques de tendances, et indicateurs de santÃ© du systÃ¨me de sÃ©curitÃ©.

ğŸ§  **Contexte technique**
Cette interface fournit une vue d'ensemble de la sÃ©curitÃ© du systÃ¨me avec des mÃ©triques calculÃ©es en temps rÃ©el. Elle utilise des graphiques et des indicateurs visuels pour faciliter le monitoring par les administrateurs.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx` - Composants React

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- MÃ©triques temps rÃ©el : connexions, Ã©checs, activitÃ©
- Graphiques de tendances sur diffÃ©rentes pÃ©riodes
- Indicateurs de santÃ© sÃ©curitÃ© (score global)
- Top utilisateurs actifs et actions frÃ©quentes
- DÃ©tection d'anomalies avec alertes visuelles
- Export des rapports de sÃ©curitÃ©
- Comparaisons pÃ©riodiques

âš™ï¸ **Interactions avec d'autres modules**
- Consomme : donnÃ©es d'audit agrÃ©gÃ©es
- Utilise : RPC de mÃ©triques sÃ©curitÃ©
- IntÃ¨gre : avec Dashboard principal
- Affiche : donnÃ©es de tous les modules

ğŸ’¡ **Tips Windsurf**
- Utiliser des graphiques performants (Recharts)
- ImplÃ©menter des calculs de mÃ©triques optimisÃ©s
- CrÃ©er des indicateurs visuels intuitifs
- Permettre la personnalisation des tableaux de bord

---

## ğŸš€ Section 4 : Ã‰volutions Futures

### 17 - IntÃ©gration avec services d'authentification externes

ğŸ¯ **But clair**
DÃ©velopper l'intÃ©gration avec des services d'authentification externes (LDAP, Active Directory, SAML, OAuth providers) pour permettre l'authentification unifiÃ©e en entreprise.

ğŸ§  **Contexte technique**
Cette Ã©volution permet l'intÃ©gration avec les systÃ¨mes d'authentification d'entreprise existants. Elle utilise les capacitÃ©s d'extension de Supabase Auth et des Edge Functions pour gÃ©rer les protocoles d'authentification complexes.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts` - Services d'intÃ©gration et Edge Functions

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Configuration des providers externes (LDAP, SAML, OAuth)
- Synchronisation automatique des utilisateurs
- Mapping des rÃ´les et permissions
- Authentification unique (SSO)
- Gestion des sessions hybrides
- Fallback vers authentification locale
- Audit des authentifications externes

âš™ï¸ **Interactions avec d'autres modules**
- Ã‰tend : Supabase Auth avec providers externes
- Synchronise : utilisateurs et rÃ´les automatiquement
- IntÃ¨gre : avec systÃ¨mes d'entreprise
- Maintient : cohÃ©rence des permissions

ğŸ’¡ **Tips Windsurf**
- Utiliser des Edge Functions pour les intÃ©grations complexes
- ImplÃ©menter des stratÃ©gies de fallback robustes
- CrÃ©er des interfaces de configuration flexibles
- GÃ©rer la synchronisation incrÃ©mentale des donnÃ©es

---

### 18 - SystÃ¨me de dÃ©lÃ©gation et approbation

ğŸ¯ **But clair**
ImplÃ©menter un systÃ¨me de dÃ©lÃ©gation de permissions et de workflows d'approbation pour les actions sensibles, avec gestion des dÃ©lÃ©gations temporaires et hiÃ©rarchiques.

ğŸ§  **Contexte technique**
Ce systÃ¨me permet la dÃ©lÃ©gation temporaire de permissions et l'implÃ©mentation de workflows d'approbation pour les actions critiques. Il utilise des rÃ¨gles configurables et des notifications pour gÃ©rer les processus d'approbation.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants et services

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- DÃ©lÃ©gation temporaire de permissions
- Workflows d'approbation configurables
- Gestion des approbateurs multiples
- Notifications et relances automatiques
- Historique des dÃ©lÃ©gations et approbations
- RÃ©vocation et modification des dÃ©lÃ©gations
- Escalade automatique selon les dÃ©lais

âš™ï¸ **Interactions avec d'autres modules**
- Ã‰tend : systÃ¨me de permissions existant
- Utilise : module Notifications pour workflows
- IntÃ¨gre : avec tous les modules pour approbations
- Stocke : historique dans audit_logs

ğŸ’¡ **Tips Windsurf**
- CrÃ©er des workflows flexibles et configurables
- ImplÃ©menter des mÃ©canismes d'escalade automatique
- Utiliser des Ã©tats de machine pour gÃ©rer les workflows
- CrÃ©er des interfaces intuitives pour la dÃ©lÃ©gation

---

### 19 - Analytics avancÃ©s et intelligence artificielle

ğŸ¯ **But clair**
IntÃ©grer des capacitÃ©s d'analytics avancÃ©s et d'IA pour la dÃ©tection d'anomalies de sÃ©curitÃ©, l'analyse comportementale des utilisateurs et les recommandations de sÃ©curitÃ©.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© utilise des algorithmes de machine learning pour analyser les patterns de comportement et dÃ©tecter les anomalies de sÃ©curitÃ©. Elle peut utiliser des services IA externes ou des modÃ¨les locaux via Edge Functions.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts` - Services IA et analytics

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- DÃ©tection d'anomalies comportementales
- Analyse des patterns d'accÃ¨s suspects
- Recommandations de permissions optimales
- Scoring de risque par utilisateur
- PrÃ©diction des besoins en permissions
- Alertes intelligentes avec contexte
- Rapports d'analyse automatisÃ©s

âš™ï¸ **Interactions avec d'autres modules**
- Analyse : donnÃ©es d'audit et d'activitÃ©
- Utilise : services IA (OpenAI, services locaux)
- GÃ©nÃ¨re : alertes et recommandations
- IntÃ¨gre : avec systÃ¨me de notifications

ğŸ’¡ **Tips Windsurf**
- Utiliser des Edge Functions pour les calculs IA
- ImplÃ©menter des modÃ¨les d'apprentissage incrÃ©mental
- CrÃ©er des interfaces explicables pour les recommandations
- GÃ©rer la confidentialitÃ© des donnÃ©es analysÃ©es

---

### 20 - ConformitÃ© et rapports rÃ©glementaires

ğŸ¯ **But clair**
DÃ©velopper des outils de conformitÃ© rÃ©glementaire (RGPD, SOX, ISO 27001) avec gÃ©nÃ©ration automatique de rapports, gestion des consentements et audit de conformitÃ©.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© assure la conformitÃ© avec les rÃ©glementations de sÃ©curitÃ© et de protection des donnÃ©es. Elle gÃ©nÃ¨re automatiquement les rapports requis et maintient la documentation de conformitÃ©.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.tsx`, `.ts` - Composants et services de conformitÃ©

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Templates de rapports rÃ©glementaires
- GÃ©nÃ©ration automatique de documentation
- Gestion des consentements utilisateurs
- Audit de conformitÃ© automatisÃ©
- Alertes de non-conformitÃ©
- Archivage sÃ©curisÃ© des preuves
- Interfaces pour audits externes

âš™ï¸ **Interactions avec d'autres modules**
- Collecte : donnÃ©es de tous les modules
- GÃ©nÃ¨re : rapports de conformitÃ©
- IntÃ¨gre : avec systÃ¨mes de gestion documentaire
- Maintient : historique de conformitÃ©

ğŸ’¡ **Tips Windsurf**
- CrÃ©er des templates flexibles pour diffÃ©rentes rÃ©glementations
- ImplÃ©menter des mÃ©canismes de preuve cryptographique
- Automatiser la collecte des preuves de conformitÃ©
- CrÃ©er des interfaces pour les auditeurs externes

---

### 21 - FÃ©dÃ©ration d'identitÃ©s multi-tenant

ğŸ¯ **But clair**
ImplÃ©menter un systÃ¨me de fÃ©dÃ©ration d'identitÃ©s pour supporter une architecture multi-tenant avec isolation des donnÃ©es et gestion centralisÃ©e des identitÃ©s.

ğŸ§  **Contexte technique**
Cette Ã©volution permet de gÃ©rer plusieurs organisations (tenants) avec leurs propres utilisateurs et permissions tout en maintenant une gestion centralisÃ©e. Elle utilise des concepts avancÃ©s d'isolation et de fÃ©dÃ©ration.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts`, `.sql` - Services et migrations

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- Gestion multi-tenant avec isolation
- FÃ©dÃ©ration d'identitÃ©s entre tenants
- Permissions cross-tenant configurables
- Administration centralisÃ©e et dÃ©lÃ©guÃ©e
- Facturation et quotas par tenant
- Migration d'utilisateurs entre tenants
- Audit global et par tenant

âš™ï¸ **Interactions avec d'autres modules**
- Restructure : tous les modules pour multi-tenancy
- Ã‰tend : systÃ¨me de permissions avec tenants
- IntÃ¨gre : facturation et quotas
- Maintient : isolation des donnÃ©es

ğŸ’¡ **Tips Windsurf**
- Concevoir l'isolation des donnÃ©es dÃ¨s le dÃ©but
- Utiliser des patterns de tenant-aware queries
- ImplÃ©menter des mÃ©canismes de migration sÃ©curisÃ©s
- CrÃ©er des interfaces d'administration hiÃ©rarchiques

---

### 22 - Blockchain et identitÃ© dÃ©centralisÃ©e

ğŸ¯ **But clair**
Explorer l'intÃ©gration avec des technologies blockchain pour l'identitÃ© dÃ©centralisÃ©e, la vÃ©rification cryptographique des permissions et l'audit immuable.

ğŸ§  **Contexte technique**
Cette fonctionnalitÃ© expÃ©rimentale explore l'utilisation de la blockchain pour crÃ©er un systÃ¨me d'identitÃ© dÃ©centralisÃ© et un audit immuable. Elle peut utiliser des solutions comme Ethereum ou des blockchains privÃ©es.

ğŸ› ï¸ **Type de fichier concernÃ©**
`.ts` - Services blockchain et crypto

ğŸ”„ **Comportement attendu / Logique mÃ©tier**
- IdentitÃ©s dÃ©centralisÃ©es (DID)
- VÃ©rification cryptographique des permissions
- Audit immuable sur blockchain
- Smart contracts pour gouvernance
- Tokens de permissions non-fongibles
- Consensus distribuÃ© pour modifications critiques
- InteropÃ©rabilitÃ© avec systÃ¨mes externes

âš™ï¸ **Interactions avec d'autres modules**
- ComplÃ¨te : systÃ¨me d'audit traditionnel
- VÃ©rifie : intÃ©gritÃ© des permissions
- IntÃ¨gre : avec wallets et identitÃ©s crypto
- Maintient : compatibilitÃ© avec systÃ¨mes existants

ğŸ’¡ **Tips Windsurf**
- Commencer par des preuves de concept simples
- Utiliser des solutions blockchain Ã©prouvÃ©es
- Maintenir la compatibilitÃ© avec les systÃ¨mes existants
- Ã‰valuer les coÃ»ts et performances rÃ©guliÃ¨rement

---

## ğŸ“Š Matrice de PrioritÃ©s et DÃ©pendances

| Prompt | PrioritÃ© | DÃ©pendances | DurÃ©e EstimÃ©e | ComplexitÃ© |
|--------|----------|-------------|---------------|------------|
| 01-06  | P0       | Monorepo initialisÃ© | 5-6 jours     | Ã‰levÃ©e     |
| 07-12  | P0       | 01-06       | 6-7 jours     | Ã‰levÃ©e     |
| 13-16  | P1       | 07-12       | 4-5 jours     | Moyenne    |
| 17-22  | P2-P3    | 13-16       | 3-4 semaines  | TrÃ¨s Ã©levÃ©e |

---

## ğŸ”„ Ordre d'ExÃ©cution RecommandÃ©

### **Phase 1 - Infrastructure SÃ©curitÃ© (Semaines 1-2)**
Prompts 01-06 : SchÃ©ma, tables, RLS, vues, fonctions RPC

### **Phase 2 - Interfaces Principales (Semaines 3-4)**
Prompts 07-12 : Gestion utilisateurs, rÃ´les, permissions, audit

### **Phase 3 - FonctionnalitÃ©s AvancÃ©es (Semaine 5)**
Prompts 13-16 : Import/export, politiques, notifications, monitoring

### **Phase 4 - Ã‰volutions Futures (Versions ultÃ©rieures)**
Prompts 17-22 : IntÃ©grations externes, IA, conformitÃ©, blockchain

---

## âš ï¸ Points d'Attention Critiques

### **SÃ©curitÃ© et Permissions**
- Tester rigoureusement toutes les politiques RLS
- Valider l'hÃ©ritage des permissions dans la hiÃ©rarchie
- SÃ©curiser les fonctions RPC avec SECURITY DEFINER appropriÃ©
- Auditer toutes les actions critiques

### **Performance et ScalabilitÃ©**
- Optimiser les vues matÃ©rialisÃ©es pour les vÃ©rifications frÃ©quentes
- Indexer correctement les tables pour les requÃªtes de permissions
- GÃ©rer efficacement les gros volumes de logs d'audit
- Planifier la rÃ©tention des donnÃ©es historiques

### **IntÃ©gration et CohÃ©rence**
- Assurer la cohÃ©rence avec Supabase Auth
- Maintenir la compatibilitÃ© avec tous les modules existants
- Valider l'intÃ©gration avec la sidebar du Backoffice
- Tester les workflows complets de gestion des accÃ¨s

### **Audit et ConformitÃ©**
- Enregistrer tous les Ã©vÃ©nements critiques
- Maintenir l'intÃ©gritÃ© des logs d'audit
- ImplÃ©menter des mÃ©canismes de non-rÃ©pudiation
- PrÃ©parer la conformitÃ© rÃ©glementaire

---

*Document gÃ©nÃ©rÃ© par Manus AI - Expert en transformation de cahiers des charges pour Windsurf*

