# Prompts Windsurf - Module Leads du Backoffice

## 📋 Informations du Module

- **Module** : Gestion des Leads (Backoffice)
- **Identifiant technique** : `backoffice_leads`
- **Version** : 1.0.0
- **Application** : Backoffice (`apps/backoffice`)
- **Priorité** : P1 (Haute - Module commercial fondamental)
- **Dépendances** : Module Initialisation Monorepo, Console Admin, Dashboard, Module Lieux
- **Schéma DB** : `bo` (tables leads et commercial)

---

## 🎯 Vue d'Ensemble du Module

Le module Leads du Backoffice constitue le moteur commercial de l'ERP Wedding Collection. Il centralise la gestion complète du processus commercial depuis la capture des prospects jusqu'à leur conversion en clients, avec scoring automatique, suivi des interactions, workflows de qualification et intégrations avec l'écosystème complet.

Ce module s'intègre dans l'application `apps/backoffice` via le bouton "Leads" de la sidebar. Il utilise le schéma `bo` de Supabase pour les données commerciales spécifiques et s'interface avec le schéma `shared` pour les intégrations inter-modules.

---

## 🚀 Section 1 : Initialisation

### 01 - Création des tables principales et types énumérés

🎯 **But clair**
Créer les tables principales du module Leads dans le schéma `bo` avec les types énumérés commerciaux, en respectant les conventions Supabase du projet et en assurant l'intégrité référentielle avec les autres modules.

🧠 **Contexte technique**
Ces tables constituent le cœur du processus commercial. Elles incluent la table principale `leads` avec toutes les informations de qualification, les tables d'interactions et de tâches pour le suivi, ainsi que les types énumérés pour standardiser les valeurs commerciales. La structure doit supporter la complexité du cycle de vente tout en restant performante.

🛠️ **Type de fichier concerné**
`.sql` - Migration Supabase

🔄 **Comportement attendu / Logique métier**
- Création des types énumérés : interaction_type_enum, status_category_enum, task_status_enum, task_priority_enum
- Table leads avec informations complètes (contact, qualification, événement, suivi)
- Tables liées : lead_interactions, tasks avec relations appropriées
- Contraintes d'intégrité et validation (budgets positifs, dates cohérentes)
- Champs standards : id, created_at, updated_at, created_by, updated_by, deleted_at
- Support RGPD avec champs de consentement

⚙️ **Interactions avec d'autres modules**
- Référence : shared.user_profiles (Console Admin)
- Intègre : avec shared.clients et shared.evenements pour conversion
- Base pour : Dashboard (métriques commerciales)
- Utilise : système d'audit global

💡 **Tips Windsurf**
- Utiliser le MCP Supabase pour exécuter directement les migrations
- Créer les types énumérés avant les tables pour éviter les erreurs
- Valider les contraintes CHECK avec des exemples métier concrets
- Prévoir l'extensibilité avec des champs JSONB pour métadonnées commerciales

---

### 02 - Création des tables de référence et liaisons

🎯 **But clair**
Créer les tables de référence commerciales (lead_statuses, lead_sources, lead_tags, lead_services) et les tables de liaison (lead_tag_links, lead_service_links) avec leurs relations et métadonnées.

🧠 **Contexte technique**
Ces tables de référence standardisent les données commerciales et permettent une gestion cohérente des statuts, sources, tags et services d'intérêt. Les tables de liaison implémentent les relations many-to-many pour la segmentation et la qualification avancée des leads.

🛠️ **Type de fichier concerné**
`.sql` - Migration Supabase

🔄 **Comportement attendu / Logique métier**
- Tables de référence : lead_statuses (avec catégories et couleurs), lead_sources, lead_tags, lead_services
- Tables de liaison : lead_tag_links, lead_service_links avec contraintes d'unicité
- Gestion des ordres d'affichage et des couleurs pour l'interface
- Support des statuts finaux et des catégories (open, won, lost)
- Champs is_active pour désactivation logique
- Métadonnées extensibles pour personnalisation

⚙️ **Interactions avec d'autres modules**
- Partagé : avec Module Dashboard pour métriques par statut/source
- Référencé : par Module Événements pour services demandés
- Étendu : par Console IA pour scoring automatique
- Synchronisé : avec données de campagnes marketing

💡 **Tips Windsurf**
- Utiliser des contraintes UNIQUE pour éviter les doublons dans les référentiels
- Prévoir des index sur les colonnes de recherche et filtrage fréquents
- Implémenter des triggers pour l'audit automatique des changements
- Structurer les couleurs en format hexadécimal pour l'interface

---

### 03 - Configuration des index et optimisations de performance

🎯 **But clair**
Créer tous les index optimisés pour les requêtes fréquentes du module Leads, incluant la recherche de contacts, les filtres commerciaux et les jointures avec les tables de référence.

🧠 **Contexte technique**
Les index sont cruciaux pour les performances car le module sera intensivement utilisé pour la recherche, le filtrage et le suivi des leads. L'optimisation doit couvrir les recherches par contact (email, téléphone), les filtres commerciaux (statut, assignation, date) et les jointures fréquentes.

🛠️ **Type de fichier concerné**
`.sql` - Migration Supabase

🔄 **Comportement attendu / Logique métier**
- Index sur colonnes de recherche : email_1, phone_1, noms
- Index composites pour filtres : status_id, assigned_user_id, source_id
- Index sur dates : event_date_planned, last_activity_date, created_at
- Index sur clés étrangères pour jointures optimisées
- Index partiels pour données actives (WHERE deleted_at IS NULL)
- Analyse des performances avec EXPLAIN pour validation

⚙️ **Interactions avec d'autres modules**
- Optimise : requêtes depuis Dashboard pour métriques
- Améliore : recherches de doublons lors de la création
- Facilite : intégrations avec Module Clients/Événements
- Supporte : rapports et analytics commerciaux

💡 **Tips Windsurf**
- Analyser les patterns de requêtes commerciales avant création des index
- Utiliser EXPLAIN ANALYZE pour valider les gains de performance
- Créer des index partiels pour optimiser l'espace disque
- Monitorer l'utilisation des index en production avec pg_stat_user_indexes

---

### 04 - Configuration des politiques RLS et sécurité commerciale

🎯 **But clair**
Configurer les politiques Row Level Security (RLS) pour toutes les tables du module avec des règles granulaires selon les rôles commerciaux, en assurant la confidentialité des données prospects.

🧠 **Contexte technique**
Les politiques RLS sont critiques car les données de leads sont sensibles commercialement. Elles doivent permettre l'accès selon les rôles (admin, manager, commercial) tout en respectant les assignations et la hiérarchie commerciale. La sécurité doit aussi intégrer les aspects RGPD.

🛠️ **Type de fichier concerné**
`.sql` - Politiques RLS Supabase

🔄 **Comportement attendu / Logique métier**
- RLS activée sur toutes les tables sensibles du schéma bo
- Accès complet pour admin_erp et manager_commercial
- Accès restreint pour commercial (leads assignés ou créés par eux)
- Accès limité pour wedding_planner (leads convertis liés à leurs événements)
- Politiques spécifiques pour interactions et tâches
- Respect des contraintes RGPD dans les politiques
- Audit automatique des accès sensibles

⚙️ **Interactions avec d'autres modules**
- Utilise : système de permissions Console Admin
- Intègre : avec auth.uid() et rôles utilisateur
- Respecte : hiérarchie commerciale définie
- Protège : données sensibles inter-applications

💡 **Tips Windsurf**
- Tester les politiques avec différents rôles commerciaux
- Utiliser des fonctions helper pour la hiérarchie commerciale
- Prévoir des politiques d'urgence pour maintenance
- Documenter chaque politique avec des exemples de cas d'usage

---

### 05 - Fonctions RPC pour la gestion commerciale des leads

🎯 **But clair**
Créer les fonctions RPC Supabase pour la gestion complète des leads : CRUD optimisé, détection de doublons, scoring, conversion et validation métier avec audit automatique.

🧠 **Contexte technique**
Ces fonctions RPC centralisent la logique métier complexe du processus commercial. Elles intègrent la validation des données, la détection de doublons, le calcul de scores, la gestion des conversions et l'audit automatique. Elles constituent l'API backend du module commercial.

🛠️ **Type de fichier concerné**
`.sql` - Fonctions RPC Supabase

🔄 **Comportement attendu / Logique métier**
- `rpc_create_lead()` : création avec détection de doublons et validation
- `rpc_update_lead()` : modification avec historique des changements
- `rpc_get_leads_list()` : recherche avancée avec filtres et pagination
- `rpc_get_lead_details()` : récupération complète avec relations
- `rpc_convert_lead()` : conversion transactionnelle vers client/événement
- `rpc_calculate_lead_score()` : scoring basé sur critères métier
- Validation des données commerciales (budgets, dates, contacts)
- Audit automatique de toutes les actions commerciales critiques

⚙️ **Interactions avec d'autres modules**
- Utilise : Console Admin pour vérification permissions
- Intègre : avec Module Clients pour conversion
- Fournit : API pour Module Événements
- Consomme : Module Lieux pour qualification

💡 **Tips Windsurf**
- Utiliser SECURITY DEFINER avec validation stricte des permissions
- Implémenter la logique de détection de doublons côté serveur
- Gérer les transactions pour maintenir la cohérence lors des conversions
- Créer des fonctions helper pour le calcul de scores personnalisables

---

### 06 - Configuration des triggers et automatisations

🎯 **But clair**
Configurer les triggers PostgreSQL pour l'automatisation des processus commerciaux : mise à jour des dates d'activité, notifications, scoring automatique et synchronisation inter-modules.

🧠 **Contexte technique**
Les triggers automatisent les processus critiques du cycle commercial. Ils maintiennent la cohérence des données (dates d'activité), déclenchent les notifications, calculent les scores et synchronisent avec les autres modules. Ils sont essentiels pour l'efficacité opérationnelle.

🛠️ **Type de fichier concerné**
`.sql` - Triggers PostgreSQL

🔄 **Comportement attendu / Logique métier**
- Trigger de mise à jour automatique de last_activity_date
- Trigger de notification lors de changement de statut critique
- Trigger de calcul de score automatique lors de modification
- Trigger de synchronisation avec shared.notifications
- Trigger d'audit pour traçabilité des actions commerciales
- Trigger de validation des données avant insertion/modification
- Gestion des erreurs et rollback en cas de problème

⚙️ **Interactions avec d'autres modules**
- Notifie : via shared.notifications pour Dashboard
- Synchronise : avec Module Clients lors des conversions
- Intègre : avec système d'audit global
- Déclenche : workflows Console IA si configurés

💡 **Tips Windsurf**
- Utiliser des triggers AFTER pour éviter les conflits
- Implémenter une gestion d'erreur robuste dans les triggers
- Prévoir des mécanismes de désactivation pour maintenance
- Tester les triggers avec des volumes de données réalistes

---

## 🏗️ Section 2 : Fonctionnalités Principales

### 07 - Interface de liste et recherche des leads

🎯 **But clair**
Créer l'interface principale de liste des leads avec recherche avancée, filtres multiples, tri, pagination et actions en lot, en utilisant les composants ShadCN UI pour la cohérence et l'efficacité commerciale.

🧠 **Contexte technique**
Cette interface constitue le cockpit commercial principal du module. Elle doit gérer efficacement de gros volumes de leads avec une UX optimisée pour les commerciaux. L'implémentation utilise React Hook Form pour les filtres, TanStack Query pour la gestion des données et des composants optimisés pour les performances.

🛠️ **Type de fichier concerné**
`.tsx` - Composants React

🔄 **Comportement attendu / Logique métier**
- Liste paginée avec 25 éléments par page par défaut
- Recherche textuelle en temps réel avec debouncing (nom, email, téléphone)
- Filtres commerciaux : statut, source, assignation, date de création, budget
- Tri : nom, date création, dernière activité, score, budget
- Actions en lot : assignation, changement de statut, export
- Indicateurs visuels : score, urgence, dernière activité
- Navigation rapide vers détail et édition

⚙️ **Interactions avec d'autres modules**
- Consomme : RPC de recherche et filtrage des leads
- Utilise : composants shared-ui pour cohérence
- Intègre : avec système de permissions pour actions
- Navigue : vers formulaires de création/édition

💡 **Tips Windsurf**
- Utiliser React Hook Form pour la gestion des filtres complexes
- Implémenter la virtualisation pour les grandes listes de leads
- Créer des composants réutilisables pour les cartes de lead
- Optimiser les requêtes avec mise en cache intelligente et invalidation

---

### 08 - Vue Kanban pour le pipeline commercial

🎯 **But clair**
Créer la vue Kanban des leads organisée par statut avec drag & drop pour le changement de statut, métriques par colonne et actions contextuelles pour optimiser le suivi du pipeline commercial.

🧠 **Contexte technique**
Cette vue Kanban est essentielle pour la gestion visuelle du pipeline commercial. Elle utilise une bibliothèque de drag & drop performante, gère les états de transition et fournit une vue d'ensemble claire de la répartition des leads par statut avec des métriques en temps réel.

🛠️ **Type de fichier concerné**
`.tsx` - Composants React

🔄 **Comportement attendu / Logique métier**
- Colonnes dynamiques basées sur les statuts actifs
- Drag & drop fluide avec validation des transitions autorisées
- Métriques par colonne : nombre de leads, valeur totale estimée
- Actions contextuelles : édition rapide, assignation, ajout d'interaction
- Filtres applicables à la vue Kanban (assignation, source, période)
- Indicateurs visuels : priorité, score, délai depuis dernière activité
- Actualisation en temps réel des changements

⚙️ **Interactions avec d'autres modules**
- Utilise : RPC de mise à jour de statut des leads
- Intègre : avec système de permissions pour drag & drop
- Synchronise : avec vue liste pour cohérence des données
- Notifie : changements via système de notifications

💡 **Tips Windsurf**
- Utiliser @dnd-kit/core pour un drag & drop performant et accessible
- Implémenter des animations fluides pour les transitions
- Gérer les états de chargement pendant les mises à jour
- Créer des composants de carte de lead optimisés pour le Kanban

---

### 09 - Formulaire de création et édition de lead

🎯 **But clair**
Créer le formulaire complet de création et édition de lead avec validation Zod, détection de doublons en temps réel, sauvegarde automatique et interface intuitive pour toutes les informations commerciales.

🧠 **Contexte technique**
Ce formulaire complexe gère de nombreux champs commerciaux avec des validations métier spécifiques. Il utilise une approche multi-sections pour améliorer l'UX, Zod pour la validation côté client, et une logique de détection de doublons en temps réel pour éviter les duplicatas.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et schémas de validation

🔄 **Comportement attendu / Logique métier**
- Sections organisées : Contact, Qualification, Événement, Notes
- Validation Zod en temps réel avec messages d'erreur contextuels
- Détection de doublons automatique sur email et téléphone+nom
- Sauvegarde automatique en brouillon toutes les 30 secondes
- Sélection multiple pour tags et services d'intérêt
- Calcul automatique du score basé sur la complétude
- Gestion du consentement RGPD obligatoire

⚙️ **Interactions avec d'autres modules**
- Utilise : RPC de création/modification avec détection doublons
- Intègre : avec référentiels (statuts, sources, tags, services)
- Valide : données avec règles métier commerciales
- Sauvegarde : avec permissions appropriées selon le rôle

💡 **Tips Windsurf**
- Utiliser React Hook Form avec Zod pour validation robuste
- Implémenter un système de sauvegarde automatique avec feedback visuel
- Créer des composants de champ réutilisables pour les données commerciales
- Gérer les états de chargement et d'erreur avec UX optimisée

---

### 10 - Page de détail et fiche complète du lead

🎯 **But clair**
Créer la page de détail complète d'un lead avec toutes ses informations, historique des interactions, tâches associées, et actions contextuelles, organisée en onglets pour une navigation intuitive.

🧠 **Contexte technique**
Cette page complexe agrège toutes les données liées à un lead commercial. Elle utilise des onglets pour organiser l'information, un lazy loading pour les données volumineuses, et des composants optimisés pour gérer les relations complexes entre entités commerciales.

🛠️ **Type de fichier concerné**
`.tsx` - Composants React

🔄 **Comportement attendu / Logique métier**
- Vue d'ensemble avec informations principales et score
- Onglets : Détails, Interactions, Tâches, Devis, Historique
- Timeline des interactions avec filtres par type
- Liste des tâches avec statuts et échéances
- Actions contextuelles : Éditer, Convertir, Assigner, Dupliquer
- Indicateurs visuels : score, urgence, dernière activité
- Historique complet des modifications avec détails

⚙️ **Interactions avec d'autres modules**
- Consomme : RPC de récupération détaillée du lead
- Affiche : données depuis Module Devis (devis associés)
- Intègre : avec système de permissions pour actions
- Navigue : vers Module Clients/Événements pour conversion

💡 **Tips Windsurf**
- Utiliser des onglets avec lazy loading pour optimiser les performances
- Implémenter une timeline interactive pour les interactions
- Créer des composants modulaires pour chaque section d'information
- Optimiser les requêtes avec des jointures efficaces et mise en cache

---

### 11 - Gestion des interactions et suivi commercial

🎯 **But clair**
Créer l'interface de gestion des interactions commerciales avec création rapide, historique détaillé, filtres par type et intégration avec les tâches pour un suivi commercial optimal.

🧠 **Contexte technique**
Cette interface gère la complexité du suivi commercial avec ses multiples types d'interactions. Elle utilise des formulaires modaux pour la saisie rapide, une timeline pour l'affichage chronologique, et des intégrations avec le système de tâches pour le suivi des actions.

🛠️ **Type de fichier concerné**
`.tsx` - Composants React

🔄 **Comportement attendu / Logique métier**
- Formulaire rapide d'ajout d'interaction avec types prédéfinis
- Timeline chronologique avec filtres par type et période
- Édition en ligne des interactions existantes
- Liaison automatique avec tâches créées depuis les interactions
- Calcul automatique de la durée pour les appels et réunions
- Notifications automatiques des interactions importantes
- Export des interactions pour reporting

⚙️ **Interactions avec d'autres modules**
- Utilise : RPC de gestion des interactions
- Intègre : avec système de tâches pour suivi
- Déclenche : notifications via système global
- Met à jour : automatiquement last_activity_date du lead

💡 **Tips Windsurf**
- Utiliser des modales pour la saisie rapide d'interactions
- Implémenter une timeline avec scroll virtuel pour les performances
- Créer des templates d'interaction pour accélérer la saisie
- Intégrer des raccourcis clavier pour l'efficacité commerciale

---

### 12 - Système de tâches et suivi des actions

🎯 **But clair**
Créer l'interface de gestion des tâches commerciales avec création, assignation, suivi des échéances, notifications et intégration avec le calendrier pour optimiser l'organisation commerciale.

🧠 **Contexte technique**
Cette interface gère les tâches commerciales avec leurs priorités, échéances et assignations. Elle intègre avec le système de notifications pour les rappels, fournit des vues par échéance et par assigné, et permet la création de tâches depuis les interactions.

🛠️ **Type de fichier concerné**
`.tsx` - Composants React

🔄 **Comportement attendu / Logique métier**
- Liste des tâches avec filtres par statut, priorité, échéance, assigné
- Création rapide de tâches avec assignation et échéance
- Vue calendrier des tâches avec drag & drop pour reprogrammation
- Notifications automatiques des échéances approchantes
- Marquage rapide comme terminé avec commentaires
- Statistiques des tâches par utilisateur et par période
- Création de tâches récurrentes pour le suivi régulier

⚙️ **Interactions avec d'autres modules**
- Utilise : RPC de gestion des tâches commerciales
- Intègre : avec système de notifications pour rappels
- Synchronise : avec calendrier personnel des utilisateurs
- Lie : aux interactions pour traçabilité complète

💡 **Tips Windsurf**
- Utiliser une bibliothèque de calendrier pour la vue temporelle
- Implémenter des notifications push pour les échéances critiques
- Créer des templates de tâches pour les processus récurrents
- Optimiser les requêtes de tâches avec index sur les dates

---

## 🔧 Section 3 : Fonctionnalités Secondaires

### 13 - Système de scoring et qualification automatique

🎯 **But clair**
Implémenter un système de scoring des leads basé sur des critères configurables (complétude, budget, interactions, timing) avec calcul automatique et interface de configuration pour optimiser la qualification commerciale.

🧠 **Contexte technique**
Ce système évalue automatiquement la qualité des leads selon des critères métier. Il utilise des algorithmes de scoring configurables, se met à jour en temps réel lors des modifications, et fournit des insights pour prioriser les actions commerciales.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et services de scoring

🔄 **Comportement attendu / Logique métier**
- Configuration flexible des critères de scoring et pondérations
- Calcul automatique du score lors des modifications de lead
- Visualisation du score avec détail des composants
- Seuils configurables pour qualification automatique
- Historique de l'évolution du score dans le temps
- Rapports de distribution des scores pour analyse
- Suggestions d'actions pour améliorer le score

⚙️ **Interactions avec d'autres modules**
- Utilise : données de toutes les interactions et modifications
- Intègre : avec Console IA pour scoring avancé
- Alimente : Dashboard avec métriques de qualité
- Influence : priorités d'affichage dans les listes

💡 **Tips Windsurf**
- Créer des algorithmes de scoring modulaires et configurables
- Implémenter la mise à jour en temps réel avec optimisation
- Utiliser des graphiques pour visualiser l'évolution des scores
- Permettre l'ajustement des algorithmes selon les retours terrain

---

### 14 - Gestion des doublons et fusion de leads

🎯 **But clair**
Créer un système de détection et de gestion des doublons avec interface de comparaison, fusion assistée et règles de déduplication pour maintenir la qualité de la base de données commerciale.

🧠 **Contexte technique**
Ce système identifie les doublons potentiels selon plusieurs critères (email, téléphone+nom, adresse). Il fournit une interface de comparaison visuelle, assiste la fusion des données et maintient l'historique pour traçabilité.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et services de déduplication

🔄 **Comportement attendu / Logique métier**
- Détection automatique de doublons avec scoring de similarité
- Interface de comparaison côte-à-côte des leads similaires
- Assistant de fusion avec sélection des meilleures données
- Règles configurables de déduplication automatique
- Historique des fusions pour traçabilité et audit
- Notifications des doublons détectés aux responsables
- Rapports de qualité des données avec métriques de doublons

⚙️ **Interactions avec d'autres modules**
- Utilise : algorithmes de détection lors de la création/modification
- Intègre : avec système d'audit pour traçabilité des fusions
- Notifie : via système de notifications les doublons critiques
- Maintient : cohérence avec interactions et tâches liées

💡 **Tips Windsurf**
- Utiliser des algorithmes de similarité robustes (Levenshtein, etc.)
- Implémenter une interface de comparaison intuitive et visuelle
- Créer des règles de fusion intelligentes avec validation
- Maintenir l'intégrité référentielle lors des fusions

---

### 15 - Système d'import/export et migration de données

🎯 **But clair**
Implémenter un système d'import/export pour les leads avec validation des données, mapping des champs, gestion des erreurs et rapports détaillés pour faciliter les migrations et la maintenance.

🧠 **Contexte technique**
Ce système facilite l'intégration avec des sources externes et la maintenance en masse. Il utilise des workers pour traiter de gros volumes, valide les données selon les schémas commerciaux, et fournit des rapports détaillés des opérations.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et services d'import/export

🔄 **Comportement attendu / Logique métier**
- Import CSV/Excel avec mapping automatique et manuel des colonnes
- Validation des données avec rapport d'erreurs détaillé
- Prévisualisation avant import définitif avec statistiques
- Export avec filtres avancés et sélection de champs
- Gestion des doublons lors de l'import avec options de traitement
- Traitement en arrière-plan pour gros volumes avec progression
- Templates d'import/export pour sources récurrentes

⚙️ **Interactions avec d'autres modules**
- Utilise : schémas de validation Zod pour cohérence
- Intègre : avec système de détection de doublons
- Valide : cohérence avec référentiels existants
- Notifie : progression et résultats via notifications

💡 **Tips Windsurf**
- Utiliser des Web Workers pour le traitement des gros fichiers
- Implémenter une validation robuste avec messages d'erreur clairs
- Créer des templates d'import standardisés pour sources communes
- Gérer les opérations asynchrones avec feedback temps réel

---

### 16 - Analytics et rapports commerciaux

🎯 **But clair**
Créer un système d'analytics et de rapports pour analyser les performances commerciales, les tendances de conversion, l'efficacité des sources et les métriques d'équipe avec visualisations interactives.

🧠 **Contexte technique**
Ce système fournit des insights commerciaux sur les performances des leads. Il utilise des requêtes optimisées pour calculer les métriques, des graphiques interactifs pour la visualisation, et des rapports automatisés pour le suivi régulier.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants et services d'analytics

🔄 **Comportement attendu / Logique métier**
- Métriques de performance : taux de conversion, cycle de vente, valeur moyenne
- Analyses par source, assigné, période avec comparaisons
- Tendances et prévisions basées sur l'historique
- Rapports de qualité des données et de l'activité commerciale
- Tableaux de bord personnalisables par rôle et équipe
- Export des rapports en PDF/Excel avec planification
- Alertes sur métriques critiques et objectifs

⚙️ **Interactions avec d'autres modules**
- Consomme : données de tous les modules pour analyses croisées
- Intègre : avec Dashboard pour métriques globales
- Utilise : système de notifications pour alertes
- Fournit : données pour optimisation des processus

💡 **Tips Windsurf**
- Utiliser des requêtes optimisées avec agrégations pour les calculs
- Implémenter des graphiques interactifs avec drill-down
- Créer des rapports automatisés configurables par équipe
- Optimiser les performances avec mise en cache des métriques

---

## 🚀 Section 4 : Évolutions Futures

### 17 - Intelligence artificielle pour scoring et recommandations

🎯 **But clair**
Développer l'intégration avec l'IA pour le scoring automatique avancé, les recommandations d'actions commerciales et la prédiction de conversion basée sur l'analyse des patterns historiques.

🧠 **Contexte technique**
Cette évolution utilise des modèles de machine learning pour analyser les patterns de conversion et recommander des actions optimales. Elle s'intègre avec le module Console IA Automatisation pour accéder aux capacités d'apprentissage automatique.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants IA et services de recommandation

🔄 **Comportement attendu / Logique métier**
- Scoring IA basé sur l'analyse de patterns de conversion historiques
- Recommandations d'actions personnalisées par lead et contexte
- Prédiction de probabilité de conversion avec intervalles de confiance
- Identification automatique des leads à fort potentiel
- Suggestions de timing optimal pour les interactions
- Analyse prédictive des tendances de marché
- Apprentissage continu basé sur les résultats réels

⚙️ **Interactions avec d'autres modules**
- Utilise : Console IA Automatisation pour modèles ML
- Analyse : données historiques de tous les modules
- Intègre : avec système de notifications pour alertes IA
- Améliore : processus de qualification et de suivi

💡 **Tips Windsurf**
- Utiliser des modèles de ML éprouvés pour la prédiction commerciale
- Implémenter l'apprentissage par renforcement avec feedback
- Créer des interfaces de recommandation intuitives et actionnables
- Mesurer et optimiser la précision des prédictions

---

### 18 - Intégration CRM et outils commerciaux externes

🎯 **But clair**
Développer les intégrations avec les CRM externes (Salesforce, HubSpot, Pipedrive) et outils commerciaux pour la synchronisation bidirectionnelle des données et l'unification des processus.

🧠 **Contexte technique**
Cette fonctionnalité permet l'intégration avec l'écosystème commercial existant des clients. Elle utilise des APIs REST et webhooks pour la synchronisation, gère les conflits de données et maintient la cohérence entre systèmes.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants d'intégration et services API

🔄 **Comportement attendu / Logique métier**
- Connecteurs pour CRM majeurs avec authentification OAuth
- Synchronisation bidirectionnelle des leads et interactions
- Mapping flexible des champs entre systèmes
- Gestion des conflits avec règles de priorité configurables
- Historique des synchronisations avec logs détaillés
- Webhooks pour synchronisation temps réel
- Interface de configuration des intégrations par utilisateur

⚙️ **Interactions avec d'autres modules**
- Étend : système d'import/export pour sources externes
- Utilise : système d'audit pour traçabilité des syncs
- Intègre : avec Console IA pour enrichissement automatique
- Maintient : cohérence avec tous les modules internes

💡 **Tips Windsurf**
- Utiliser des patterns d'intégration robustes avec retry et circuit breaker
- Implémenter une gestion d'erreur complète pour les APIs externes
- Créer des interfaces de mapping intuitives pour les utilisateurs
- Prévoir la scalabilité pour de gros volumes de synchronisation

---

### 19 - Automatisation avancée des workflows commerciaux

🎯 **But clair**
Implémenter des workflows commerciaux automatisés avec déclencheurs intelligents, actions conditionnelles et intégration avec le module Console IA Automatisation pour optimiser l'efficacité commerciale.

🧠 **Contexte technique**
Cette fonctionnalité crée des workflows automatisés pour les processus commerciaux répétitifs. Elle utilise le moteur d'automatisation de la Console IA, définit des règles métier complexes et exécute des actions automatiques selon les contextes.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants de workflow et services d'automatisation

🔄 **Comportement attendu / Logique métier**
- Éditeur visuel de workflows avec conditions et actions
- Déclencheurs basés sur événements (nouveau lead, changement statut, échéance)
- Actions automatiques : assignation, création tâches, envoi emails, notifications
- Conditions complexes basées sur score, source, timing, comportement
- Templates de workflows pour processus commerciaux standards
- Monitoring et analytics des workflows avec optimisation
- Intégration avec outils externes pour actions étendues

⚙️ **Interactions avec d'autres modules**
- Utilise : Console IA Automatisation pour moteur de workflow
- Déclenche : actions dans tous les modules de l'ERP
- Intègre : avec système de notifications pour alertes
- Optimise : processus commerciaux avec apprentissage

💡 **Tips Windsurf**
- Utiliser un éditeur de workflow visuel et intuitif
- Implémenter des conditions complexes avec validation
- Créer des templates de workflow pour cas d'usage courants
- Monitorer les performances et l'efficacité des automatisations

---

### 20 - Intégration marketing et campagnes multi-canal

🎯 **But clair**
Développer l'intégration avec les outils marketing pour le suivi des campagnes, l'attribution des sources, le nurturing automatisé et l'analyse ROI des actions marketing sur les leads.

🧠 **Contexte technique**
Cette fonctionnalité connecte le commercial avec le marketing pour une vision unifiée. Elle trace l'origine des leads, mesure l'efficacité des campagnes, automatise le nurturing et optimise l'allocation des budgets marketing.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants marketing et services d'attribution

🔄 **Comportement attendu / Logique métier**
- Tracking des sources marketing avec attribution multi-touch
- Intégration avec plateformes publicitaires (Google Ads, Facebook, LinkedIn)
- Campagnes de nurturing automatisées basées sur le comportement
- Scoring d'engagement marketing et commercial combiné
- Analytics ROI par canal et campagne avec attribution
- Segmentation avancée pour campagnes personnalisées
- A/B testing des messages et approches commerciales

⚙️ **Interactions avec d'autres modules**
- Intègre : avec Module Marketing (si existant)
- Utilise : Console IA pour personnalisation des messages
- Alimente : Dashboard avec métriques marketing-commercial
- Optimise : allocation budgétaire basée sur performance

💡 **Tips Windsurf**
- Utiliser des pixels de tracking et UTM pour attribution précise
- Implémenter des modèles d'attribution multi-touch
- Créer des campagnes de nurturing basées sur les scores et comportements
- Mesurer et optimiser le ROI avec analytics avancés

---

### 21 - Réalité augmentée pour présentations commerciales

🎯 **But clair**
Explorer l'utilisation de la réalité augmentée pour créer des présentations commerciales immersives, visualiser les événements dans les lieux et améliorer l'expérience de vente avec des démonstrations innovantes.

🧠 **Contexte technique**
Cette fonctionnalité révolutionnaire utilise la AR pour créer des expériences de vente immersives. Elle intègre avec les données de lieux, permet la visualisation d'événements et crée des présentations interactives pour impressionner les prospects.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants AR et services de visualisation

🔄 **Comportement attendu / Logique métier**
- Visualisation AR des lieux avec superposition d'informations
- Simulation d'événements dans les espaces avec décoration virtuelle
- Présentations commerciales interactives avec éléments 3D
- Catalogue de services en réalité augmentée
- Partage d'expériences AR avec prospects à distance
- Mesure de l'engagement et impact sur conversion
- Personnalisation des expériences selon les préférences clients

⚙️ **Interactions avec d'autres modules**
- Utilise : données Module Lieux pour visualisations
- Intègre : avec Module Événements pour simulations
- Étend : présentations commerciales traditionnelles
- Mesure : impact sur taux de conversion

💡 **Tips Windsurf**
- Utiliser des frameworks AR web standards (WebXR)
- Créer des expériences progressives (2D → 3D → AR)
- Optimiser pour différents appareils et capacités
- Mesurer l'impact sur l'engagement et les conversions

---

### 22 - Blockchain pour traçabilité et contrats intelligents

🎯 **But clair**
Explorer l'utilisation de la blockchain pour assurer la traçabilité immuable des interactions commerciales, créer des contrats intelligents pour les accords et garantir la transparence des processus de vente.

🧠 **Contexte technique**
Cette fonctionnalité expérimentale utilise la blockchain pour créer une traçabilité immuable des processus commerciaux. Elle permet la création de contrats intelligents, assure la transparence et crée de nouveaux modèles de confiance avec les clients.

🛠️ **Type de fichier concerné**
`.tsx`, `.ts` - Composants blockchain et smart contracts

🔄 **Comportement attendu / Logique métier**
- Enregistrement immuable des interactions commerciales critiques
- Contrats intelligents pour accords commerciaux automatisés
- Traçabilité complète du cycle de vente avec horodatage cryptographique
- Tokens de réputation basés sur les performances commerciales
- Escrow automatisé pour les acomptes et paiements
- Audit trail inviolable pour conformité réglementaire
- Marketplace décentralisée pour services wedding

⚙️ **Interactions avec d'autres modules**
- Complète : système d'audit traditionnel avec immutabilité
- Intègre : avec Module Contrats pour automatisation
- Étend : vers écosystème décentralisé de confiance
- Assure : transparence et conformité réglementaire

💡 **Tips Windsurf**
- Commencer par des preuves de concept simples et mesurables
- Utiliser des solutions blockchain éprouvées et scalables
- Maintenir la compatibilité avec systèmes existants
- Évaluer régulièrement les coûts et bénéfices réels

---

## 📊 Matrice de Priorités et Dépendances

| Prompt | Priorité | Dépendances | Durée Estimée | Complexité |
|--------|----------|-------------|---------------|------------|
| 01-06  | P0       | Console Admin, Monorepo | 5-6 jours     | Élevée     |
| 07-12  | P1       | 01-06       | 7-9 jours     | Élevée     |
| 13-16  | P1       | 07-12       | 5-6 jours     | Moyenne    |
| 17-22  | P2-P3    | 13-16, Console IA | 4-6 semaines  | Très élevée |

---

## 🔄 Ordre d'Exécution Recommandé

### **Phase 1 - Infrastructure Commerciale (Semaines 1-2)**
Prompts 01-06 : Tables, RLS, RPC, Triggers

### **Phase 2 - Interfaces Principales (Semaines 3-4)**
Prompts 07-12 : Liste, Kanban, formulaires, détails, interactions, tâches

### **Phase 3 - Fonctionnalités Avancées (Semaines 5-6)**
Prompts 13-16 : Scoring, doublons, import/export, analytics

### **Phase 4 - Évolutions Futures (Versions ultérieures)**
Prompts 17-22 : IA, CRM, workflows, marketing, AR, blockchain

---

## ⚠️ Points d'Attention Critiques

### **Complexité Commerciale**
- Gestion des cycles de vente complexes avec multiples intervenants
- Détection et fusion de doublons avec préservation de l'historique
- Scoring automatique avec critères métier évolutifs
- Conversion transactionnelle vers clients/événements

### **Performance et Volumétrie**
- Optimisation des requêtes de recherche et filtrage sur gros volumes
- Gestion efficace des interactions et tâches nombreuses
- Cache intelligent pour les métriques et analytics
- Index optimisés pour les patterns de requête commerciaux

### **Sécurité et Confidentialité**
- Protection des données prospects sensibles avec RLS granulaire
- Respect du RGPD avec consentement et droit à l'oubli
- Audit complet des accès et modifications
- Sécurisation des intégrations avec systèmes externes

### **Intégration Inter-Modules**
- Synchronisation avec Module Clients pour conversions
- Coordination avec Module Événements pour qualification
- Intégration avec Console IA pour automatisation
- Cohérence avec Dashboard pour métriques globales

---

*Document généré par Manus AI - Expert en transformation de cahiers des charges pour Windsurf*

