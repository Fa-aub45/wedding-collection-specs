# Prompts Windsurf - Module Événement du Backoffice

**Version**: 1.0  
**Date**: 2025-06-03  
**Auteur**: Expert Windsurf - Agent IA  
**Module**: Événement (Refonte) - Backoffice ERP Wedding Collection

---

## 📋 Vue d'Ensemble du Module

Le module Événement constitue le **cœur opérationnel** de l'ERP Wedding Collection. Il gère l'ensemble du cycle de vie des événements depuis la création jusqu'à la réalisation, avec planification détaillée, gestion des équipes, coordination des prestataires, timeline interactive, gestion documentaire et intégrations complètes avec l'écosystème.

### 🎯 Objectifs Stratégiques
- **Centraliser** la gestion complète des événements de mariage
- **Optimiser** la coordination entre équipes, clients et prestataires  
- **Automatiser** les workflows de planification et de suivi
- **Intégrer** parfaitement avec les modules Clients, Lieux, Prestataires
- **Fournir** une expérience utilisateur fluide pour la gestion d'événements complexes

### 🏗️ Architecture Technique
- **Schéma shared** : 8 nouvelles tables interconnectées pour gestion événement
- **Intégrations** : Modules Clients, Lieux, Prestataires, Console Admin
- **Stack** : Next.js 14+, Supabase, Tailwind CSS, ShadCN UI, TanStack Query
- **Sécurité** : RLS granulaire, permissions par rôle et équipe événement

---

## 🔧 Section 1 : Initialisation

### 01 - Création du schéma de base de données événement

🎯 **But :** Créer l'architecture complète de base de données pour le module Événement avec 8 tables interconnectées, types énumérés et contraintes métier.

🧠 **Contexte technique :** Le module Événement nécessite une architecture de données complexe pour gérer le cycle de vie complet des événements. Les tables sont organisées autour de l'entité centrale `events` avec des relations vers les équipes, planning, espaces, jalons, communications, prestataires et documents. L'architecture doit supporter la collaboration multi-utilisateurs et l'intégration avec les autres modules.

🛠️ **Type de fichier :** `.sql` (Migration Supabase)

🔄 **Comportement attendu :**
Créer une migration Supabase avec :

**Table events (enrichie) :**
- `id` (uuid, PK), `organization_id` (uuid, FK), `client_id` (uuid, FK), `venue_id` (uuid, FK nullable)
- `name` (text), `status` (text), `start_date` (timestamptz), `end_date` (timestamptz)
- `metadata` (jsonb) pour informations flexibles (type événement, nombre invités, objectifs)
- `created_at`, `updated_at` (timestamptz)

**Table event_team_members :**
- `id` (uuid, PK), `event_id` (uuid, FK), `profile_id` (uuid, FK), `role` (text)
- Contrainte UNIQUE(event_id, profile_id, role)

**Table event_timelines :**
- `id` (uuid, PK), `event_id` (uuid, FK), `task_name` (text), `description` (text)
- `start_time`, `end_time` (timestamptz), `status` (text), `assigned_profile_id` (uuid, FK nullable)

**Table event_spaces :**
- `id` (uuid, PK), `event_id` (uuid, FK), `venue_space_id` (uuid, FK)
- `configuration_details` (text), `start_usage`, `end_usage` (timestamptz)

**Table event_checkpoints :**
- `id` (uuid, PK), `event_id` (uuid, FK), `name` (text), `description` (text)
- `due_date` (timestamptz), `status` (text), `responsible_profile_id` (uuid, FK nullable)
- `completed_at` (timestamptz nullable)

**Table event_communications :**
- `id` (uuid, PK), `event_id` (uuid, FK), `sender_profile_id` (uuid, FK)
- `channel` (text), `subject` (text), `body` (text), `recipients` (jsonb)
- `sent_at` (timestamptz)

**Table event_vendors :**
- `id` (uuid, PK), `event_id` (uuid, FK), `vendor_id` (uuid, FK)
- `service_provided` (text), `status` (text), `agreed_price` (decimal)
- `evaluation_notes` (text), `evaluation_rating` (integer)

**Table event_documents :**
- `id` (uuid, PK), `event_id` (uuid, FK), `document_name` (text)
- `document_type` (text), `storage_path` (text), `version` (integer)
- `status` (text), `uploaded_by_profile_id` (uuid, FK)

⚙️ **Interactions :** 
- Référence aux tables existantes : clients, venues, venue_spaces, vendors, profiles
- Intégration avec Console Admin pour organization_id et profiles
- Préparation pour Module Contrats et Comptabilité

💡 **Tips Windsurf :** Utilise des UUID v4 par défaut. Ajoute des contraintes CHECK pour valider les statuts. Prévois l'extensibilité avec des champs JSONB.

---

### 02 - Création des types énumérés et contraintes métier

🎯 **But :** Définir tous les types énumérés et contraintes métier spécifiques au module Événement pour garantir la cohérence des données.

🧠 **Contexte technique :** Le module Événement utilise de nombreux statuts et types qui doivent être standardisés. Les types énumérés PostgreSQL garantissent l'intégrité des données et facilitent les requêtes. Les contraintes métier assurent la cohérence logique (dates, relations).

🛠️ **Type de fichier :** `.sql` (Migration Supabase)

🔄 **Comportement attendu :**
Créer les types énumérés :

**event_status_enum :**
- `draft`, `quoted`, `confirmed`, `planning`, `in_progress`, `completed`, `archived`, `cancelled`

**event_timeline_status_enum :**
- `todo`, `in_progress`, `completed`, `blocked`, `cancelled`

**event_checkpoint_status_enum :**
- `pending`, `in_progress`, `completed`, `overdue`, `cancelled`

**event_team_role_enum :**
- `coordinator`, `sales_contact`, `technical_lead`, `assistant`, `specialist`

**event_communication_channel_enum :**
- `email`, `portal_message`, `internal_note`, `phone_call`, `meeting`

**event_vendor_status_enum :**
- `pending`, `contacted`, `quoted`, `confirmed`, `rejected`, `completed`, `evaluated`

**event_document_type_enum :**
- `contract`, `plan`, `invoice`, `brief`, `photo`, `video`, `other`

**event_document_status_enum :**
- `draft`, `review`, `validated`, `signed`, `archived`

**Contraintes métier :**
- `events` : start_date < end_date, status transitions valides
- `event_timelines` : start_time < end_time si les deux sont définis
- `event_spaces` : start_usage < end_usage
- `event_checkpoints` : due_date cohérente avec event dates
- `event_vendors` : evaluation_rating entre 1 et 5 si défini

⚙️ **Interactions :** 
- Cohérence avec les types des autres modules (clients, lieux, prestataires)
- Préparation pour les validations frontend et API

💡 **Tips Windsurf :** Utilise CREATE TYPE pour les énums PostgreSQL. Ajoute des contraintes CHECK avec des messages d'erreur explicites. Prévois l'évolution des énums.

---

### 03 - Création des index et optimisations de performance

🎯 **But :** Créer tous les index nécessaires pour optimiser les performances des requêtes fréquentes du module Événement.

🧠 **Contexte technique :** Le module Événement génère de nombreuses requêtes complexes avec jointures multiples, filtres par dates, statuts et assignations. Les index sont cruciaux pour maintenir des performances acceptables avec des volumes de données importants. L'optimisation doit couvrir les cas d'usage principaux : listes filtrées, recherches, agrégations.

🛠️ **Type de fichier :** `.sql` (Migration Supabase)

🔄 **Comportement attendu :**
Créer les index optimisés :

**Index sur events :**
- `idx_events_organization_status` : (organization_id, status) pour filtres principaux
- `idx_events_client_dates` : (client_id, start_date) pour événements client
- `idx_events_venue_dates` : (venue_id, start_date, end_date) pour disponibilité lieu
- `idx_events_dates_status` : (start_date, end_date, status) pour calendrier global
- `idx_events_search` : GIN sur (name, metadata) pour recherche textuelle

**Index sur event_team_members :**
- `idx_event_team_event_profile` : (event_id, profile_id) pour vérifications équipe
- `idx_event_team_profile_role` : (profile_id, role) pour événements par utilisateur

**Index sur event_timelines :**
- `idx_event_timelines_event_status` : (event_id, status) pour planning événement
- `idx_event_timelines_assigned_dates` : (assigned_profile_id, start_time, end_time)
- `idx_event_timelines_dates` : (start_time, end_time) pour vue calendrier

**Index sur event_checkpoints :**
- `idx_event_checkpoints_event_due` : (event_id, due_date, status)
- `idx_event_checkpoints_responsible` : (responsible_profile_id, due_date)

**Index sur event_communications :**
- `idx_event_communications_event_sent` : (event_id, sent_at DESC)
- `idx_event_communications_sender` : (sender_profile_id, sent_at DESC)

**Index sur event_vendors :**
- `idx_event_vendors_event_status` : (event_id, status)
- `idx_event_vendors_vendor` : (vendor_id, status)

**Index sur event_documents :**
- `idx_event_documents_event_type` : (event_id, document_type, status)
- `idx_event_documents_uploaded` : (uploaded_by_profile_id, created_at DESC)

⚙️ **Interactions :** 
- Optimisation pour les requêtes cross-modules (clients, lieux, prestataires)
- Support des filtres Dashboard et analytics

💡 **Tips Windsurf :** Utilise des index composites dans l'ordre de sélectivité. Ajoute des index partiels pour les statuts actifs. Surveille la taille des index.

---

### 04 - Configuration des politiques RLS (Row Level Security)

🎯 **But :** Implémenter les politiques de sécurité au niveau des lignes pour contrôler l'accès aux données événement selon les rôles et l'appartenance aux équipes.

🧠 **Contexte technique :** La sécurité du module Événement est complexe car elle combine l'isolation multi-tenant (organization_id), les permissions par rôle (Console Admin) et l'appartenance aux équipes événement. Les politiques RLS doivent être granulaires tout en restant performantes. Chaque table nécessite des politiques spécifiques selon sa sensibilité.

🛠️ **Type de fichier :** `.sql` (Migration Supabase)

🔄 **Comportement attendu :**
Créer les politiques RLS pour chaque table :

**Politiques events :**
- `events_select_policy` : Lecture pour membres organisation + équipe événement
- `events_insert_policy` : Création pour rôles autorisés (admin_erp, wedding_planner, commercial)
- `events_update_policy` : Modification pour coordinateurs événement + admins
- `events_delete_policy` : Suppression pour admins uniquement

**Politiques event_team_members :**
- `team_select_policy` : Lecture pour équipe événement + admins organisation
- `team_insert_policy` : Ajout pour coordinateurs + admins
- `team_delete_policy` : Suppression pour coordinateurs + admins

**Politiques event_timelines :**
- `timeline_select_policy` : Lecture pour équipe événement
- `timeline_insert_policy` : Création pour coordinateurs
- `timeline_update_policy` : Modification pour coordinateurs + assigné (statut uniquement)
- `timeline_delete_policy` : Suppression pour coordinateurs

**Politiques event_spaces :**
- `spaces_select_policy` : Lecture pour équipe événement
- `spaces_insert_update_delete_policy` : Modification pour coordinateurs

**Politiques event_checkpoints :**
- `checkpoints_select_policy` : Lecture pour équipe événement
- `checkpoints_insert_update_policy` : Modification pour coordinateurs + responsable
- `checkpoints_delete_policy` : Suppression pour coordinateurs

**Politiques event_communications :**
- `communications_select_policy` : Lecture pour équipe événement selon channel
- `communications_insert_policy` : Création pour équipe événement

**Politiques event_vendors :**
- `vendors_select_policy` : Lecture pour équipe événement
- `vendors_insert_update_policy` : Modification pour coordinateurs

**Politiques event_documents :**
- `documents_select_policy` : Lecture pour équipe événement selon sensibilité
- `documents_insert_policy` : Upload pour équipe événement
- `documents_update_delete_policy` : Modification pour coordinateurs + uploader

Utiliser des fonctions helper :
- `is_event_team_member(event_id, user_id)` : Vérification appartenance équipe
- `has_event_role(event_id, user_id, role)` : Vérification rôle spécifique
- `get_user_organization()` : Récupération organisation utilisateur

⚙️ **Interactions :** 
- Intégration avec Console Admin pour vérification des rôles globaux
- Coordination avec politiques des modules Clients, Lieux, Prestataires

💡 **Tips Windsurf :** Optimise les fonctions RLS pour éviter les N+1 queries. Utilise des vues matérialisées pour les vérifications complexes. Teste les performances avec des volumes réalistes.

---

### 05 - Création des fonctions RPC backend

🎯 **But :** Développer les fonctions RPC PostgreSQL pour les opérations métier complexes du module Événement nécessitant des transactions et de la logique serveur.

🧠 **Contexte technique :** Certaines opérations événement nécessitent des transactions complexes, des validations métier avancées ou des calculs côté serveur. Les fonctions RPC PostgreSQL garantissent l'atomicité, la performance et la sécurité. Elles exposent une API haut niveau pour le frontend.

🛠️ **Type de fichier :** `.sql` (Migration Supabase)

🔄 **Comportement attendu :**
Créer les fonctions RPC principales :

**rpc_create_event_from_lead(lead_id, event_data) :**
- Convertit un lead en événement avec transfert des données
- Crée l'événement, assigne l'équipe initiale, génère le planning de base
- Met à jour le statut du lead, crée les liens de traçabilité
- Retourne l'événement créé avec détails complets

**rpc_change_event_status(event_id, new_status, notes) :**
- Change le statut d'un événement avec validations des transitions
- Déclenche les actions automatiques selon le nouveau statut
- Enregistre l'audit trail, notifie les équipes concernées
- Retourne le statut mis à jour avec historique

**rpc_assign_event_team(event_id, team_assignments) :**
- Assigne une équipe complète à un événement en une transaction
- Valide les rôles, vérifie les disponibilités, gère les conflits
- Notifie les nouveaux membres, met à jour les permissions
- Retourne l'équipe assignée avec détails des profils

**rpc_update_event_timeline(event_id, timeline_updates) :**
- Met à jour le planning complet d'un événement
- Valide les cohérences temporelles, détecte les conflits
- Recalcule les dépendances, met à jour les notifications
- Retourne le planning mis à jour avec alertes

**rpc_complete_event_checkpoint(checkpoint_id, completion_data) :**
- Marque un jalon comme complété avec données de validation
- Met à jour les dépendances, déclenche les étapes suivantes
- Enregistre les preuves de completion, notifie les parties prenantes
- Retourne le jalon complété avec impact sur le planning

**rpc_get_event_dashboard_summary(event_id) :**
- Agrège toutes les informations clés d'un événement
- Calcule les métriques de progression, identifie les alertes
- Optimise les jointures pour performance maximale
- Retourne un résumé complet pour affichage dashboard

**rpc_generate_event_brief(event_id, vendor_id, brief_type) :**
- Génère un brief personnalisé pour un prestataire
- Compile les informations pertinentes selon le type de service
- Crée le document, l'enregistre dans event_documents
- Retourne les détails du brief généré

**rpc_archive_completed_event(event_id, archive_options) :**
- Archive un événement terminé avec options de conservation
- Sauvegarde les données importantes, nettoie les temporaires
- Met à jour les statuts, notifie les parties prenantes
- Retourne le résumé d'archivage

Chaque fonction inclut :
- Vérification des permissions avec RLS
- Validation des paramètres d'entrée
- Gestion des erreurs avec messages explicites
- Logging des actions pour audit
- Optimisation des performances

⚙️ **Interactions :** 
- Appel des fonctions des autres modules (clients, lieux, prestataires)
- Intégration avec système de notifications
- Coordination avec Console Admin pour audit

💡 **Tips Windsurf :** Utilise des transactions explicites avec ROLLBACK sur erreur. Implemente des validations robustes avec messages d'erreur clairs. Optimise avec des requêtes préparées.

---

### 06 - Configuration des triggers et automatisations

🎯 **But :** Implémenter les triggers PostgreSQL pour automatiser les actions système et maintenir la cohérence des données événement.

🧠 **Contexte technique :** Le module Événement nécessite de nombreuses automatisations pour maintenir la cohérence : mise à jour des timestamps, synchronisation des statuts, notifications automatiques, calculs dérivés. Les triggers PostgreSQL garantissent que ces actions sont exécutées de manière fiable et atomique.

🛠️ **Type de fichier :** `.sql` (Migration Supabase)

🔄 **Comportement attendu :**
Créer les triggers d'automatisation :

**Trigger update_events_updated_at :**
- Déclenché sur UPDATE de events
- Met à jour automatiquement le champ updated_at
- Maintient la traçabilité des modifications

**Trigger sync_event_status_changes :**
- Déclenché sur UPDATE de events.status
- Synchronise les statuts des sous-entités (timelines, checkpoints)
- Déclenche les notifications aux équipes concernées
- Enregistre l'historique des changements de statut

**Trigger validate_event_team_assignments :**
- Déclenché sur INSERT/UPDATE de event_team_members
- Valide l'unicité des rôles critiques (coordinator)
- Vérifie les permissions du profil assigné
- Met à jour les permissions d'accès à l'événement

**Trigger auto_update_timeline_status :**
- Déclenché sur UPDATE de event_timelines
- Met à jour automatiquement les statuts dépendants
- Recalcule les dates de fin d'événement si nécessaire
- Notifie les assignés des changements

**Trigger checkpoint_completion_cascade :**
- Déclenché sur UPDATE de event_checkpoints.status = 'completed'
- Déclenche automatiquement les checkpoints dépendants
- Met à jour la progression globale de l'événement
- Génère les notifications de milestone atteint

**Trigger event_communication_notifications :**
- Déclenché sur INSERT de event_communications
- Envoie les notifications selon le channel
- Met à jour les compteurs de messages non lus
- Synchronise avec les portails client/prestataire

**Trigger vendor_status_sync :**
- Déclenché sur UPDATE de event_vendors.status
- Synchronise avec le module Prestataires
- Met à jour les disponibilités et plannings
- Notifie les changements aux parties concernées

**Trigger document_version_management :**
- Déclenché sur INSERT de event_documents
- Gère automatiquement le versioning des documents
- Archive les versions précédentes
- Met à jour les références dans les autres tables

**Trigger event_audit_trail :**
- Déclenché sur toutes les opérations sensibles
- Enregistre les actions dans une table d'audit
- Capture l'utilisateur, l'action, les données avant/après
- Maintient la traçabilité complète pour conformité

**Trigger space_availability_check :**
- Déclenché sur INSERT/UPDATE de event_spaces
- Vérifie les conflits de réservation d'espaces
- Valide la cohérence avec les dates d'événement
- Empêche les double-réservations

Chaque trigger inclut :
- Gestion des erreurs avec RAISE EXCEPTION
- Conditions de déclenchement optimisées
- Performance optimisée pour éviter les ralentissements
- Logging approprié pour debugging

⚙️ **Interactions :** 
- Synchronisation avec les triggers des autres modules
- Intégration avec le système de notifications global
- Coordination avec les politiques RLS

💡 **Tips Windsurf :** Utilise NEW et OLD pour comparer les valeurs. Optimise les triggers pour éviter les cascades infinies. Teste les performances avec des volumes importants.

---

## 🏗️ Section 2 : Fonctionnalités Principales


### 07 - Création de la page liste des événements

🎯 **But :** Développer l'interface principale de gestion des événements avec liste paginée, recherche avancée, filtres multiples et actions en lot optimisées pour les gros volumes.

🧠 **Contexte technique :** Cette page est le point d'entrée principal du module Événement. Elle doit gérer efficacement de gros volumes d'événements avec pagination côté serveur, recherche en temps réel et filtres complexes. L'interface utilise TanStack Query pour la gestion du cache et des états de chargement, avec virtualisation pour les performances.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/pages/EventListPage.tsx` avec :

**Table responsive avancée :**
- **Colonnes principales** : Nom événement, Client, Lieu, Dates (début/fin), Statut, Équipe, Progression, Actions
- **Tri multi-colonnes** avec indicateurs visuels et mémorisation des préférences
- **Colonnes configurables** : Affichage/masquage selon les préférences utilisateur
- **Largeurs adaptatives** : Redimensionnement automatique selon le contenu
- **Mode compact/étendu** : Basculement entre vue résumée et détaillée

**Recherche et filtres avancés :**
- **Recherche globale** en temps réel avec debounce (nom événement, client, lieu)
- **Filtres par statut** : Multi-sélection avec compteurs par statut
- **Filtres par dates** : Plages personnalisées, raccourcis (cette semaine, ce mois)
- **Filtres par équipe** : Mes événements, équipe spécifique, non assignés
- **Filtres par lieu** : Sélection multiple avec auto-complétion
- **Filtres avancés** : Nombre d'invités, budget, type d'événement
- **Sauvegarde des filtres** : Vues personnalisées nommées et partagées

**Pagination et performance :**
- **Pagination côté serveur** avec sélection du nombre d'éléments (20/50/100)
- **Virtualisation** pour les grandes listes avec react-window
- **Chargement progressif** avec skeleton loading
- **Cache intelligent** avec invalidation automatique

**Actions en lot :**
- **Sélection multiple** : Cases à cocher avec sélection tout/rien
- **Actions groupées** : Changement de statut, assignation d'équipe, export
- **Confirmation** : Modales de confirmation avec aperçu des changements
- **Progression** : Barres de progression pour les actions longues

**Actions individuelles :**
- **Voir détails** : Navigation vers la page détail événement
- **Modifier** : Édition rapide ou complète selon les permissions
- **Dupliquer** : Création d'un nouvel événement basé sur l'existant
- **Archiver/Supprimer** : Actions avec confirmation et audit trail

**Indicateurs visuels :**
- **Badges de statut** : Couleurs et icônes distinctives par statut
- **Indicateurs de progression** : Barres de progression pour planning/checkpoints
- **Alertes** : Icônes pour événements en retard, conflits, problèmes
- **Priorités** : Marqueurs visuels pour événements urgents/importants

Utiliser les composants ShadCN UI (Table, Input, Select, Button, Badge, Checkbox) et intégrer avec TanStack Query pour la gestion optimisée des données.

⚙️ **Interactions :** 
- Appelle `rpc_get_events_list()` avec filtres et pagination via packages/api-client
- Navigation vers EventDetailPage et EventForm selon les permissions
- Intégration avec Dashboard pour métriques et alertes
- Synchronisation avec Console Admin pour permissions et audit

💡 **Tips Windsurf :** Utilise useDebounce pour la recherche. Implémente la virtualisation avec react-window pour les grandes listes. Sauvegarde les filtres dans l'URL et localStorage.

---

### 08 - Création du formulaire événement (création/édition)

🎯 **But :** Développer le formulaire complet de création et d'édition des événements avec validation avancée, gestion des conflits et expérience utilisateur optimisée.

🧠 **Contexte technique :** Le formulaire événement est complexe car il gère de nombreuses entités liées (client, lieu, équipe, planning). Il inclut la validation côté client avec Zod, la détection de conflits en temps réel et la gestion des dépendances entre champs. L'interface doit être intuitive malgré la complexité des données.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventForm.tsx` avec :

**Structure en onglets organisés :**
- **Onglet "Informations générales"** : Nom, description, type, dates, statut
- **Onglet "Client et lieu"** : Sélection client, lieu, espaces, configuration
- **Onglet "Équipe"** : Assignation des rôles, coordinateur, spécialistes
- **Onglet "Planning initial"** : Jalons clés, dates importantes, contraintes
- **Onglet "Budget et prestataires"** : Budget prévisionnel, prestataires pressentis
- **Onglet "Métadonnées"** : Informations spécifiques (invités, objectifs, notes)

**Validation et cohérence :**
- **Validation Zod** avec schémas conditionnels selon le type d'événement
- **Validation temps réel** avec messages d'erreur contextuels
- **Détection de conflits** : Disponibilité lieu, équipe, prestataires
- **Cohérence des dates** : Validation des plages temporelles
- **Contraintes métier** : Règles spécifiques selon le type d'événement

**Fonctionnalités avancées :**
- **Auto-complétion intelligente** : Suggestions basées sur l'historique
- **Templates d'événements** : Pré-remplissage selon des modèles prédéfinis
- **Calculs automatiques** : Budget, durée, ressources nécessaires
- **Aperçu en temps réel** : Visualisation des changements avant sauvegarde
- **Sauvegarde automatique** : Brouillons sauvegardés toutes les 30 secondes

**Gestion des dépendances :**
- **Sélection client** : Chargement des préférences et historique
- **Sélection lieu** : Vérification disponibilité et espaces compatibles
- **Assignation équipe** : Vérification disponibilité et compétences
- **Configuration espaces** : Plans interactifs et configuration visuelle

**Modes d'utilisation :**
- **Mode création** : Formulaire vierge avec assistants de configuration
- **Mode édition** : Pré-remplissage avec gestion des modifications
- **Mode duplication** : Copie avec adaptation des données spécifiques
- **Mode conversion** : Création depuis un lead avec transfert de données

Utiliser React Hook Form avec Zod pour la validation, ShadCN UI pour les composants et des hooks personnalisés pour la logique métier.

⚙️ **Interactions :** 
- Appelle `rpc_create_event()` ou `rpc_update_event()` selon le mode
- Utilise `rpc_check_event_conflicts()` pour validation des conflits
- Intégration avec Module Clients pour sélection et données client
- Intégration avec Module Lieux pour disponibilité et configuration
- Conversion depuis Module Leads via `rpc_create_event_from_lead()`

💡 **Tips Windsurf :** Utilise des schémas Zod conditionnels selon le type d'événement. Implémente l'auto-save avec debounce. Gère les états de chargement pour chaque section.

---

### 09 - Création de la page détails événement

🎯 **But :** Développer la vue détaillée complète d'un événement avec toutes les informations, planning interactif, équipe, documents et données liées en temps réel.

🧠 **Contexte technique :** Cette page centralise toutes les informations événement avec des onglets organisés et des widgets interactifs. Elle affiche les données en temps réel avec possibilité d'édition contextuelle. L'interface charge les données de manière optimisée avec des requêtes parallèles et du cache intelligent.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/pages/EventDetailPage.tsx` avec :

**Onglets principaux organisés :**
- **"Vue d'ensemble"** : Résumé exécutif, métriques clés, alertes, actions rapides
- **"Planning & Timeline"** : Timeline interactive, tâches, jalons, dépendances
- **"Équipe & Assignations"** : Membres équipe, rôles, disponibilités, communications
- **"Lieu & Espaces"** : Configuration des espaces, plans, équipements
- **"Prestataires"** : Liste des prestataires, statuts, évaluations, briefs
- **"Documents"** : Gestion documentaire complète avec versioning
- **"Communications"** : Historique des échanges internes et externes
- **"Budget & Facturation"** : Suivi financier, devis, factures (lecture seule)
- **"Historique & Audit"** : Journal des modifications avec détails

**Vue d'ensemble interactive :**
- **Widgets de synthèse** : Progression globale, prochaines échéances, alertes
- **Métriques temps réel** : Statut planning, budget, équipe, prestataires
- **Timeline condensée** : Aperçu des prochaines étapes importantes
- **Actions rapides** : Boutons contextuels selon les permissions et le statut

**Planning interactif :**
- **Timeline visuelle** : Affichage chronologique avec zoom et navigation
- **Gestion des tâches** : Création, modification, assignation en ligne
- **Jalons visuels** : Marqueurs des checkpoints avec statuts colorés
- **Vue calendrier** : Intégration avec calendrier global de l'organisation
- **Dépendances** : Visualisation des liens entre tâches et jalons

**Gestion d'équipe :**
- **Profils détaillés** : Informations, rôles, disponibilités, charge de travail
- **Communication interne** : Chat intégré, notifications, mentions
- **Assignations dynamiques** : Modification des assignations avec validation
- **Performance** : Métriques individuelles et d'équipe

**Fonctionnalités temps réel :**
- **Synchronisation live** : Mise à jour automatique des changements
- **Notifications push** : Alertes pour événements importants
- **Collaboration** : Indicateurs de présence et d'activité des utilisateurs
- **Conflits** : Détection et résolution des conflits de modification

⚙️ **Interactions :** 
- Appelle `rpc_get_event_dashboard_summary()` pour données principales
- Intégration avec Module Lieux pour configuration des espaces
- Intégration avec Module Prestataires pour gestion des services
- Synchronisation avec portails Client et Vendor pour données partagées

💡 **Tips Windsurf :** Utilise Suspense pour le chargement progressif des onglets. Implémente le lazy loading pour les données volumineuses. Cache les données fréquemment consultées.

---

### 10 - Gestion du planning et timeline interactive

🎯 **But :** Implémenter le système complet de gestion du planning événement avec timeline interactive, gestion des tâches, jalons et dépendances.

🧠 **Contexte technique :** Le planning est au cœur de la gestion événement. Il nécessite une interface intuitive pour créer, organiser et suivre les tâches avec des vues multiples (timeline, calendrier, Gantt). Le système doit gérer les dépendances, les conflits et la collaboration en temps réel.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventTimeline.tsx` avec :

**Interface timeline principale :**
- **Vue chronologique** : Affichage des tâches sur une timeline zoomable
- **Modes d'affichage** : Timeline, calendrier, liste, Gantt simplifié
- **Navigation temporelle** : Zoom (jour/semaine/mois), navigation rapide
- **Filtres visuels** : Par assigné, statut, type de tâche, priorité

**Gestion des tâches :**
- **Création rapide** : Ajout de tâches directement sur la timeline
- **Édition en ligne** : Modification des propriétés sans modal
- **Glisser-déposer** : Réorganisation des tâches et modification des dates
- **Duplication** : Copie de tâches avec adaptation automatique
- **Templates** : Modèles de tâches prédéfinis selon le type d'événement

**Jalons et checkpoints :**
- **Marqueurs visuels** : Icônes distinctives pour les jalons importants
- **Validation** : Processus d'approbation pour les jalons critiques
- **Notifications** : Alertes automatiques pour les échéances
- **Dépendances** : Liens visuels entre jalons et tâches dépendantes

**Assignations et collaboration :**
- **Assignation visuelle** : Couleurs et avatars pour identifier les responsables
- **Charge de travail** : Visualisation de la répartition des tâches
- **Disponibilités** : Vérification des conflits d'agenda
- **Notifications** : Alertes pour les assignés lors des modifications

**Fonctionnalités avancées :**
- **Chemin critique** : Identification automatique des tâches critiques
- **Simulation** : Test de scénarios avec modification temporaire
- **Historique** : Suivi des modifications avec possibilité de rollback
- **Export** : Génération de plannings PDF, Excel, iCal

**Intégration calendrier :**
- **Synchronisation** : Intégration avec calendriers externes (Google, Outlook)
- **Conflits** : Détection des conflits avec autres événements
- **Disponibilités** : Vérification automatique des disponibilités équipe
- **Rappels** : Génération automatique de rappels et notifications

Utiliser une librairie de timeline comme react-calendar-timeline ou développer un composant personnalisé avec D3.js pour les besoins spécifiques.

⚙️ **Interactions :** 
- Appelle `rpc_update_event_timeline()` pour les modifications de planning
- Intégration avec système de notifications pour alertes et rappels
- Synchronisation avec calendriers externes via APIs
- Coordination avec Module Prestataires pour disponibilités

💡 **Tips Windsurf :** Utilise la virtualisation pour les plannings longs. Implémente le debounce pour les modifications en temps réel. Optimise les rendus avec React.memo.

---

### 11 - Gestion de l'équipe événement

🎯 **But :** Développer le système complet de gestion des équipes événement avec assignation des rôles, suivi des performances et collaboration intégrée.

🧠 **Contexte technique :** La gestion d'équipe est cruciale pour la coordination des événements. Le système doit permettre l'assignation flexible des rôles, le suivi des disponibilités et la collaboration en temps réel. L'interface doit être intuitive pour les coordinateurs tout en fournissant une visibilité claire à tous les membres.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventTeam.tsx` avec :

**Interface de gestion d'équipe :**
- **Vue d'ensemble** : Organigramme visuel de l'équipe avec rôles et responsabilités
- **Liste détaillée** : Tableau avec profils, rôles, statuts, dernière activité
- **Recherche d'équipe** : Sélection de membres avec filtres par compétences et disponibilité
- **Templates d'équipe** : Modèles prédéfinis selon le type et la taille d'événement

**Assignation et rôles :**
- **Rôles prédéfinis** : Coordinateur, commercial, technique, assistant, spécialiste
- **Assignation multiple** : Un membre peut avoir plusieurs rôles avec priorités
- **Hiérarchie** : Définition des relations hiérarchiques et de reporting
- **Permissions** : Droits spécifiques selon le rôle dans l'événement

**Disponibilités et charge :**
- **Calendrier intégré** : Visualisation des disponibilités de chaque membre
- **Charge de travail** : Répartition des tâches et estimation des heures
- **Conflits** : Détection automatique des surcharges et conflits d'agenda
- **Optimisation** : Suggestions d'équilibrage de la charge de travail

**Communication et collaboration :**
- **Chat d'équipe** : Communication interne avec channels par sujet
- **Notifications** : Alertes personnalisées selon le rôle et les préférences
- **Mentions** : Système de mentions pour attirer l'attention
- **Statuts** : Indicateurs de présence et d'activité en temps réel

**Suivi et performance :**
- **Métriques individuelles** : Tâches complétées, respect des délais, qualité
- **Métriques d'équipe** : Collaboration, efficacité, satisfaction client
- **Historique** : Participation aux événements précédents et évaluations
- **Feedback** : Système d'évaluation mutuelle et d'amélioration continue

**Fonctionnalités avancées :**
- **Substitution** : Gestion des remplacements en cas d'indisponibilité
- **Escalade** : Processus automatique d'escalade pour les problèmes
- **Formation** : Suivi des compétences et besoins de formation
- **Certification** : Validation des qualifications pour certains rôles

⚙️ **Interactions :** 
- Appelle `rpc_assign_event_team()` pour les assignations d'équipe
- Intégration avec Console Admin pour profils et permissions
- Synchronisation avec système de notifications pour communications
- Coordination avec planning pour assignation des tâches

💡 **Tips Windsurf :** Utilise des composants drag-and-drop pour l'assignation. Implémente la synchronisation temps réel avec WebSockets. Cache les données de profils fréquemment utilisées.

---

### 12 - Gestion des prestataires événement

🎯 **But :** Implémenter le système complet de gestion des prestataires pour un événement avec sélection, suivi, évaluation et coordination.

🧠 **Contexte technique :** La gestion des prestataires est complexe car elle implique la sélection selon des critères multiples, le suivi des statuts, la génération de briefs personnalisés et l'évaluation post-événement. Le système doit s'intégrer avec le Module Prestataires et les portails externes.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventVendors.tsx` avec :

**Sélection et recherche :**
- **Catalogue intégré** : Accès au catalogue complet du Module Prestataires
- **Recherche avancée** : Filtres par service, localisation, budget, disponibilité
- **Recommandations** : Suggestions basées sur l'historique et les préférences client
- **Comparaison** : Interface de comparaison des prestataires avec critères multiples

**Gestion des statuts :**
- **Pipeline visuel** : Kanban board avec statuts (prospect, contacté, devisé, confirmé)
- **Suivi des interactions** : Historique des communications et négociations
- **Alertes** : Notifications pour les suivis nécessaires et échéances
- **Workflow** : Processus standardisé de sélection et validation

**Briefs et documentation :**
- **Génération automatique** : Briefs personnalisés selon le type de prestation
- **Templates** : Modèles de briefs prédéfinis et personnalisables
- **Collaboration** : Révision et validation des briefs par l'équipe
- **Versioning** : Gestion des versions avec historique des modifications

**Coordination et planning :**
- **Intégration planning** : Synchronisation avec la timeline événement
- **Dépendances** : Gestion des dépendances entre prestataires
- **Coordination** : Outils de communication et de synchronisation
- **Logistique** : Gestion des accès, horaires et contraintes techniques

**Évaluation et feedback :**
- **Grilles d'évaluation** : Critères standardisés par type de prestation
- **Feedback client** : Intégration des retours client via le portail
- **Performance** : Métriques de qualité, ponctualité, professionnalisme
- **Amélioration** : Suggestions d'amélioration et actions correctives

**Fonctionnalités financières :**
- **Devis** : Gestion des devis avec comparaison et négociation
- **Budgets** : Suivi des budgets alloués vs réalisés
- **Facturation** : Interface avec le Module Comptabilité
- **Paiements** : Suivi des échéances et statuts de paiement

⚙️ **Interactions :** 
- Intégration complète avec Module Prestataires pour données et disponibilités
- Appelle `rpc_generate_event_brief()` pour génération de briefs
- Synchronisation avec Vendor Portal pour communications
- Coordination avec Module Comptabilité pour aspects financiers

💡 **Tips Windsurf :** Utilise des composants de comparaison side-by-side. Implémente la génération de PDF pour les briefs. Optimise les requêtes de recherche avec debounce.

---

## 🔧 Section 3 : Fonctionnalités Secondaires


### 13 - Gestion documentaire événement

🎯 **But :** Implémenter le système complet de gestion documentaire pour les événements avec upload, versioning, partage sécurisé et collaboration.

🧠 **Contexte technique :** La gestion documentaire est essentielle pour centraliser tous les documents événement (contrats, plans, photos, vidéos). Le système doit gérer le versioning, les permissions granulaires, la collaboration et l'intégration avec Supabase Storage. L'interface doit être intuitive pour l'upload en masse et l'organisation.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventDocuments.tsx` avec :

**Interface de gestion documentaire :**
- **Vue en grille** : Aperçus visuels des documents avec métadonnées
- **Vue en liste** : Tableau détaillé avec colonnes triables et filtres
- **Arborescence** : Organisation hiérarchique par catégories et dossiers
- **Recherche avancée** : Recherche full-text dans les noms et contenus

**Upload et import :**
- **Drag & drop** : Interface intuitive pour upload multiple
- **Upload en lot** : Traitement de nombreux fichiers simultanément
- **Formats supportés** : Documents (PDF, DOC, XLS), images (JPG, PNG), vidéos (MP4, MOV)
- **Validation** : Vérification des formats, tailles et contraintes de sécurité
- **Progression** : Barres de progression avec possibilité d'annulation

**Versioning et historique :**
- **Versions automatiques** : Création de nouvelles versions lors des modifications
- **Comparaison** : Interface de comparaison entre versions
- **Restauration** : Possibilité de revenir à une version antérieure
- **Historique détaillé** : Journal des modifications avec auteurs et dates

**Catégorisation et organisation :**
- **Types prédéfinis** : Contrats, plans, factures, briefs, photos, vidéos
- **Tags personnalisés** : Système de tags flexible pour organisation
- **Dossiers virtuels** : Organisation logique sans duplication physique
- **Métadonnées** : Informations enrichies (auteur, date, description, statut)

**Partage et permissions :**
- **Permissions granulaires** : Lecture, écriture, partage selon les rôles
- **Partage externe** : Liens sécurisés pour clients et prestataires
- **Expiration** : Liens temporaires avec dates d'expiration
- **Audit trail** : Traçabilité des accès et téléchargements

**Collaboration :**
- **Commentaires** : Annotations et discussions sur les documents
- **Approbations** : Workflow de validation avec signatures électroniques
- **Notifications** : Alertes pour nouveaux documents et modifications
- **Synchronisation** : Mise à jour temps réel des modifications

**Fonctionnalités avancées :**
- **Aperçu intégré** : Visualisation des documents sans téléchargement
- **Conversion** : Transformation automatique de formats (PDF, images)
- **OCR** : Reconnaissance de texte pour documents scannés
- **Compression** : Optimisation automatique des tailles de fichiers

⚙️ **Interactions :** 
- Utilise Supabase Storage pour stockage sécurisé des fichiers
- Intégration avec Client Portal et Vendor Portal pour partage
- Synchronisation avec Module Contrats pour documents contractuels
- Coordination avec système de notifications pour alertes

💡 **Tips Windsurf :** Utilise react-dropzone pour l'upload. Implémente la compression d'images côté client. Gère les uploads volumineux avec chunking.

---

### 14 - Système de communications événement

🎯 **But :** Développer le système complet de communications pour les événements avec historique, channels multiples et intégration avec les portails.

🧠 **Contexte technique :** Les communications sont cruciales pour la coordination événement. Le système doit centraliser tous les échanges (emails, messages portail, notes internes) avec historique complet, recherche et intégration avec les systèmes externes. L'interface doit faciliter la communication multi-canal.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventCommunications.tsx` avec :

**Centre de communications unifié :**
- **Timeline chronologique** : Historique complet de toutes les communications
- **Filtres par channel** : Email, portail client, portail prestataire, notes internes
- **Recherche avancée** : Recherche full-text dans les contenus et métadonnées
- **Groupement** : Organisation par conversation et participants

**Composition et envoi :**
- **Éditeur riche** : Interface WYSIWYG pour composition des messages
- **Templates** : Modèles prédéfinis pour communications récurrentes
- **Destinataires multiples** : Sélection flexible des destinataires
- **Pièces jointes** : Intégration avec la gestion documentaire

**Channels de communication :**
- **Email intégré** : Envoi d'emails avec tracking et accusés de réception
- **Messages portail** : Communication via Client Portal et Vendor Portal
- **Notes internes** : Communications privées entre membres de l'équipe
- **Appels téléphoniques** : Enregistrement des résumés d'appels

**Suivi et métriques :**
- **Statuts de lecture** : Indicateurs de lecture pour emails et messages
- **Temps de réponse** : Métriques de réactivité par participant
- **Engagement** : Taux d'ouverture et de réponse des communications
- **Escalade** : Alertes pour communications sans réponse

**Automatisation :**
- **Notifications automatiques** : Envoi selon les événements et jalons
- **Rappels** : Relances automatiques pour communications importantes
- **Workflows** : Séquences de communications préprogrammées
- **Déclencheurs** : Actions automatiques selon les réponses reçues

**Intégration externe :**
- **Synchronisation email** : Import des emails depuis boîtes externes
- **APIs tierces** : Intégration avec systèmes de communication externes
- **Webhooks** : Notifications temps réel pour événements externes
- **Export** : Sauvegarde des communications pour archivage

⚙️ **Interactions :** 
- Intégration avec Client Portal et Vendor Portal pour messages
- Utilise Supabase Edge Functions pour envoi d'emails
- Synchronisation avec système de notifications global
- Coordination avec Module Prestataires pour communications

💡 **Tips Windsurf :** Utilise un éditeur riche comme TipTap. Implémente la synchronisation temps réel avec WebSockets. Cache les conversations fréquentes.

---

### 15 - Analytics et reporting événement

🎯 **But :** Créer le système complet d'analytics et de reporting pour les événements avec métriques avancées, visualisations et exports.

🧠 **Contexte technique :** Les analytics événement fournissent des insights cruciaux pour l'optimisation des processus et la satisfaction client. Le système doit calculer des métriques complexes, générer des visualisations interactives et permettre l'export de rapports personnalisés.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventAnalytics.tsx` avec :

**Dashboard de métriques :**
- **KPIs principaux** : Taux de réussite, satisfaction client, respect des délais
- **Métriques financières** : Budget vs réalisé, rentabilité, coûts par poste
- **Métriques opérationnelles** : Temps de planification, efficacité équipe
- **Métriques qualité** : Évaluations prestataires, incidents, réclamations

**Visualisations interactives :**
- **Graphiques temporels** : Évolution des métriques dans le temps
- **Comparaisons** : Benchmarking entre événements similaires
- **Répartitions** : Camemberts pour budgets, temps, ressources
- **Heatmaps** : Visualisation des pics d'activité et goulots d'étranglement

**Analyses prédictives :**
- **Prévisions** : Estimation des budgets et délais basée sur l'historique
- **Risques** : Identification des facteurs de risque et alertes précoces
- **Optimisations** : Suggestions d'amélioration basées sur les données
- **Tendances** : Analyse des tendances sectorielles et saisonnières

**Rapports personnalisés :**
- **Templates** : Modèles de rapports prédéfinis par type d'événement
- **Personnalisation** : Création de rapports sur mesure avec filtres
- **Automatisation** : Génération automatique selon des plannings
- **Distribution** : Envoi automatique aux parties prenantes

**Exports et intégrations :**
- **Formats multiples** : PDF, Excel, PowerPoint pour rapports
- **APIs** : Exposition des données pour outils BI externes
- **Webhooks** : Notifications temps réel pour seuils et alertes
- **Archivage** : Sauvegarde historique pour analyses longitudinales

**Analyses comparatives :**
- **Benchmarking** : Comparaison avec événements similaires
- **Évolution** : Suivi de l'amélioration continue
- **Segmentation** : Analyses par type, taille, saison d'événement
- **Corrélations** : Identification des facteurs de succès

⚙️ **Interactions :** 
- Utilise les données de tous les modules pour analyses complètes
- Intégration avec Module Comptabilité pour métriques financières
- Coordination avec Dashboard principal pour KPIs globaux
- Export vers outils BI externes via APIs

💡 **Tips Windsurf :** Utilise Chart.js ou Recharts pour visualisations. Implémente le lazy loading pour gros datasets. Cache les calculs complexes.

---

### 16 - Gestion des conflits et alertes

🎯 **But :** Implémenter le système complet de détection, gestion et résolution des conflits événement avec alertes intelligentes.

🧠 **Contexte technique :** La gestion des conflits est critique pour éviter les problèmes opérationnels. Le système doit détecter automatiquement les conflits (dates, ressources, équipes) et proposer des solutions. Les alertes doivent être intelligentes et contextuelles pour éviter la fatigue informationnelle.

🛠️ **Type de fichier :** `.tsx` (React component)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventConflicts.tsx` avec :

**Détection automatique :**
- **Conflits de dates** : Chevauchements d'événements, équipes, lieux
- **Conflits de ressources** : Surallocation d'équipements, espaces, personnel
- **Conflits budgétaires** : Dépassements, allocations insuffisantes
- **Conflits logistiques** : Incompatibilités techniques, contraintes d'accès

**Interface de gestion :**
- **Dashboard des conflits** : Vue d'ensemble avec priorités et impacts
- **Détails par conflit** : Analyse approfondie avec éléments impliqués
- **Suggestions** : Propositions automatiques de résolution
- **Simulation** : Test des solutions avant application

**Résolution assistée :**
- **Alternatives automatiques** : Propositions de créneaux, ressources, équipes
- **Négociation** : Outils pour négocier les modifications avec les parties
- **Escalade** : Processus d'escalade pour conflits complexes
- **Validation** : Approbation des résolutions par les responsables

**Système d'alertes :**
- **Niveaux de priorité** : Critique, important, information selon l'impact
- **Personnalisation** : Préférences d'alertes par utilisateur et rôle
- **Channels multiples** : Email, notifications push, SMS selon l'urgence
- **Groupement** : Éviter le spam en groupant les alertes similaires

**Prévention proactive :**
- **Règles métier** : Configuration de règles de validation personnalisées
- **Seuils d'alerte** : Alertes préventives avant les conflits réels
- **Monitoring continu** : Surveillance en temps réel des indicateurs
- **Apprentissage** : Amélioration des détections basée sur l'historique

**Historique et analytics :**
- **Journal des conflits** : Historique complet avec résolutions
- **Métriques** : Fréquence, types, temps de résolution des conflits
- **Analyses** : Identification des causes récurrentes et améliorations
- **Reporting** : Rapports pour management et amélioration continue

⚙️ **Interactions :** 
- Surveillance de toutes les entités événement pour détection de conflits
- Intégration avec système de notifications pour alertes
- Coordination avec tous les modules pour vérifications croisées
- Utilise l'IA pour suggestions de résolution intelligentes

💡 **Tips Windsurf :** Utilise des workers pour détection en arrière-plan. Implémente des algorithmes de suggestion basés sur l'historique. Optimise les vérifications pour éviter les ralentissements.

---

### 17 - Intégration avec portails client et prestataire

🎯 **But :** Développer les intégrations complètes avec les portails Client et Vendor pour synchronisation des données et collaboration transparente.

🧠 **Contexte technique :** L'intégration avec les portails est essentielle pour une expérience utilisateur cohérente. Le système doit synchroniser les données en temps réel, gérer les permissions d'accès et faciliter la collaboration entre toutes les parties prenantes de l'événement.

🛠️ **Type de fichier :** `.tsx` (React component + API integration)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/integrations/PortalIntegration.tsx` avec :

**Synchronisation Client Portal :**
- **Données événement** : Synchronisation automatique des informations principales
- **Planning partagé** : Visibilité client sur les étapes importantes
- **Documents** : Partage sécurisé des documents pertinents
- **Communications** : Messages bidirectionnels avec historique

**Synchronisation Vendor Portal :**
- **Briefs prestataires** : Transmission automatique des briefs personnalisés
- **Planning coordination** : Synchronisation des créneaux et dépendances
- **Livrables** : Suivi des livrables et validations
- **Évaluations** : Collecte des évaluations post-événement

**Gestion des permissions :**
- **Visibilité contrôlée** : Filtrage des informations selon les rôles
- **Accès temporaire** : Permissions limitées dans le temps
- **Audit trail** : Traçabilité des accès et modifications
- **Révocation** : Possibilité de révoquer les accès instantanément

**Collaboration temps réel :**
- **Notifications croisées** : Alertes entre tous les systèmes
- **Statuts synchronisés** : Mise à jour temps réel des statuts
- **Commentaires partagés** : Discussions multi-plateformes
- **Validation collaborative** : Processus d'approbation distribués

**APIs et webhooks :**
- **APIs RESTful** : Exposition des données pour les portails
- **Webhooks** : Notifications temps réel des changements
- **Authentification** : Tokens sécurisés pour accès API
- **Rate limiting** : Protection contre les abus d'API

**Monitoring et analytics :**
- **Métriques d'usage** : Utilisation des portails par les utilisateurs
- **Performance** : Temps de réponse et disponibilité des intégrations
- **Erreurs** : Monitoring et alertes pour problèmes d'intégration
- **Satisfaction** : Feedback des utilisateurs des portails

⚙️ **Interactions :** 
- Synchronisation bidirectionnelle avec Client Portal et Vendor Portal
- Utilise Supabase Realtime pour synchronisation temps réel
- Intégration avec Console Admin pour gestion des permissions
- Coordination avec système de notifications global

💡 **Tips Windsurf :** Utilise Supabase Realtime pour synchronisation. Implémente des queues pour traitement asynchrone. Cache les données fréquemment synchronisées.

---

### 18 - Archivage et historique événements

🎯 **But :** Créer le système complet d'archivage des événements terminés avec conservation des données, recherche historique et analytics longitudinales.

🧠 **Contexte technique :** L'archivage est crucial pour la conformité, l'analyse historique et l'amélioration continue. Le système doit gérer le cycle de vie complet des données événement avec archivage intelligent, compression et accès optimisé aux données historiques.

🛠️ **Type de fichier :** `.tsx` (React component + backend functions)

🔄 **Comportement attendu :**
Créer `apps/backoffice/src/features/events/components/EventArchive.tsx` avec :

**Processus d'archivage :**
- **Archivage automatique** : Déclenchement selon des règles configurables
- **Archivage manuel** : Possibilité d'archiver manuellement avec justification
- **Validation** : Vérification de la complétude avant archivage
- **Notification** : Alertes aux parties prenantes avant archivage

**Conservation des données :**
- **Données essentielles** : Conservation permanente des informations clés
- **Documents** : Archivage sécurisé avec compression intelligente
- **Métadonnées** : Enrichissement pour faciliter la recherche future
- **Relations** : Préservation des liens entre entités archivées

**Recherche historique :**
- **Interface dédiée** : Recherche spécialisée dans les archives
- **Filtres avancés** : Recherche par période, type, participants
- **Indexation** : Index optimisés pour recherche rapide
- **Aperçus** : Visualisation rapide sans restauration complète

**Analytics historiques :**
- **Tendances longues** : Analyses sur plusieurs années
- **Évolution** : Suivi de l'amélioration des processus
- **Benchmarking** : Comparaisons avec événements passés
- **Apprentissage** : Extraction d'insights pour futurs événements

**Restauration et accès :**
- **Restauration partielle** : Accès à des éléments spécifiques
- **Restauration complète** : Remise en état opérationnel si nécessaire
- **Permissions** : Contrôle d'accès aux données archivées
- **Audit** : Traçabilité des accès aux archives

**Conformité et légal :**
- **Rétention** : Respect des durées de conservation légales
- **Purge** : Suppression sécurisée après expiration
- **Chiffrement** : Protection des données sensibles archivées
- **Certification** : Preuves d'intégrité pour aspects légaux

⚙️ **Interactions :** 
- Utilise `rpc_archive_completed_event()` pour processus d'archivage
- Intégration avec Supabase Storage pour stockage long terme
- Coordination avec Console Admin pour permissions d'accès
- Synchronisation avec système de conformité global

💡 **Tips Windsurf :** Utilise la compression pour optimiser le stockage. Implémente des index spécialisés pour recherche historique. Sépare les données chaudes et froides.

---

## 🚀 Section 4 : Évolutions Futures


### 19 - Intelligence artificielle pour optimisation événement

🎯 **But :** Intégrer l'intelligence artificielle pour optimiser automatiquement la planification, prédire les risques et améliorer l'expérience événement.

🧠 **Contexte technique :** L'IA révolutionnera la gestion événement en automatisant les tâches complexes, prédisant les problèmes et optimisant les ressources. Cette évolution s'appuie sur l'accumulation de données historiques et l'intégration avec la Console IA Automatisation.

🛠️ **Type de fichier :** `.tsx` + `.py` (Edge Functions)

🔄 **Comportement attendu :**
Développer les fonctionnalités IA avancées :

**Planification intelligente :**
- **Optimisation automatique** : Génération de plannings optimaux selon contraintes
- **Allocation ressources** : Distribution intelligente des équipes et équipements
- **Détection conflits** : Prédiction et prévention proactive des conflits
- **Suggestions amélioration** : Recommandations basées sur l'analyse des données

**Prédictions et analytics :**
- **Prédiction risques** : Identification précoce des facteurs de risque
- **Estimation budgets** : Prévisions financières précises basées sur l'historique
- **Prédiction satisfaction** : Anticipation de la satisfaction client
- **Optimisation coûts** : Suggestions de réduction des coûts sans impact qualité

**Automatisation intelligente :**
- **Workflows adaptatifs** : Processus qui s'adaptent selon le contexte
- **Communications automatiques** : Messages personnalisés selon les situations
- **Escalade intelligente** : Détection automatique des besoins d'intervention
- **Apprentissage continu** : Amélioration des algorithmes avec l'expérience

⚙️ **Interactions :** 
- Intégration avec Console IA Automatisation pour modèles et workflows
- Utilise les données de tous les modules pour apprentissage
- APIs externes pour enrichissement de données (météo, trafic, événements)

💡 **Tips Windsurf :** Utilise TensorFlow.js pour IA côté client. Implémente des modèles pré-entraînés avec fine-tuning. Cache les prédictions fréquentes.

---

### 20 - Réalité virtuelle et augmentée

🎯 **But :** Intégrer les technologies VR/AR pour visualisation immersive des événements et collaboration à distance.

🧠 **Contexte technique :** La VR/AR transformera la planification événement en permettant la visualisation 3D des espaces, la collaboration immersive et l'expérience client enrichie. Cette évolution nécessite l'intégration de technologies WebXR et de modélisation 3D.

🛠️ **Type de fichier :** `.tsx` + WebXR APIs

🔄 **Comportement attendu :**
Développer les fonctionnalités immersives :

**Visualisation 3D :**
- **Modèles 3D lieux** : Représentation tridimensionnelle des espaces
- **Configuration virtuelle** : Placement virtuel du mobilier et décorations
- **Simulations** : Visualisation des différents moments de l'événement
- **Walkthroughs** : Visites virtuelles pour clients et équipes

**Collaboration immersive :**
- **Réunions VR** : Planification collaborative en réalité virtuelle
- **Annotations 3D** : Commentaires et modifications dans l'espace virtuel
- **Partage temps réel** : Collaboration simultanée sur les modèles 3D
- **Présentation client** : Démonstrations immersives pour validation

**Réalité augmentée :**
- **Superposition informations** : Affichage d'infos contextuelles sur site
- **Assistance technique** : Guidage AR pour installation et setup
- **Contrôle qualité** : Vérification AR des installations
- **Formation équipe** : Modules de formation en réalité augmentée

⚙️ **Interactions :** 
- Intégration avec Module Lieux pour modèles 3D des espaces
- Utilise WebXR APIs pour compatibilité multi-plateformes
- Synchronisation avec planning pour visualisation temporelle

💡 **Tips Windsurf :** Utilise Three.js pour rendu 3D. Implémente le progressive loading pour modèles complexes. Optimise pour performance mobile.

---

### 21 - IoT et capteurs intelligents

🎯 **But :** Intégrer l'Internet des Objets pour monitoring temps réel des événements et automatisation des équipements.

🧠 **Contexte technique :** L'IoT révolutionnera le monitoring événement avec capteurs intelligents, automatisation des équipements et collecte de données temps réel. Cette évolution nécessite l'intégration de protocoles IoT et de plateformes de gestion des devices.

🛠️ **Type de fichier :** `.tsx` + IoT Edge Functions

🔄 **Comportement attendu :**
Développer l'écosystème IoT :

**Capteurs environnementaux :**
- **Monitoring ambiance** : Température, humidité, luminosité, bruit
- **Qualité air** : Surveillance CO2, particules, allergènes
- **Sécurité** : Détection intrusion, fumée, mouvements suspects
- **Capacité** : Comptage automatique des participants

**Automatisation équipements :**
- **Éclairage intelligent** : Adaptation automatique selon planning
- **Sonorisation** : Contrôle automatique des niveaux et zones
- **Climatisation** : Régulation selon occupation et conditions
- **Sécurité** : Activation/désactivation automatique des systèmes

**Analytics temps réel :**
- **Dashboards live** : Métriques temps réel pendant l'événement
- **Alertes automatiques** : Notifications pour dépassements de seuils
- **Optimisation continue** : Ajustements automatiques des paramètres
- **Feedback instantané** : Collecte de données pour amélioration

⚙️ **Interactions :** 
- Intégration avec plateformes IoT (AWS IoT, Azure IoT)
- Utilise MQTT pour communication temps réel avec capteurs
- Synchronisation avec planning pour automatisation contextuelle

💡 **Tips Windsurf :** Utilise WebSockets pour données temps réel. Implémente des buffers pour gérer les pics de données. Optimise la consommation batterie des capteurs.

---

### 22 - Blockchain et contrats intelligents

🎯 **But :** Intégrer la blockchain pour traçabilité immuable, contrats intelligents et paiements décentralisés.

🧠 **Contexte technique :** La blockchain apportera transparence, sécurité et automatisation via les contrats intelligents. Cette évolution révolutionnera la gestion contractuelle et financière des événements avec traçabilité immuable et paiements automatisés.

🛠️ **Type de fichier :** `.tsx` + Smart Contracts

🔄 **Comportement attendu :**
Développer l'infrastructure blockchain :

**Contrats intelligents :**
- **Automatisation paiements** : Déclenchement automatique selon jalons
- **Conditions programmables** : Exécution selon critères prédéfinis
- **Escrow décentralisé** : Séquestre automatique des fonds
- **Résolution disputes** : Mécanismes automatiques de résolution

**Traçabilité immuable :**
- **Audit trail blockchain** : Enregistrement immuable des actions
- **Preuves d'exécution** : Certification des livrables et services
- **Historique inaltérable** : Conservation permanente des événements
- **Conformité automatique** : Vérification automatique des obligations

**Tokens et incitations :**
- **Tokens de fidélité** : Récompenses pour clients récurrents
- **Incitations performance** : Bonus automatiques pour équipes
- **Gouvernance décentralisée** : Votes sur améliorations du système
- **Économie circulaire** : Échange de services entre prestataires

⚙️ **Interactions :** 
- Intégration avec Module Contrats pour automatisation
- Utilise Ethereum ou Polygon pour contrats intelligents
- Synchronisation avec Module Comptabilité pour paiements

💡 **Tips Windsurf :** Utilise Web3.js pour intégration blockchain. Implémente des oracles pour données externes. Optimise les coûts de gas des transactions.

---

### 23 - Intégration écosystème externe

🎯 **But :** Développer les intégrations avec l'écosystème externe (CRM, ERP, plateformes sectorielles) pour interopérabilité maximale.

🧠 **Contexte technique :** L'intégration avec l'écosystème externe est cruciale pour éviter les silos et maximiser la valeur des données. Cette évolution nécessite des APIs robustes, des connecteurs standardisés et une architecture d'intégration flexible.

🛠️ **Type de fichier :** `.tsx` + Integration APIs

🔄 **Comportement attendu :**
Développer les intégrations externes :

**CRM et ERP externes :**
- **Synchronisation bidirectionnelle** : Échange de données clients et financières
- **Mapping intelligent** : Correspondance automatique des champs
- **Résolution conflits** : Gestion des divergences de données
- **Audit intégrations** : Traçabilité des synchronisations

**Plateformes sectorielles :**
- **Marketplaces mariage** : Intégration avec plateformes de réservation
- **Réseaux prestataires** : Connexion avec annuaires professionnels
- **Outils spécialisés** : Intégration avec logiciels métier spécifiques
- **Standards sectoriels** : Conformité aux normes de l'industrie

**APIs et connecteurs :**
- **API Gateway** : Point d'entrée unifié pour intégrations
- **Connecteurs prêts** : Bibliothèque de connecteurs pré-développés
- **SDK développeurs** : Outils pour créer des intégrations personnalisées
- **Marketplace intégrations** : Écosystème d'extensions tierces

⚙️ **Interactions :** 
- Utilise des standards comme REST, GraphQL, webhooks
- Intégration avec plateformes d'intégration (Zapier, Make)
- Synchronisation avec tous les modules internes

💡 **Tips Windsurf :** Utilise des queues pour intégrations asynchrones. Implémente des retry mechanisms pour robustesse. Cache les données externes fréquemment utilisées.

---

### 24 - Analytics prédictifs et machine learning

🎯 **But :** Développer des capacités d'analytics prédictifs avancés avec machine learning pour optimisation continue et insights stratégiques.

🧠 **Contexte technique :** Les analytics prédictifs transformeront la prise de décision avec des modèles ML sophistiqués, prédictions précises et recommandations intelligentes. Cette évolution s'appuie sur l'accumulation de données et l'amélioration continue des modèles.

🛠️ **Type de fichier :** `.tsx` + ML Models

🔄 **Comportement attendu :**
Développer les capacités ML avancées :

**Modèles prédictifs :**
- **Prédiction succès** : Probabilité de succès selon les paramètres
- **Optimisation ressources** : Allocation optimale basée sur prédictions
- **Prévision demande** : Anticipation des besoins saisonniers
- **Détection anomalies** : Identification automatique des situations atypiques

**Recommandations intelligentes :**
- **Suggestions personnalisées** : Recommandations basées sur profils clients
- **Optimisation planning** : Suggestions d'amélioration des plannings
- **Sélection prestataires** : Recommandations basées sur performance historique
- **Pricing dynamique** : Optimisation des tarifs selon la demande

**Apprentissage continu :**
- **Feedback loops** : Amélioration continue des modèles
- **A/B testing** : Test de différentes approches
- **Métriques performance** : Suivi de la précision des prédictions
- **Adaptation automatique** : Ajustement des modèles selon les résultats

⚙️ **Interactions :** 
- Utilise les données de tous les modules pour entraînement
- Intégration avec Console IA pour gestion des modèles
- APIs externes pour enrichissement des données

💡 **Tips Windsurf :** Utilise TensorFlow ou PyTorch pour modèles complexes. Implémente des pipelines MLOps pour déploiement. Monitore la dérive des modèles.

---

## 📊 Matrice de Priorités et Recommandations d'Exécution

### **Phase 1 - Fondations Critiques (Semaines 1-4)**
**Prompts P0 :** 01-06 (Infrastructure base de données et backend)
- Création schéma complet avec 8 tables interconnectées
- Types énumérés et contraintes métier robustes  
- Index optimisés pour performance
- Politiques RLS granulaires pour sécurité
- Fonctions RPC pour logique métier complexe
- Triggers pour automatisation et cohérence

### **Phase 2 - Interfaces Principales (Semaines 5-10)**
**Prompts P1 :** 07-12 (Fonctionnalités cœur utilisateur)
- Page liste événements avec recherche avancée
- Formulaire création/édition complet
- Page détails avec onglets organisés
- Planning et timeline interactive
- Gestion équipe événement
- Coordination prestataires

### **Phase 3 - Fonctionnalités Avancées (Semaines 11-14)**
**Prompts P2 :** 13-18 (Fonctionnalités secondaires)
- Gestion documentaire complète
- Système communications unifié
- Analytics et reporting
- Gestion conflits et alertes
- Intégrations portails
- Archivage et historique

### **Phase 4 - Évolutions Futures (Versions ultérieures)**
**Prompts P3 :** 19-24 (Innovations technologiques)
- Intelligence artificielle
- Réalité virtuelle/augmentée
- IoT et capteurs
- Blockchain et contrats intelligents
- Intégrations écosystème
- Analytics prédictifs ML

## 🎯 Recommandations Finales

### **Dépendances Critiques**
- ✅ **Module Clients** : Requis pour références et conversion leads
- ✅ **Module Lieux** : Essentiel pour gestion des espaces et disponibilités
- ✅ **Console Admin** : Fondamental pour permissions et sécurité
- ⚠️ **Module Prestataires** : Nécessaire pour coordination complète

### **Optimisations Windsurf**
- **Cascade Mode** : Utiliser pour développement incrémental des interfaces
- **Memories** : Sauvegarder les patterns de développement événement
- **Rules** : Configurer pour respect des conventions ERP Wedding Collection
- **MCP Integration** : Automatiser les déploiements Supabase et Vercel

### **Points d'Attention**
- **Performance** : Optimiser les requêtes complexes avec jointures multiples
- **Sécurité** : Tester rigoureusement les politiques RLS
- **Intégrations** : Valider la synchronisation avec les portails
- **Scalabilité** : Prévoir la montée en charge avec virtualisation

Le module Événement est le **cœur opérationnel** de l'ERP Wedding Collection - sa réussite conditionne l'efficacité de tout l'écosystème ! 🎯

